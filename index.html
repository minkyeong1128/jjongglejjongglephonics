<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì«‘ê¸€ì«‘ê¸€ íŒŒë‹‰ìŠ¤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #ffeb3b;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .main-container {
            background: white;
            border-radius: 25px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .main-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(255,255,255,0.1), transparent);
            transform: rotate(45deg);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .character {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .main-title {
            font-size: 32px;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .main-subtitle {
            font-size: 16px;
            color: #718096;
            margin-bottom: 40px;
        }

        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-button {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border: none;
            border-radius: 20px;
            color: white;
            padding: 20px 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 16px rgba(79, 172, 254, 0.3);
            position: relative;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .menu-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 24px rgba(79, 172, 254, 0.4);
        }

        .menu-button.secondary {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            box-shadow: 0 8px 16px rgba(255, 107, 107, 0.3);
        }

        .menu-button.secondary:hover {
            box-shadow: 0 12px 24px rgba(255, 107, 107, 0.4);
        }

        .menu-button.tertiary {
            background: linear-gradient(135deg, #28a745, #20c997);
            box-shadow: 0 8px 16px rgba(40, 167, 69, 0.3);
        }

        .menu-button.tertiary:hover {
            box-shadow: 0 12px 24px rgba(40, 167, 69, 0.4);
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: #FFFFFF;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            color: #666;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .back-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(253, 203, 110, 0.4);
        }

        .hidden {
            display: none !important;
        }

        /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ë“¤ì„ ì—¬ê¸°ì— í¬í•¨ */
        .title {
            font-size: 28px;
            font-weight: bold;
            color: #4a5568;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .subtitle {
            font-size: 16px;
            color: #718096;
            margin-bottom: 30px;
        }

        .voice-section {
            margin-bottom: 30px;
        }

        .mic-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
            font-size: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 16px rgba(255, 107, 107, 0.3);
            position: relative;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .mic-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 24px rgba(255, 107, 107, 0.4);
        }

        .mic-button.recording {
            background: linear-gradient(135deg, #48bb78, #68d391);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .voice-status {
            margin-top: 15px;
            font-size: 14px;
            color: #666;
            min-height: 20px;
        }

        .result-section {
            margin: 30px 0;
        }

        .original-text {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: bold;
            color: #1565c0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .phonics-container {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
        }

        .phonics-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .syllable-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 10px;
            padding: 10px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.5);
            border: 2px dashed #ccc;
        }

        .syllable-label {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            padding: 5px 10px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .syllable-phonics {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .phonics-item {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 70px;
            position: relative;
            border: 2px solid transparent;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .phonics-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
            background: #f8f9ff;
        }

        .phonics-item.playing {
            background: linear-gradient(135deg, #fff59d, #ffeb3b);
            transform: scale(1.05);
        }

        .phonics-item.consonant {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #fff5f5, #fed7d7);
        }

        .phonics-item.vowel {
            border-color: #4299e1;
            background: linear-gradient(135deg, #f0f8ff, #bee3f8);
        }

        .phonics-item.final {
            border-color: #38a169;
            background: linear-gradient(135deg, #f0fff4, #c6f6d5);
        }

        .jamo {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 8px;
            font-family: 'Malgun Gothic', Arial, sans-serif;
        }

        .pronunciation {
            font-size: 14px;
            color: #4a5568;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .jamo-type {
            font-size: 10px;
            color: #718096;
            font-style: italic;
            padding: 2px 6px;
            border-radius: 8px;
            display: inline-block;
        }

        .jamo-type.consonant {
            background: #fed7d7;
            color: #c53030;
        }

        .jamo-type.vowel {
            background: #bee3f8;
            color: #2b6cb0;
        }

        .jamo-type.final {
            background: #c6f6d5;
            color: #276749;
        }

        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 20px;
        }

        .control-button {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border: none;
            border-radius: 50px;
            color: white;
            padding: 12px 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(79, 172, 254, 0.3);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .control-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(79, 172, 254, 0.4);
        }

        .control-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: white;
            padding: 10px 15px;
            border-radius: 25px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .speed-slider {
            width: 100px;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .speed-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4facfe;
            cursor: pointer;
        }

        .reset-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            border-radius: 15px;
            color: white;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(253, 203, 110, 0.3);
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .reset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(253, 203, 110, 0.4);
        }

        .loading {
            display: none;
            margin: 20px 0;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .emoji {
            font-size: 24px;
            margin: 0 5px;
        }

        .demo-section {
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
        }

        .demo-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            border-radius: 25px;
            color: white;
            padding: 10px 16px;
            font-size: 14px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .demo-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
        }

        .legend {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: #666;
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-color.consonant {
            background: #fed7d7;
        }

        .legend-color.vowel {
            background: #bee3f8;
        }

        .legend-color.final {
            background: #c6f6d5;
        }

        /* ê²Œì„ ìŠ¤íƒ€ì¼ */
        .mode-selection {
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .mode-button {
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 12px 20px;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .mode-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .mode-button.active {
            background: #fff9c4;
            border-color: #ffeb3b;
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            padding: 15px;
            background: #ffffff;
            border-radius: 15px;
            color: black;
            font-weight: normal;
        }

        .question-area {
            margin-bottom: 30px;
        }

        .question-number {
            font-size: 16px;
            color: #718096;
            margin-bottom: 10px;
        }

        .word-image {
            width: 200px;
            height: 200px;
            margin: 20px auto;
            border-radius: 15px;
            background: #ffffff;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .word-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .word-image .loading {
            font-size: 2em;
            color: #5a67d8;
        }

        .audio-button {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            border: none;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            color: white;
            font-size: 2em;
            cursor: pointer;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(255,107,107,0.4);
            transition: all 0.3s ease;
        }

        .audio-button:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(255,107,107,0.6);
        }

        .choices {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .choice-button {
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 10px 20px;
            font-size: 1.3em;
            color: #666;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 80px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            font-weight: bold;
            margin: 10px;
        }

        .choice-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }

        .choice-button.correct {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .choice-button.incorrect {
            background: linear-gradient(45deg, #ff416c, #ff4b2b);
            color: white;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .feedback.correct {
            background: linear-gradient(45deg, #d4edda, #c3e6cb);
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .feedback.incorrect {
            background: linear-gradient(45deg, #f8d7da, #f5c6cb);
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .next-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .result-screen {
            display: none;
            text-align: center;
        }

        .final-score {
            font-size: 1.2em;
            color: #000000;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            line-height: 1.5;
        }

        .retry-button {
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            border-radius: 15px;
            padding: 12px 20px;
            color: white;
            font-size: 14px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .wrong-answers {
            text-align: left;
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #dc3545;
        }

        .wrong-answer-item {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border: 1px solid #dee2e6;
        }

        /* ììŒÂ·ëª¨ìŒ í•™ìŠµ ìŠ¤íƒ€ì¼ */
        .jamo-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .jamo-tab-button {
            background: white;
            border: 2px solid #ddd;
            border-radius: 15px;
            padding: 12px 20px;
            color: #666;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .jamo-tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .jamo-tab-button.active {
            background: #fff9c4;
            border-color: #ffeb3b;
        }

        .jamo-tab-content {
            margin-bottom: 20px;
        }

        .jamo-section-title {
            text-align: center;
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 20px;
        }

        .jamo-cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }

        .jamo-card {
            background: white;
            border: 3px solid transparent;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
            user-select: none;
        }

        .jamo-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .jamo-card.playing {
            transform: scale(1.05);
            border-color: #ffeb3b;
            background: linear-gradient(135deg, #fff59d, #ffeb3b);
        }

        .jamo-card.consonant-card {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, #fff5f5, #fed7d7);
        }

        .jamo-card.vowel-card {
            border-color: #4299e1;
            background: linear-gradient(135deg, #f0f8ff, #bee3f8);
        }

        .jamo-card.final-card {
            border-color: #38a169;
            background: linear-gradient(135deg, #f0fff4, #c6f6d5);
        }

        .jamo-card-jamo {
            font-size: 32px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
            font-family: 'Malgun Gothic', Arial, sans-serif;
        }

        .jamo-card-sound {
            font-size: 16px;
            color: #4a5568;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .jamo-card-type {
            font-size: 12px;
            color: #718096;
            padding: 3px 8px;
            border-radius: 10px;
            display: inline-block;
            font-weight: bold;
        }

        .jamo-card-type.consonant-type {
            background: #fed7d7;
            color: #c53030;
        }

        .jamo-card-type.vowel-type {
            background: #bee3f8;
            color: #2b6cb0;
        }

        .jamo-card-type.final-type {
            background: #c6f6d5;
            color: #276749;
        }

        /* íšìˆœ ëª¨ë‹¬ì°½ ìŠ¤íƒ€ì¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 450px;
            width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 48px;
            font-weight: bold;
            color: #2d3748;
            margin: 0;
            font-family: 'Malgun Gothic', Arial, sans-serif;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 30px;
            color: #999;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            background: #f0f0f0;
            color: #666;
        }

        .stroke-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-radius: 15px;
        }

        .modal-sound {
            font-size: 24px;
            font-weight: bold;
            color: #4a5568;
        }

        .sound-replay-btn {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sound-replay-btn:hover {
            transform: scale(1.1);
        }

        .stroke-canvas-container {
            text-align: center;
            margin-bottom: 20px;
        }

        #strokeCanvas {
            border: 3px solid #ddd;
            border-radius: 15px;
            background: #fafafa;
            cursor: crosshair;
            touch-action: none;
        }

        .stroke-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .stroke-btn {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            border: none;
            border-radius: 25px;
            color: white;
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .stroke-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(79, 172, 254, 0.3);
        }

      
        /* ëª¨ë°”ì¼ ë°˜ì‘í˜• */
        @media (max-width: 480px) {
            .main-container {
                padding: 20px;
                margin: 10px;
            }
            
            .main-title {
                font-size: 24px;
            }
            
            .menu-button {
                padding: 15px 20px;
                font-size: 16px;
            }
            
            .mic-button {
                width: 70px;
                height: 70px;
                font-size: 25px;
            }
            
            .phonics-grid {
                gap: 8px;
            }
            
            .phonics-item {
                min-width: 60px;
                padding: 12px;
            }
            
            .controls {
                gap: 10px;
            }
            
            .speed-control {
                padding: 8px 12px;
            }

            .legend {
                gap: 10px;
            }

            .syllable-group {
                margin: 5px;
                padding: 8px;
            }

            .mode-selection {
                gap: 10px;
            }

            .mode-button {
                padding: 12px 18px;
                font-size: 14px;
            }

            /* ììŒÂ·ëª¨ìŒ í•™ìŠµ ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ */
            .jamo-tabs {
                gap: 5px;
            }

            .jamo-tab-button {
                padding: 10px 15px;
                font-size: 12px;
            }

            .jamo-cards-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 10px;
                padding: 15px;
            }

            .jamo-card {
                padding: 15px;
            }

            .jamo-card-jamo {
                font-size: 24px;
                margin-bottom: 8px;
            }

            .jamo-card-sound {
                font-size: 14px;
                margin-bottom: 4px;
            }

            .jamo-card-type {
                font-size: 10px;
                padding: 2px 6px;
            }

            /* íšìˆœ ëª¨ë‹¬ì°½ ëª¨ë°”ì¼ ìŠ¤íƒ€ì¼ */
            .modal-content {
                padding: 20px;
                max-width: 95%;
            }

            .modal-title {
                font-size: 36px;
            }

            .modal-close {
                font-size: 24px;
            }

            #strokeCanvas {
                width: 100%;
                max-width: 280px;
                height: 280px;
            }

            .stroke-controls {
                gap: 8px;
            }

            .stroke-btn {
                padding: 8px 12px;
                font-size: 12px;
            }

                  }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- ë©”ì¸ ë©”ë‰´ í™”ë©´ -->
        <div id="mainMenu">
            <div class="character">ğŸµ</div>
            <h1 class="main-title">ì«‘ê¸€ì«‘ê¸€ íŒŒë‹‰ìŠ¤</h1>
            <p class="main-subtitle">í•œê¸€ ì†Œë¦¬ ë†€ì´ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!</p>
            
            <div class="menu-buttons">
                <button class="menu-button tertiary" onclick="showJamoLearning()">
                    ğŸ“ ììŒÂ·ëª¨ìŒ ë°°ìš°ê¸°
                    <br><small>ììŒ, ëª¨ìŒ, ë°›ì¹¨ì„ í•˜ë‚˜ì”© ë°°ì›Œë³´ì„¸ìš”</small>
                </button>
                <button class="menu-button" onclick="showSoundAnalysis()">
                    ğŸ¤ ì†Œë¦¬ ë†€ì´
                    <br><small>ë‹¨ì–´ë¥¼ ë§í•˜ë©´ ììŒÂ·ëª¨ìŒÂ·ë°›ì¹¨ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë“¤ë ¤ì¤˜ìš”</small>
                </button>
                <button class="menu-button secondary" onclick="showSoundGame()">
                    ğŸ® ì†Œë¦¬ ë§ì¶”ê¸° ê²Œì„
                    <br><small>ì†Œë¦¬ë¥¼ ë“£ê³  ë§ëŠ” ë‹¨ì–´ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</small>
                </button>
            </div>
        </div>

        <!-- ì†Œë¦¬ ë¶„ì„ í™”ë©´ -->
        <div id="soundAnalysisScreen" class="hidden">
            <button class="back-button" onclick="showMainMenu()">ğŸ”™</button>
            <h1 class="title">ğŸ¤ ì†Œë¦¬ ë†€ì´</h1>
            <p class="subtitle">ë‹¨ì–´ë¥¼ ë§í•˜ë©´ ììŒê³¼ ëª¨ìŒ, ë°›ì¹¨ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë“¤ë ¤ì¤„ê²Œìš”!</p>

            <div class="demo-section">
                <p style="margin-bottom: 10px; font-size: 14px; color: #666;">ì˜ˆì‹œ ë‹¨ì–´ë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”:</p>
                <button class="demo-button" onclick="testWord('ì‚¬ê³¼')">ì‚¬ê³¼</button>
                <button class="demo-button" onclick="testWord('ë”¸ê¸°')">ë”¸ê¸°</button>
                <button class="demo-button" onclick="testWord('ì­ˆê¾¸ë¯¸')">ì­ˆê¾¸ë¯¸</button>
                <button class="demo-button" onclick="testWord('ë½€ë½€')">ë½€ë½€</button>
                <button class="demo-button" onclick="testWord('í•™êµ')">í•™êµ</button>
                <button class="demo-button" onclick="testWord('ì•ˆë…•')">ì•ˆë…•</button>
            </div>

            <div class="voice-section">
                <button class="mic-button" id="micButton">
                    ğŸ¤
                </button>
                <div class="voice-status" id="voiceStatus">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”</div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ë¶„ì„ì¤‘ì´ì—ìš”... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</p>
            </div>

            <div class="result-section hidden" id="resultSection">
                <div class="original-text" id="originalText">
                    <span class="emoji">ğŸ’¬</span>
                    ì—¬ê¸°ì— ì¸ì‹ëœ ë‹¨ì–´ê°€ ë‚˜íƒ€ë‚˜ìš”
                    <span class="emoji">ğŸ’¬</span>
                </div>

                <div class="phonics-container">
                    <h3 style="margin-bottom: 15px; color: #f57c00;">ììŒê³¼ ëª¨ìŒ, ë°›ì¹¨ìœ¼ë¡œ ë‚˜ëˆ„ì–´ë³´ê¸°</h3>
                    
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color consonant"></div>
                            <span>ììŒ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color vowel"></div>
                            <span>ëª¨ìŒ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color final"></div>
                            <span>ë°›ì¹¨</span>
                        </div>
                    </div>

                    <div class="phonics-grid" id="phonicsGrid">
                        <!-- ìŒì ˆë³„ ììŒ/ëª¨ìŒ/ë°›ì¹¨ ê·¸ë£¹ë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                    </div>

                    <div class="controls">
                        <button class="control-button" id="playAllButton">
                            â–¶ï¸ ì „ì²´ ì¬ìƒ
                        </button>
                        
                        <div class="speed-control">
                            <span>ğŸŒ</span>
                            <input type="range" class="speed-slider" id="speedSlider" min="0.5" max="2.0" step="0.1" value="0.6">
                            <span>ğŸ°</span>
                            <span id="speedDisplay">0.6x</span>
                        </div>
                    </div>
                </div>

                <button class="reset-button" id="resetButton">
                    ğŸ”„ ë‹¤ì‹œí•˜ê¸°
                </button>
            </div>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div id="gameScreen" class="hidden">
            <button class="back-button" onclick="showMainMenu()">ğŸ”™</button>
            <h1 class="title">ğŸ® ì†Œë¦¬ ë§ì¶”ê¸° ê²Œì„</h1>
            <div class="question-area">
                <div class="question-number">ë‹¨ì–´ì˜ ììŒÂ·ëª¨ìŒÂ·ë°›ì¹¨ ì†Œë¦¬ë¥¼ ë“£ê³  ë§ëŠ” ë‹¨ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”!</div>
                <br><br>
                
                <div class="mode-selection">
                    <button class="mode-button active" id="noBatchimMode" onclick="setMode('noBatchim')">ë°›ì¹¨ ì—†ëŠ” ë‹¨ì–´</button>
                    <button class="mode-button" id="batchimMode" onclick="setMode('batchim')">ë°›ì¹¨ ìˆëŠ” ë‹¨ì–´</button>
                </div>
                
                <div id="gameArea">
                    <div class="score-board">
                        <div>ë¬¸ì œ: <span id="currentQuestion">1</span> / 10</div>
                        <div>ì ìˆ˜: <span id="score">0</span>ì </div>
                    </div>
                    
                    <div class="word-image" id="wordImage">
                        <div class="icon icon-apple"></div>
                    </div>

                    <button class="audio-button" id="audioButton" onclick="playAudio()">ğŸ”Š</button>
                    <div class="choices" id="choices"></div>
                    <div id="feedback" class="feedback hidden"></div>
                    <button id="nextButton" class="next-button hidden" onclick="nextQuestion()">ë‹¤ìŒ ë¬¸ì œ</button>
                </div>
            </div>

            <div id="resultScreen" class="result-screen">
                <div class="final-score" id="finalScore"></div>
                <div id="wrongAnswers" class="wrong-answers"></div>
                <button class="retry-button" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
            </div>
        </div>

        <!-- ììŒÂ·ëª¨ìŒ í•™ìŠµ í™”ë©´ -->
        <div id="jamoLearningScreen" class="hidden">
            <button class="back-button" onclick="showMainMenu()">ğŸ”™</button>
            <h1 class="title">ğŸ“ ììŒÂ·ëª¨ìŒ ë°°ìš°ê¸°</h1>
            <p class="subtitle">ê° ê¸€ìë¥¼ í´ë¦­í•˜ë©´ ì†Œë¦¬ë¥¼ ë“¤ì„ ìˆ˜ ìˆì–´ìš”!</p>

            <div class="jamo-tabs">
                <button class="jamo-tab-button active" onclick="showJamoTab('consonants')">ììŒ (ã„±ã„´ã„·...)</button>
                <button class="jamo-tab-button" onclick="showJamoTab('vowels')">ëª¨ìŒ (ã…ã…“ã…—...)</button>
                <button class="jamo-tab-button" onclick="showJamoTab('finals')">ë°›ì¹¨ (ã„±ã„´ã„·...)</button>
            </div>

            <!-- ììŒ í•™ìŠµ -->
            <div id="consonantsTab" class="jamo-tab-content">
                <h3 class="jamo-section-title">ììŒ (ì´ˆì„±)</h3>
                <div class="jamo-cards-grid" id="consonantsGrid">
                    <!-- ììŒ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ëª¨ìŒ í•™ìŠµ -->
            <div id="vowelsTab" class="jamo-tab-content hidden">
                <h3 class="jamo-section-title">ëª¨ìŒ (ì¤‘ì„±)</h3>
                <div class="jamo-cards-grid" id="vowelsGrid">
                    <!-- ëª¨ìŒ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>

            <!-- ë°›ì¹¨ í•™ìŠµ -->
            <div id="finalsTab" class="jamo-tab-content hidden">
                <h3 class="jamo-section-title">ë°›ì¹¨ (ì¢…ì„±)</h3>
                <div class="jamo-cards-grid" id="finalsGrid">
                    <!-- ë°›ì¹¨ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ìƒì„±ë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- íšìˆœ ëª¨ë‹¬ì°½ -->
        <div id="strokeOrderModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modalJamoTitle" class="modal-title">ã„±</h3>
                    <button class="modal-close" onclick="closeStrokeModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="stroke-info">
                        <span id="modalJamoSound" class="modal-sound">ê·¸</span>
                        <button class="sound-replay-btn" id="soundReplayBtn">ğŸ”Š</button>
                    </div>
                    <div class="stroke-canvas-container">
                        <canvas id="strokeCanvas" width="300" height="300"></canvas>
                        <div class="stroke-controls">
                           
                            <button class="stroke-btn" onclick="clearCanvas()">ğŸ§¹ ì§€ìš°ê¸°</button>
                            <button class="stroke-btn" onclick="practiceMode()">âœï¸ ì—°ìŠµí•˜ê¸°</button>
                        </div>
                    </div>
                      </div>
            </div>
        </div>
    </div>

    <script>
let audioPlayback = null;
        // ì „ì—­ ë³€ìˆ˜
        let currentApp = null;
        let gameState = {
            currentMode: 'noBatchim',
            currentQuestionIndex: 0,
            score: 0,
            wrongAnswers: [],
            isAnswered: false,
            currentQuestion: null,
            usedWords: [],
            availableWords: []
        };

        // í™”ë©´ ì „í™˜ í•¨ìˆ˜ë“¤
        function showMainMenu() {
            document.getElementById('mainMenu').classList.remove('hidden');
            document.getElementById('soundAnalysisScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('jamoLearningScreen').classList.add('hidden');
            
          // ëª¨ë“  ìŒì„± ì¬ìƒ ì™„ì „íˆ ì¤‘ë‹¨
if (window.speechSynthesis) {
    window.speechSynthesis.cancel();
    // í•œ ë²ˆ ë” í™•ì‹¤íˆ ì¤‘ë‹¨
    setTimeout(() => {
        if (window.speechSynthesis.speaking) {
            window.speechSynthesis.cancel();
        }
    }, 100);
}

// ê²Œì„ì˜ ì˜¤ë””ì˜¤ ì¬ìƒ ì¤‘ë‹¨
if (typeof stopAudioPlayback === 'function') {
    stopAudioPlayback();
}
            
            // ì†Œë¦¬ ë¶„ì„ ì•± ë¦¬ì…‹
            if (currentApp && currentApp.resetApp) {
                currentApp.resetApp();
            }
        }

        function showSoundAnalysis() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('soundAnalysisScreen').classList.remove('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('jamoLearningScreen').classList.add('hidden');
            
            // ì†Œë¦¬ ë¶„ì„ ì•± ì´ˆê¸°í™”
            if (!currentApp) {
                currentApp = new HangulPhonicsApp();
            }
        }

        function showSoundGame() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('soundAnalysisScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.remove('hidden');
            document.getElementById('jamoLearningScreen').classList.add('hidden');
            
            // ê²Œì„ ì´ˆê¸°í™”
            initializeGame();
        }

        function showJamoLearning() {
            document.getElementById('mainMenu').classList.add('hidden');
            document.getElementById('soundAnalysisScreen').classList.add('hidden');
            document.getElementById('gameScreen').classList.add('hidden');
            document.getElementById('jamoLearningScreen').classList.remove('hidden');
            
            // ììŒÂ·ëª¨ìŒ í•™ìŠµ ì´ˆê¸°í™”
            initializeJamoLearning();
        }

        // í•œê¸€ íŒŒë‹‰ìŠ¤ ì•± í´ë˜ìŠ¤ (ê¸°ì¡´ ì½”ë“œ)
        class HangulPhonicsApp {
            constructor() {
                this.recognition = null;
                this.speechSynthesis = window.speechSynthesis;
                this.currentSpeed = 0.6;
                this.isPlaying = false;
                this.currentData = null;
                this.syllableGroups = [];
                this.playingIndex = -1;
                
                this.initializeElements();
                this.initializeEventListeners();
                this.initializeSpeechRecognition();
                this.checkMicrophonePermission();
                
                this.initializeHangulConstants();
            }

            initializeHangulConstants() {
                this.HANGUL_BASE = 0xAC00;
                this.CONSONANT_COUNT = 19;
                this.VOWEL_COUNT = 21;
                this.FINAL_CONSONANT_COUNT = 28;
                
                this.INITIAL_CONSONANTS = [
                    'ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……',
                    'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'
                ];
                
                this.VOWELS = [
                    'ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜',
                    'ã…™', 'ã…š', 'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£'
                ];
                
                this.FINAL_CONSONANTS = [
                    '', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½', 'ã„¾', 'ã„¿', 'ã…€', 'ã…',
                    'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'
                ];

                this.INITIAL_PRONUNCIATION_MAP = {
                    'ã„±': 'ê·¸', 'ã„²': 'ë„', 'ã„´': 'ëŠ', 'ã„·': 'ë“œ', 'ã„¸': 'ëœ¨',
                    'ã„¹': 'ë¥´', 'ã…': 'ë¯€', 'ã…‚': 'ë¸Œ', 'ã…ƒ': 'ì˜', 'ã……': 'ìŠ¤',
                    'ã…†': 'ì“°', 'ã…‡': 'ìœ¼', 'ã…ˆ': 'ì¦ˆ', 'ã…‰': 'ì¯”', 'ã…Š': 'ì¸ ',
                    'ã…‹': 'í¬', 'ã…Œ': 'íŠ¸', 'ã…': 'í”„', 'ã…': 'í'
                };
                
                this.VOWEL_PRONUNCIATION_MAP = {
                    'ã…': 'ì•„', 'ã…': 'ì• ', 'ã…‘': 'ì•¼', 'ã…’': 'ì–˜', 'ã…“': 'ì–´',
                    'ã…”': 'ì—', 'ã…•': 'ì—¬', 'ã…–': 'ì˜ˆ', 'ã…—': 'ì˜¤', 'ã…˜': 'ì™€',
                    'ã…™': 'ì™œ', 'ã…š': 'ì™¸', 'ã…›': 'ìš”', 'ã…œ': 'ìš°', 'ã…': 'ì›Œ',
                    'ã…': 'ì›¨', 'ã…Ÿ': 'ìœ„', 'ã… ': 'ìœ ', 'ã…¡': 'ìœ¼', 'ã…¢': 'ì˜', 'ã…£': 'ì´'
                };
                
                this.FINAL_PRONUNCIATION_MAP = {
                    'ã„±': 'ìœ½', 'ã„²': 'ìœ½', 'ã„³': 'ìœ½', 'ã…‹': 'ìœ½',
                    'ã„´': 'ì€', 'ã„µ': 'ì€', 'ã„¶': 'ì€',
                    'ã„·': 'ì', 'ã……': 'ì', 'ã…†': 'ì', 'ã…ˆ': 'ì', 
                    'ã…Š': 'ì', 'ã…Œ': 'ì', 'ã…': 'ì',
                    'ã„¹': 'ì„', 'ã„º': 'ìœ½', 'ã„»': 'ìŒ', 'ã„¼': 'ì„', 
                    'ã„½': 'ì„', 'ã„¾': 'ì„', 'ã„¿': 'ì', 'ã…€': 'ì„',
                    'ã…': 'ìŒ',
                    'ã…‚': 'ì', 'ã…„': 'ì', 'ã…': 'ì',
                    'ã…‡': 'ì‘'
                };
            }

            initializeElements() {
                this.micButton = document.getElementById('micButton');
                this.voiceStatus = document.getElementById('voiceStatus');
                this.loading = document.getElementById('loading');
                this.resultSection = document.getElementById('resultSection');
                this.originalText = document.getElementById('originalText');
                this.phonicsGrid = document.getElementById('phonicsGrid');
                this.playAllButton = document.getElementById('playAllButton');
                this.speedSlider = document.getElementById('speedSlider');
                this.speedDisplay = document.getElementById('speedDisplay');
                this.resetButton = document.getElementById('resetButton');
            }

            initializeEventListeners() {
                this.micButton.addEventListener('click', () => this.toggleRecording());
                this.playAllButton.addEventListener('click', () => this.playAll());
                this.speedSlider.addEventListener('input', (e) => this.updateSpeed(e.target.value));
                this.resetButton.addEventListener('click', () => this.resetApp());
            }

            initializeSpeechRecognition() {
                const SpeechRecognition = window.SpeechRecognition || 
                                        window.webkitSpeechRecognition || 
                                        window.mozSpeechRecognition ||
                                        window.msSpeechRecognition;

                if (!SpeechRecognition) {
                    this.voiceStatus.textContent = 'ì£„ì†¡í•´ìš”, ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”';
                    this.micButton.disabled = true;
                    return;
                }

                this.recognition = new SpeechRecognition();
                this.recognition.lang = 'ko-KR';
                this.recognition.continuous = false;
                this.recognition.interimResults = false;
                this.recognition.maxAlternatives = 1;

                this.recognition.onstart = () => {
                    this.micButton.classList.add('recording');
                    this.voiceStatus.textContent = 'ë“£ê³  ìˆì–´ìš”... ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”!';
                };

                this.recognition.onresult = (event) => {
                    if (event.results && event.results.length > 0) {
                        const text = event.results[0][0].transcript.trim();
                        if (text) {
                            this.processVoiceInput(text);
                        }
                    }
                };

                this.recognition.onerror = (event) => {
                    this.micButton.classList.remove('recording');
                    let errorMessage = 'ìŒì„±ì¸ì‹ì— ì‹¤íŒ¨í–ˆì–´ìš”. ';
                    switch(event.error) {
                        case 'not-allowed':
                            errorMessage += 'ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
                            break;
                        case 'no-speech':
                            errorMessage += 'ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ì–´ìš”.';
                            break;
                        default:
                            errorMessage += 'ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    }
                    this.voiceStatus.textContent = errorMessage;
                    setTimeout(() => {
                        if (!this.micButton.classList.contains('recording')) {
                            this.voiceStatus.textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”';
                        }
                    }, 3000);
                };

                this.recognition.onend = () => {
                    this.micButton.classList.remove('recording');
                    if (this.voiceStatus.textContent.includes('ë“£ê³  ìˆì–´ìš”')) {
                        this.voiceStatus.textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”';
                    }
                };
            }

            async checkMicrophonePermission() {
                try {
                    if (navigator.permissions) {
                        const result = await navigator.permissions.query({ name: 'microphone' });
                        if (result.state === 'denied') {
                            this.voiceStatus.textContent = 'ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ë¥¼ í—ˆìš©í•´ì£¼ì„¸ìš”.';
                        }
                    }
                } catch (error) {
                    console.log('ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                }
            }

            toggleRecording() {
                if (!this.recognition) {
                    alert('ìŒì„±ì¸ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                if (this.micButton.classList.contains('recording')) {
                    this.recognition.stop();
                } else {
                    try {
                        this.recognition.start();
                    } catch (error) {
                        this.voiceStatus.textContent = 'ìŒì„±ì¸ì‹ì„ ì‹œì‘í•  ìˆ˜ ì—†ì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                    }
                }
            }

            processVoiceInput(text) {
                this.voiceStatus.textContent = `"${text}"ë¥¼ ë¶„ì„ì¤‘ì´ì—ìš”...`;
                this.loading.style.display = 'block';
                setTimeout(() => {
                    this.analyzeHangul(text);
                    this.loading.style.display = 'none';
                }, 500);
            }

             testWord(word) {
                this.voiceStatus.textContent = `"${word}"ë¥¼ ë¶„ì„ì¤‘ì´ì—ìš”...`;
                this.loading.style.display = 'block';
                setTimeout(() => {
                    this.analyzeHangul(word);
                    this.loading.style.display = 'none';
                }, 500);
            }

            analyzeHangul(text) {
                const hangulOnly = text.replace(/[^ê°€-í£]/g, '');
                
                if (!hangulOnly) {
                    this.voiceStatus.textContent = 'í•œê¸€ ë‹¨ì–´ë¥¼ ë§í•´ì£¼ì„¸ìš”!';
                    return;
                }

                this.originalText.innerHTML = `<span class="emoji">ğŸ’¬</span> ${hangulOnly} <span class="emoji">ğŸ’¬</span>`;
                
                const syllableData = [];
                for (let i = 0; i < hangulOnly.length; i++) {
                    const char = hangulOnly[i];
                    const decomposed = this.decompose(char);
                    if (decomposed) {
                        syllableData.push({
                            original: char,
                            ...decomposed
                        });
                    }
                }

                this.currentData = {
                    original: hangulOnly,
                    syllables: syllableData
                };

                this.displayPhonics(syllableData);
                this.resultSection.classList.remove('hidden');
                this.voiceStatus.textContent = 'ì™„ì„±! ê° ì†Œë¦¬ë¥¼ í´ë¦­í•´ë³´ì„¸ìš” ğŸµ';
            }

            decompose(char) {
                const code = char.charCodeAt(0) - this.HANGUL_BASE;
                if (code < 0 || code > 11171) return null;

                const initialIndex = Math.floor(code / (this.VOWEL_COUNT * this.FINAL_CONSONANT_COUNT));
                const vowelIndex = Math.floor((code % (this.VOWEL_COUNT * this.FINAL_CONSONANT_COUNT)) / this.FINAL_CONSONANT_COUNT);
                const finalIndex = code % this.FINAL_CONSONANT_COUNT;

                return {
                    initial: this.INITIAL_CONSONANTS[initialIndex],
                    vowel: this.VOWELS[vowelIndex],
                    final: finalIndex > 0 ? this.FINAL_CONSONANTS[finalIndex] : null
                };
            }

            displayPhonics(syllableData) {
                this.phonicsGrid.innerHTML = '';
                this.syllableGroups = [];

                syllableData.forEach((syllable) => {
                    const syllableGroup = document.createElement('div');
                    syllableGroup.className = 'syllable-group';
                    
                    const label = document.createElement('div');
                    label.className = 'syllable-label';
                    label.textContent = syllable.original;
                    syllableGroup.appendChild(label);

                    const phonicsContainer = document.createElement('div');
                    phonicsContainer.className = 'syllable-phonics';

                    const phonicsItems = [];

                    if (syllable.initial) {
                        const initialItem = this.createPhonicsItem(
                            syllable.initial, 
                            this.INITIAL_PRONUNCIATION_MAP[syllable.initial] || syllable.initial,
                            'consonant',
                            'ììŒ'
                        );
                        phonicsContainer.appendChild(initialItem);
                        phonicsItems.push(initialItem);
                    }

                    if (syllable.vowel) {
                        const vowelItem = this.createPhonicsItem(
                            syllable.vowel,
                            this.VOWEL_PRONUNCIATION_MAP[syllable.vowel] || syllable.vowel,
                            'vowel',
                            'ëª¨ìŒ'
                        );
                        phonicsContainer.appendChild(vowelItem);
                        phonicsItems.push(vowelItem);
                    }

                    if (syllable.final) {
                        const finalItem = this.createPhonicsItem(
                            syllable.final,
                            this.FINAL_PRONUNCIATION_MAP[syllable.final] || syllable.final,
                            'final',
                            'ë°›ì¹¨'
                        );
                        phonicsContainer.appendChild(finalItem);
                        phonicsItems.push(finalItem);
                    }

                    syllableGroup.appendChild(phonicsContainer);
                    this.phonicsGrid.appendChild(syllableGroup);
                    
                    this.syllableGroups.push({
                        element: syllableGroup,
                        items: phonicsItems
                    });
                });
            }

            createPhonicsItem(jamo, pronunciation, type, typeLabel) {
                const item = document.createElement('div');
                item.className = `phonics-item ${type}`;
                
                item.innerHTML = `
                    <div class="jamo">${jamo}</div>
                    <div class="pronunciation">${pronunciation}</div>
                    <div class="jamo-type ${type}">${typeLabel}</div>
                `;

                item.addEventListener('click', () => {
                    this.playSound(pronunciation, item);
                });

                return item;
            }

            playSound(text, element = null) {
                if (this.speechSynthesis.speaking) {
                    this.speechSynthesis.cancel();
                }

                setTimeout(() => {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'ko-KR';
                    utterance.rate = this.currentSpeed;
                    utterance.pitch = 1.2;
                    utterance.volume = 1.0;

                    if (element) {
                        element.classList.add('playing');
                        
                        const cleanup = () => {
                            element.classList.remove('playing');
                        };
                        
                        utterance.onend = cleanup;
                        utterance.onerror = cleanup;
                        setTimeout(cleanup, 3000);
                    }

                    this.speechSynthesis.speak(utterance);
                }, 50);
            }

            async playAll() {
                if (this.isPlaying || !this.currentData) return;

                this.isPlaying = true;
                this.playAllButton.disabled = true;
                this.playAllButton.textContent = 'ğŸµ ì¬ìƒì¤‘...';

                try {
                    await this.delay(100);
                    await this.playWithDelay(this.currentData.original, null, 800);

                    for (let i = 0; i < this.syllableGroups.length; i++) {
                        if (!this.isPlaying) break;
                        
                        const group = this.syllableGroups[i];
                        await this.playWithDelay(this.currentData.syllables[i].original, null, 600);
                        
                        for (let j = 0; j < group.items.length; j++) {
                            if (!this.isPlaying) break;
                            const item = group.items[j];
                            const pronunciation = item.querySelector('.pronunciation').textContent;
                            await this.playWithDelay(pronunciation, item, 400);
                        }
                        
                        if (i < this.syllableGroups.length - 1) {
                            await this.delay(300);
                        }
                    }

                    if (this.isPlaying) {
                        await this.playWithDelay(this.currentData.original, null, 0);
                    }

                } catch (error) {
                    console.error('ì¬ìƒ ì¤‘ ì˜¤ë¥˜:', error);
                } finally {
                    this.isPlaying = false;
                    this.playAllButton.disabled = false;
                    this.playAllButton.textContent = 'â–¶ï¸ ì „ì²´ ì¬ìƒ';
                    
                    document.querySelectorAll('.phonics-item.playing').forEach(item => {
                        item.classList.remove('playing');
                    });
                }
            }

            playWithDelay(text, element, delayMs) {
                return new Promise((resolve) => {
                    if (this.speechSynthesis.speaking) {
                        this.speechSynthesis.cancel();
                    }
                    
                    setTimeout(() => {
                        const utterance = new SpeechSynthesisUtterance(text);
                        utterance.lang = 'ko-KR';
                        utterance.rate = this.currentSpeed;
                        utterance.pitch = 1.2;
                        utterance.volume = 1.0;

                        if (element) {
                            element.classList.add('playing');
                        }

                        let isResolved = false;
                        const resolveOnce = () => {
                            if (!isResolved) {
                                isResolved = true;
                                if (element) {
                                    element.classList.remove('playing');
                                }
                                setTimeout(resolve, delayMs);
                            }
                        };

                        utterance.onend = resolveOnce;
                        utterance.onerror = resolveOnce;

                        const timeoutId = setTimeout(() => {
                            this.speechSynthesis.cancel();
                            resolveOnce();
                        }, Math.max(text.length * 200, 2000));

                        utterance.onstart = () => {
                            clearTimeout(timeoutId);
                        };

                        this.speechSynthesis.speak(utterance);
                    }, 50);
                });
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            updateSpeed(value) {
                this.currentSpeed = parseFloat(value);
                this.speedDisplay.textContent = `${value}x`;
            }

            resetApp() {
                this.isPlaying = false;
                
                if (this.speechSynthesis.speaking) {
                    this.speechSynthesis.cancel();
                }
                
                setTimeout(() => {
                    this.resultSection.classList.add('hidden');
                    this.voiceStatus.textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”';
                    this.currentData = null;
                    this.syllableGroups = [];
                    
                    this.playAllButton.disabled = false;
                    this.playAllButton.textContent = 'â–¶ï¸ ì „ì²´ ì¬ìƒ';
                    
                    document.querySelectorAll('.phonics-item.playing').forEach(item => {
                        item.classList.remove('playing');
                    });
                }, 100);
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë¡œ testWord ë…¸ì¶œ
        function testWord(word) {
            if (currentApp && currentApp.testWord) {
                currentApp.testWord(word);
            }
        }

        // ê²Œì„ ê´€ë ¨ ì½”ë“œ
        const INITIAL_PRONUNCIATION = {
            'ã„±': 'ê·¸', 'ã„²': 'ë„', 'ã„´': 'ëŠ', 'ã„·': 'ë“œ', 'ã„¸': 'ëœ¨',
            'ã„¹': 'ë¥´', 'ã…': 'ë¯€', 'ã…‚': 'ë¸Œ', 'ã…ƒ': 'ì˜', 'ã……': 'ìŠ¤',
            'ã…†': 'ì“°', 'ã…‡': 'ìœ¼', 'ã…ˆ': 'ì¦ˆ', 'ã…‰': 'ì¯”', 'ã…Š': 'ì¸ ',
            'ã…‹': 'í¬', 'ã…Œ': 'íŠ¸', 'ã…': 'í”„', 'ã…': 'í'
        };
        
        const VOWEL_PRONUNCIATION = {
            'ã…': 'ì•„', 'ã…': 'ì• ', 'ã…‘': 'ì•¼', 'ã…’': 'ì–˜', 'ã…“': 'ì–´',
            'ã…”': 'ì—', 'ã…•': 'ì—¬', 'ã…–': 'ì˜ˆ', 'ã…—': 'ì˜¤', 'ã…˜': 'ì™€',
            'ã…™': 'ì™œ', 'ã…š': 'ì™¸', 'ã…›': 'ìš”', 'ã…œ': 'ìš°', 'ã…': 'ì›Œ',
            'ã…': 'ì›¨', 'ã…Ÿ': 'ìœ„', 'ã… ': 'ìœ ', 'ã…¡': 'ìœ¼', 'ã…¢': 'ì˜', 'ã…£': 'ì´'
        };
        
        const FINAL_PRONUNCIATION = {
            // ê¸°ë³¸ ë°›ì¹¨ 7ê°œ (ã„±,ã„´,ã„¹,ã…,ã…‚,ã……,ã…‡)
            'ã„±': 'ìœ½',  // ã„± ë°›ì¹¨
            'ã„´': 'ì€',   // ã„´ ë°›ì¹¨
            'ã„¹': 'ì„',   // ã„¹ ë°›ì¹¨
            'ã…': 'ìŒ',   // ã… ë°›ì¹¨
            'ã…‚': 'ì',   // ã…‚ ë°›ì¹¨
            'ã……': 'ì',   // ã…… ë°›ì¹¨
            'ã…‡': 'ì‘',   // ã…‡ ë°›ì¹¨
            
            // ë‚˜ë¨¸ì§€ ë°›ì¹¨ë“¤ (ê²Œì„ìš©ìœ¼ë¡œ ìœ ì§€)
            'ã„²': 'ìœ½', 'ã„³': 'ìœ½', 'ã…‹': 'ìœ½',
            'ã„µ': 'ì€', 'ã„¶': 'ì€',
            'ã„·': 'ì', 'ã…†': 'ì', 'ã…ˆ': 'ì', 
            'ã…Š': 'ì', 'ã…Œ': 'ì', 'ã…': 'ì',
            'ã„º': 'ìœ½', 'ã„»': 'ìŒ', 'ã„¼': 'ì„', 
            'ã„½': 'ì„', 'ã„¾': 'ì„', 'ã„¿': 'ì', 'ã…€': 'ì„',
            'ã…„': 'ì', 'ã…': 'ì'
        };

        // í•œê¸€ ìì†Œ ë¶„í•´ í•¨ìˆ˜
        function decomposeHangul(char) {
            const code = char.charCodeAt(0) - 0xAC00;
            if (code < 0 || code > 11171) return null;

            const initial = Math.floor(code / 588);
            const medial = Math.floor((code % 588) / 28);
            const final = code % 28;

            const initials = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
            const medials = ['ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜', 'ã…™', 'ã…š', 'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£'];
            const finals = ['', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½', 'ã„¾', 'ã„¿', 'ã…€', 'ã…', 'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];

            return {
                initial: initials[initial],
                medial: medials[medial],
                final: finals[final]
            };
        }

        // ë‹¨ì–´ë¥¼ íŒŒë‹‰ìŠ¤ë¡œ ë¶„í•´ (ë””ë²„ê¹… ë²„ì „)
       function wordToPhonics(word) {
    const phonics = [];
    
    console.log('ë¶„í•´í•  ë‹¨ì–´:', word);
    
    for (let char of word) {
        const decomposed = decomposeHangul(char);
        console.log(`${char} ë¶„í•´ ê²°ê³¼:`, decomposed);
        
        if (decomposed) {
            // ìŒì ˆë³„ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬
            const syllablePhonics = [];
            
            // ì´ˆì„± (ììŒ)
            const initialSound = INITIAL_PRONUNCIATION[decomposed.initial] || decomposed.initial;
            syllablePhonics.push(initialSound);
            
            // ì¤‘ì„± (ëª¨ìŒ)
            const vowelSound = VOWEL_PRONUNCIATION[decomposed.medial] || decomposed.medial;
            syllablePhonics.push(vowelSound);
            
            // ì¢…ì„± (ë°›ì¹¨) - ìˆëŠ” ê²½ìš°ì—ë§Œ
            if (decomposed.final) {
                const finalSound = FINAL_PRONUNCIATION[decomposed.final] || decomposed.final;
                syllablePhonics.push(finalSound);
            }
            
            // ìŒì ˆ ë‹¨ìœ„ë¡œ phonics ë°°ì—´ì— ì¶”ê°€
            phonics.push(...syllablePhonics);
        }
    }
    
    // ì—°ì†ëœ ë™ì¼í•œ ì†Œë¦¬ ì œê±°
    const uniquePhonics = [];
    for (let i = 0; i < phonics.length; i++) {
        if (i === 0 || phonics[i] !== phonics[i-1]) {
            uniquePhonics.push(phonics[i]);
        }
    }
    
    console.log('ì¤‘ë³µ ì œê±° í›„ íŒŒë‹‰ìŠ¤:', uniquePhonics);
    return uniquePhonics;
}

        // ë‹¨ì–´ ë°ì´í„°
        const noBatchimWordsWithIcons = [
            'ë‚˜ë¹„', 'ì—¬ìš°', 'ê°œêµ¬ë¦¬', 'ë‘ë”ì§€', 'í•˜ë§ˆ', 'ë©”ëšœê¸°', 'í† ë¼', 'ì½”ë¼ë¦¬', 'ì‚¬ì', 'ë¼ì§€', 'ê³ ë˜', 'ê°œë¯¸', 'ê¹Œë§ˆê·€',
            'ì‚¬ê³¼', 'ë°”ë‚˜ë‚˜', 'í¬ë„', 'í† ë§ˆí† ', 'ì²´ë¦¬', 'ìš°ìœ ', 'ì¹˜ì¦ˆ', 'ê³¼ì', 'ì¼€ì´í¬', 'ê³ ê¸°',
            'ë‚˜ë¬´', 'í•´', 'êµ¬ë¦„', 'ë¹„', 'ë¬´ì§€ê°œ', 'ë°”ë‹¤', 'ëª¨ë˜', 'í•´íŒŒë¦¬',
            'ëª¨ì', 'ì‹œê³„', 'ì¹´ë©”ë¼', 'ë¹„ëˆ„', 'ì˜ì', 'ìˆ˜ì„¸ë¯¸', 'ì', 'ê°€ìœ„',
            'ë²„ìŠ¤', 'ê¸°ì°¨', 'ë°°', 'ì˜¤í† ë°”ì´',
            'ì˜¤ë¦¬', 'ê±°ìœ„', 'ì†Œ', 'í¬ë ˆíŒŒìŠ¤', 'ë¨¸ë¦¬', 'ë§ˆíŠ¸'
        ];

        const batchimWordsWithIcons = [
            'ê°•ì•„ì§€', 'ê³ ì–‘ì´', 'í˜¸ë‘ì´', 'ë¬¼ê³ ê¸°', 'ìƒì–´', 'ë¬¸ì–´', 'ë¹„ë‘˜ê¸°', 'ë…ìˆ˜ë¦¬', 'ë¶€ì—‰ì´', 
            'ê¹Œë§ˆê·€', 'ë‹­', 'ë§', 'ì–‘', 'ì—¼ì†Œ', 'ê¸°ë¦°', 'ì›ìˆ­ì´', 'íŒ¬ë”', 'ê³°', 'ëŠ‘ëŒ€', 'ì‚¬ìŠ´', 
            'ë‹¤ëŒì¥', 'ê³ ìŠ´ë„ì¹˜', 'ë°•ì¥', 'í­ê·„', 'ìº¥ê±°ë£¨', 'ì°¸ìƒˆ',
            'ë”¸ê¸°', 'ì‚¬íƒ•', 'ë°¥', 'êµ­', 'ë‹¬ê±€', 'ë¹µ', 'ë–¡', 'ì•„ì´ìŠ¤í¬ë¦¼', 'ì´ˆì½œë¦¿','ì½©', 'ìŒ€', 'ê°ì', 'ë‹¹ê·¼',
            'ë°”ëŒ', 'ì²œë‘¥', 'ë²ˆê°œ', 'ëˆˆ', 'ì‚°', 'ê°•', 'ê½ƒ', 'ì',
            'ì‹ ë°œ', 'ì—´ì‡ ', 'ê±°ìš¸', 'ê°€ë°©', 'ì±…', 'ì—°í•„', 'í…Œì´í”„', 'ê³µì±…', 
            'íœ', 'ì»´í“¨í„°', 'í•¸ë“œí°', 'ì•ˆê²½', 'ì–‘ë§', 'ì¥ê°‘','ì „í™”', 'ìš°ì‚°', 'ìƒˆì‹¹', 'ì¹¨ëŒ€',
            'ìì „ê±°', 'íƒì‹œ', 'íŠ¸ëŸ­', 'ìë™ì°¨', 'ë¹„í–‰ê¸°', 'í—¬ë¦¬ì½¥í„°',
            'ë¹¨ê°•', 'ë…¸ë‘', 'íŒŒë‘', 'ì´ˆë¡', 'í•˜ì–‘',
            'ì–¼êµ´', 'ëˆˆ', 'ì½”', 'ì…', 'ê·€', 'ì†', 'ë°œ',
            'ì§‘', 'í•™êµ', 'ë³‘ì›'
        ];

        // ë‹¨ì–´ë³„ ì´ëª¨ì§€ ë§¤í•‘
        const wordEmojiMap = {
            'ë‚˜ë¹„': 'ğŸ¦‹', 'ì—¬ìš°': 'ğŸ¦Š', 'ê°œêµ¬ë¦¬': 'ğŸ¸', 'ë‘ë”ì§€': 'ğŸ¦«', 
            'í•˜ë§ˆ': 'ğŸ¦›', 'ë©”ëšœê¸°': 'ğŸ¦—', 'í† ë¼': 'ğŸ°', 'ì½”ë¼ë¦¬': 'ğŸ˜', 
            'ì‚¬ì': 'ğŸ¦', 'ë¼ì§€': 'ğŸ·', 'ê³ ë˜': 'ğŸ‹', 
            'ê°œë¯¸': 'ğŸœ', 'ì†Œ': 'ğŸ„', 'ê¹Œë§ˆê·€': 'ğŸ¦â€â¬›', 
            'ì‚¬ê³¼': 'ğŸ', 'ë°”ë‚˜ë‚˜': 'ğŸŒ', 'í¬ë„': 'ğŸ‡', 'í† ë§ˆí† ': 'ğŸ…',
            'ì²´ë¦¬': 'ğŸ’', 'ìš°ìœ ': 'ğŸ¥›', 'ì¹˜ì¦ˆ': 'ğŸ§€',
            'ê³¼ì': 'ğŸª', 'ì¼€ì´í¬': 'ğŸ‚', 'ê³ ê¸°': 'ğŸ¥©',
            'ë‚˜ë¬´': 'ğŸŒ³', 'í•´': 'â˜€ï¸', 'êµ¬ë¦„': 'â˜ï¸', 'ë¹„': 'ğŸŒ§ï¸',
            'ë¬´ì§€ê°œ': 'ğŸŒˆ', 'ë°”ë‹¤': 'ğŸŒŠ', 'ëª¨ë˜': 'ğŸ–ï¸', 'í•´íŒŒë¦¬': 'ğŸª¼', 
            'ëª¨ì': 'ğŸ‘’', 'ì‹œê³„': 'â°', 'ì¹´ë©”ë¼': 'ğŸ“·', 'ë¹„ëˆ„': 'ğŸ§¼',
            'ì˜ì': 'ğŸª‘', 'ìˆ˜ì„¸ë¯¸': 'ğŸ§½', 'ì': 'ğŸ“', 'ê°€ìœ„': 'âœ‚ï¸',
            'ë²„ìŠ¤': 'ğŸšŒ', 'ê¸°ì°¨': 'ğŸš‚', 'ë°°': 'ğŸš¢', 'ì˜¤í† ë°”ì´': 'ğŸï¸',
            'ì˜¤ë¦¬': 'ğŸ¦†', 'ê±°ìœ„': 'ğŸ¦¢', 'í¬ë ˆíŒŒìŠ¤': 'ğŸ–ï¸', 'ë¨¸ë¦¬': 'ğŸ’‡', 'ë§ˆíŠ¸': 'ğŸª', 
            'ê°•ì•„ì§€': 'ğŸ¶', 'ê³ ì–‘ì´': 'ğŸ±', 'í˜¸ë‘ì´': 'ğŸ…', 'ë¬¼ê³ ê¸°': 'ğŸŸ', 
            'ìƒì–´': 'ğŸ¦ˆ', 'ë¬¸ì–´': 'ğŸ™', 'ë¹„ë‘˜ê¸°': 'ğŸ•Šï¸', 'ë…ìˆ˜ë¦¬': 'ğŸ¦…',
            'ë¶€ì—‰ì´': 'ğŸ¦‰', 'ì°¸ìƒˆ': 'ğŸ¦', 'ë‹­': 'ğŸ“', 
            'ë§': 'ğŸ´', 'ì–‘': 'ğŸ‘', 'ì—¼ì†Œ': 'ğŸ', 'ê¸°ë¦°': 'ğŸ¦’', 
            'ì›ìˆ­ì´': 'ğŸ’', 'íŒ¬ë”': 'ğŸ¼', 'ê³°': 'ğŸ»', 'ëŠ‘ëŒ€': 'ğŸº', 
            'ì‚¬ìŠ´': 'ğŸ¦Œ', 'ë‹¤ëŒì¥': 'ğŸ¿ï¸', 'ê³ ìŠ´ë„ì¹˜': 'ğŸ¦”', 'ë°•ì¥': 'ğŸ¦‡', 
            'í­ê·„': 'ğŸ§', 'ìº¥ê±°ë£¨': 'ğŸ¦˜',
            'ë”¸ê¸°': 'ğŸ“', 'ì‚¬íƒ•': 'ğŸ¬', 'ë°¥': 'ğŸš', 'êµ­': 'ğŸ²', 
            'ë‹¬ê±€': 'ğŸ¥š', 'ë¹µ': 'ğŸ', 
            'ë–¡': 'ğŸ¡', 'ì•„ì´ìŠ¤í¬ë¦¼': 'ğŸ¦', 'ì´ˆì½œë¦¿': 'ğŸ«', 
            'ì½©': 'ğŸ«˜', 'ìŒ€': 'ğŸŒ¾', 'ê°ì': 'ğŸ¥”', 'ë‹¹ê·¼': 'ğŸ¥•',
            'ë°”ëŒ': 'ğŸ’¨', 'ì²œë‘¥': 'â›ˆï¸', 'ë²ˆê°œ': 'âš¡', 
            'ëˆˆ': 'â„ï¸', 'ì‚°': 'â›°ï¸', 'ê°•': 'ğŸï¸', 
            'ê½ƒ': 'ğŸŒ¸', 'ì': 'ğŸƒ', 
            'ì‹ ë°œ': 'ğŸ‘Ÿ', 'ì—´ì‡ ': 'ğŸ”‘', 'ê±°ìš¸': 'ğŸª',
            'ê°€ë°©': 'ğŸ’', 'ì±…': 'ğŸ“š', 
            'ì—°í•„': 'âœï¸', 'ê³µì±…': 'ğŸ““', 'íœ': 'ğŸ–Šï¸', 
            'ì»´í“¨í„°': 'ğŸ’»', 'í•¸ë“œí°': 'ğŸ“±', 'ì•ˆê²½': 'ğŸ‘“', 
            'ì–‘ë§': 'ğŸ§¦', 'ì¥ê°‘': 'ğŸ§¤','ì „í™”': 'â˜ï¸', 
            'ìš°ì‚°': 'â˜‚ï¸', 'ìƒˆì‹¹': 'ğŸŒ±', 'ì¹¨ëŒ€': 'ğŸ›ï¸',
            'ìì „ê±°': 'ğŸš²', 'íƒì‹œ': 'ğŸš•', 'íŠ¸ëŸ­': 'ğŸšš', 'ìë™ì°¨': 'ğŸš—', 
            'ë¹„í–‰ê¸°': 'âœˆï¸', 'í—¬ë¦¬ì½¥í„°': 'ğŸš',
            'ë¹¨ê°•': 'ğŸ”´', 'ë…¸ë‘': 'ğŸŸ¡', 'íŒŒë‘': 'ğŸ”µ', 'ì´ˆë¡': 'ğŸŸ¢', 'í•˜ì–‘': 'âšª',
            'ì–¼êµ´': 'ğŸ˜Š', 'ëˆˆ': 'ğŸ‘ï¸', 'ì½”': 'ğŸ‘ƒ', 'ì…': 'ğŸ‘„', 
            'ê·€': 'ğŸ‘‚', 'ì†': 'âœ‹', 'ë°œ': 'ğŸ¦¶', 
            'ì§‘': 'ğŸ ', 'í•™êµ': 'ğŸ«', 'ë³‘ì›': 'ğŸ¥'
        };

        // ê²Œì„ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function loadImageForWord(word) {
            const wordImageContainer = document.getElementById('wordImage');
            const emoji = wordEmojiMap[word] || 'â“';
            wordImageContainer.innerHTML = `<div style="font-size: 4em; color: #5a67d8; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);">${emoji}</div>`;
        }

        function playCorrectSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.5);
            } catch (error) {
                console.log('ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:', error);
            }
        }

        function playIncorrectSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(250, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.2);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.4);
            } catch (error) {
                console.log('ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:', error);
            }
        }

        function generateRandomChoices(correctAnswer, wordPool) {
            const choices = [correctAnswer];
            const correctSyllableCount = correctAnswer.length;
            
            const availableWords = wordPool.filter(word => 
                word !== correctAnswer && word.length === correctSyllableCount
            );
            
            const finalWordPool = availableWords.length >= 2 ? availableWords : 
                                 wordPool.filter(word => word !== correctAnswer);
            
            while (choices.length < 3) {
                const randomWord = finalWordPool[Math.floor(Math.random() * finalWordPool.length)];
                if (!choices.includes(randomWord)) {
                    choices.push(randomWord);
                }
            }
            
            return choices.sort(() => Math.random() - 0.5);
        }

        function generateNewQuestion() {
            if (gameState.availableWords.length === 0) {
                const wordPool = gameState.currentMode === 'noBatchim' ? noBatchimWordsWithIcons : batchimWordsWithIcons;
                gameState.availableWords = [...wordPool];
            }
            
            const randomIndex = Math.floor(Math.random() * gameState.availableWords.length);
            const correctWord = gameState.availableWords.splice(randomIndex, 1)[0];
            
            gameState.usedWords.push(correctWord);
            
            const wordPool = gameState.currentMode === 'noBatchim' ? noBatchimWordsWithIcons : batchimWordsWithIcons;
            const choices = generateRandomChoices(correctWord, wordPool);
            
            return {
                word: correctWord,
                choices: choices,
                correct: choices.indexOf(correctWord)
            };
        }

        function setMode(mode) {
            gameState.currentMode = mode;
            document.getElementById('noBatchimMode').classList.toggle('active', mode === 'noBatchim');
            document.getElementById('batchimMode').classList.toggle('active', mode === 'batchim');

            gameState.usedWords = [];
            gameState.availableWords = [];

            restartGame();
        }

        function playAudio() {
    if (!gameState.currentQuestion) return;

    // ê¸°ì¡´ ì¬ìƒ ì¤‘ë‹¨
    stopAudioPlayback();

    const phonics = wordToPhonics(gameState.currentQuestion.word);
    console.log('ì¬ìƒí•  íŒŒë‹‰ìŠ¤:', phonics);
    
    const uniquePhonics = [];
    for (let i = 0; i < phonics.length; i++) {
        if (i === 0 || phonics[i] !== phonics[i-1]) {
            uniquePhonics.push(phonics[i]);
        }
    }
    
    console.log('ì¤‘ë³µ ì œê±° í›„:', uniquePhonics);
    
    let index = 0;
    let isStopped = false;

    function playNext() {
        if (index >= uniquePhonics.length || isStopped) return;

        const utterance = new SpeechSynthesisUtterance(uniquePhonics[index]);
        utterance.lang = 'ko-KR';
        utterance.rate = 0.5;
        utterance.volume = 1.0;
        utterance.pitch = 1.2;

        utterance.onend = function() {
            index++;
            if (index < uniquePhonics.length && !isStopped) {
                setTimeout(playNext, 400);
            }
        };

        utterance.onerror = function() {
            console.log('ìŒì„± ì¬ìƒ ì˜¤ë¥˜');
            index++;
            if (index < uniquePhonics.length && !isStopped) {
                setTimeout(playNext, 400);
            }
        };

        window.speechSynthesis.speak(utterance);
    }

    audioPlayback = {
        stop: function() {
            isStopped = true;
            window.speechSynthesis.cancel();
        }
    };

    setTimeout(playNext, 100);
}
function stopAudioPlayback() {
    if (audioPlayback && audioPlayback.stop) {
        audioPlayback.stop();
        audioPlayback = null;
    }
    window.speechSynthesis.cancel();
}

        function displayQuestion() {
            gameState.currentQuestion = generateNewQuestion();

            document.getElementById('currentQuestion').textContent = gameState.currentQuestionIndex + 1;
            
            loadImageForWord(gameState.currentQuestion.word);

            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = '';

            gameState.currentQuestion.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-button';
                button.textContent = choice;
                button.onclick = () => selectAnswer(index);
                choicesContainer.appendChild(button);
            });

            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('nextButton').classList.add('hidden');
            gameState.isAnswered = false;
        }

        function selectAnswer(selectedIndex) {
            if (gameState.isAnswered) return;
            
        // íŒŒë‹‰ìŠ¤ ì¬ìƒ ì™„ì „íˆ ì¤‘ë‹¨
stopAudioPlayback();

// ì§§ì€ ëŒ€ê¸° í›„ ì™„ì „íˆ ì¤‘ë‹¨ë˜ì—ˆëŠ”ì§€ í™•ì¸
setTimeout(() => {
    if (window.speechSynthesis.speaking) {
        window.speechSynthesis.cancel();
    }
}, 50);

// ì„ íƒí•œ ë³´ê¸°ì˜ ì†Œë¦¬ ì¬ìƒ
setTimeout(() => {
    const selectedWord = gameState.currentQuestion.choices[selectedIndex];
    const utterance = new SpeechSynthesisUtterance(selectedWord);
    utterance.lang = 'ko-KR';
    utterance.rate = 0.8;
    utterance.volume = 1.0;
    utterance.pitch = 1.0;
    window.speechSynthesis.speak(utterance);
}, 200);
            
            gameState.isAnswered = true;

            const correctIndex = gameState.currentQuestion.choices.indexOf(gameState.currentQuestion.word);
            const buttons = document.querySelectorAll('.choice-button');
            const feedback = document.getElementById('feedback');

            buttons.forEach(btn => btn.style.pointerEvents = 'none');

            if (selectedIndex === correctIndex) {
                gameState.score++;
                document.getElementById('score').textContent = gameState.score;

                buttons[selectedIndex].classList.add('correct');
                feedback.className = 'feedback correct';
                feedback.innerHTML = `<strong>ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰</strong><br>ì •ë‹µ: ${gameState.currentQuestion.word}`;
                feedback.classList.remove('hidden');
                
                playCorrectSound();
            } else {
                buttons.forEach((btn, index) => {
                    if (index === correctIndex) {
                        btn.classList.add('correct');
                    } else {
                        btn.classList.add('incorrect');
                    }
                });

                gameState.wrongAnswers.push({
                    question: gameState.currentQuestionIndex + 1,
                    word: gameState.currentQuestion.word,
                    userAnswer: gameState.currentQuestion.choices[selectedIndex],
                    correctAnswer: gameState.currentQuestion.word
                });

                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `<strong>í‹€ë ¸ìŠµë‹ˆë‹¤! ğŸ˜…</strong><br>ì •ë‹µ: ${gameState.currentQuestion.word}`;
                feedback.classList.remove('hidden');
                
                playIncorrectSound();
            }

            document.getElementById('nextButton').classList.remove('hidden');
        }

        function nextQuestion() {
            gameState.currentQuestionIndex++;
            
            if (gameState.currentQuestionIndex >= 10) {
                showResult();
            } else {
                displayQuestion();
            }
        }

        function showResult() {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';

            const totalQuestions = 10;
            const correctAnswers = gameState.score;
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            
            let message = '';
            if (percentage === 100) {
                message = 'ğŸ‰ ì™„ë²½í•´ìš”! ëª¨ë“  ë¬¸ì œë¥¼ ë§ì·„ì–´ìš”! ğŸ‰';
            } else if (percentage >= 80) {
                message = 'ğŸŒŸ í›Œë¥­í•´ìš”! ì •ë§ ì˜í–ˆì–´ìš”! ğŸŒŸ';
            } else if (percentage >= 60) {
                message = 'ğŸ‘ ì¢‹ì•„ìš”! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•˜ë©´ ë” ì˜í•  ìˆ˜ ìˆì–´ìš”! ğŸ‘';
            } else {
                message = 'ğŸ’ª ê´œì°®ì•„ìš”! ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”! ğŸ’ª';
            }
            
            document.getElementById('finalScore').innerHTML = `
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 1.1em; margin-bottom: 10px;">
                        ì´ <span style="color: #ff6b6b;">${totalQuestions}</span>ë¬¸ì œ ì¤‘ 
                        <span style="color: #ff6b6b;">${correctAnswers}</span>ë¬¸ì œ ì •ë‹µ!
                    </div>
                    <div style="font-size: 1.5em; color: #ff6b6b;">
                        ìµœì¢… ì ìˆ˜: ${gameState.score}ì 
                    </div>
                    <div style="font-size: 1.1em; margin-top: 20px; color: #000000;">
                        ${message}
                    </div>
                </div>
            `;

            const wrongAnswersContainer = document.getElementById('wrongAnswers');
            wrongAnswersContainer.style.display = 'none';
        }

        function restartGame() {
            gameState.currentQuestionIndex = 0;
            gameState.score = 0;
            gameState.wrongAnswers = [];
            gameState.isAnswered = false;
            gameState.currentQuestion = null;
            gameState.usedWords = [];
            gameState.availableWords = [];

            document.getElementById('score').textContent = '0';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('resultScreen').style.display = 'none';

            displayQuestion();
        }

        function initializeGame() {
            displayQuestion();
            setTimeout(playAudio, 1000);
        }

        // ì•± ì‹œì‘ ì‹œ ë©”ì¸ ë©”ë‰´ í‘œì‹œ
        window.onload = function() {
            showMainMenu();
        };

       // íšìˆœ ë°ì´í„° ì •ì˜

// ììŒÂ·ëª¨ìŒ í•™ìŠµ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function initializeJamoLearning() {
            createConsonantCards();
            createVowelCards();
            createFinalCards();
            showJamoTab('consonants'); // ê¸°ë³¸ì ìœ¼ë¡œ ììŒ íƒ­ í‘œì‹œ
        }

        function showJamoTab(tabName) {
            // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
            document.querySelectorAll('.jamo-tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
            document.querySelectorAll('.jamo-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            if (tabName === 'consonants') {
                document.querySelector('.jamo-tab-button:nth-child(1)').classList.add('active');
                document.getElementById('consonantsTab').classList.remove('hidden');
            } else if (tabName === 'vowels') {
                document.querySelector('.jamo-tab-button:nth-child(2)').classList.add('active');
                document.getElementById('vowelsTab').classList.remove('hidden');
            } else if (tabName === 'finals') {
                document.querySelector('.jamo-tab-button:nth-child(3)').classList.add('active');
                document.getElementById('finalsTab').classList.remove('hidden');
            }
        }

        function createConsonantCards() {
            // ê¸°ë³¸ ììŒ (ã„±-ã…) + ìŒììŒ ìˆœì„œë¡œ ë°°ì—´
            const consonants = [
                // ê¸°ë³¸ ììŒ
                'ã„±', 'ã„´', 'ã„·', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…',
                // ìŒììŒ
                'ã„²', 'ã„¸', 'ã…ƒ', 'ã…†', 'ã…‰'
            ];
            const grid = document.getElementById('consonantsGrid');
            grid.innerHTML = '';

            consonants.forEach(consonant => {
                const sound = INITIAL_PRONUNCIATION[consonant] || consonant;
                const card = createJamoCard(consonant, sound, 'consonant', 'ììŒ');
                grid.appendChild(card);
            });
        }

        function createVowelCards() {
            // ê¸°ë³¸ ëª¨ìŒ (ã…-ã…£) + ì´ì¤‘ëª¨ìŒ ìˆœì„œë¡œ ë°°ì—´
            const vowels = [
                // ê¸°ë³¸ ëª¨ìŒ
                'ã…', 'ã…‘', 'ã…“', 'ã…•', 'ã…—', 'ã…›', 'ã…œ', 'ã… ', 'ã…¡', 'ã…£',
                // ì´ì¤‘ëª¨ìŒ
                'ã…', 'ã…’', 'ã…”', 'ã…–', 'ã…˜', 'ã…™', 'ã…š', 'ã…', 'ã…', 'ã…Ÿ', 'ã…¢'
            ];
            const grid = document.getElementById('vowelsGrid');
            grid.innerHTML = '';

            vowels.forEach(vowel => {
                const sound = VOWEL_PRONUNCIATION[vowel] || vowel;
                const card = createJamoCard(vowel, sound, 'vowel', 'ëª¨ìŒ');
                grid.appendChild(card);
            });
        }

        function createFinalCards() {
            // ê¸°ë³¸ ë°›ì¹¨ 7ê°œ (ã„±,ã„´,ã„¹,ã…,ã…‚,ã……,ã…‡)
            const finals = ['ã„±', 'ã„´', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡'];
            const grid = document.getElementById('finalsGrid');
            grid.innerHTML = '';

            finals.forEach(final => {
                const sound = FINAL_PRONUNCIATION[final] || final;
                const card = createJamoCard(final, sound, 'final', 'ë°›ì¹¨');
                grid.appendChild(card);
            });
        }

        function createJamoCard(jamo, sound, type, typeLabel) {
            const card = document.createElement('div');
            card.className = `jamo-card ${type}-card`;
            
            card.innerHTML = `
                <div class="jamo-card-jamo">${jamo}</div>
                <div class="jamo-card-sound">${sound}</div>
                <div class="jamo-card-type ${type}-type">${typeLabel}</div>
            `;

            card.addEventListener('click', () => {
                playJamoSound(sound, card);
                // íšìˆœ ëª¨ë‹¬ì°½ ì—´ê¸°
                setTimeout(() => {
                    openStrokeModal(jamo, sound, type);
                }, 500);
            });

            return card;
        }

        // íšìˆœ ëª¨ë‹¬ì°½ ê´€ë ¨ ë³€ìˆ˜ë“¤
        let currentJamo = '';
        let currentSound = '';
        let currentType = '';
        let canvas = null;
        let ctx = null;
        let isDrawing = false;
        let isPracticeMode = false;

       function openStrokeModal(jamo, sound, type) {
    console.log('ëª¨ë‹¬ ì—´ê¸°:', jamo, sound, type);
    currentJamo = jamo;
    currentSound = sound;
    currentType = type;

    document.getElementById('modalJamoTitle').textContent = jamo;
    document.getElementById('modalJamoSound').textContent = sound;
    document.getElementById('strokeOrderModal').classList.remove('hidden');

    // ì†Œë¦¬ ì¬ìƒ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    const soundReplayBtn = document.getElementById('soundReplayBtn');
    soundReplayBtn.removeEventListener('click', handleSoundReplay);
    soundReplayBtn.addEventListener('click', handleSoundReplay);

    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
    canvas = document.getElementById('strokeCanvas');
    ctx = canvas.getContext('2d');
    setupCanvas();
    
    // ê¸°ë³¸ìœ¼ë¡œ ì—°ìŠµí•˜ê¸° ëª¨ë“œ ì‹¤í–‰
    setTimeout(() => {
        practiceMode();
    }, 300);
    
    console.log('ëª¨ë‹¬ ì„¤ì • ì™„ë£Œ, currentSound:', currentSound);
}

        // ì†Œë¦¬ ì¬ìƒ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
        function handleSoundReplay(event) {
            event.preventDefault();
            console.log('ì†Œë¦¬ ì¬ìƒ ë²„íŠ¼ í´ë¦­ë¨, currentSound:', currentSound);
            try {
                if (currentSound) {
                    playModalSound(currentSound);
                } else {
                    console.error('currentSoundê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
                }
            } catch (error) {
                console.error('ì†Œë¦¬ ì¬ìƒ ì¤‘ ì˜¤ë¥˜:', error);
            }
        }

        // ëª¨ë‹¬ì°½ìš© ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
        function playModalSound(sound) {
            console.log('playModalSound í˜¸ì¶œ:', sound);
            
            // ê¸°ì¡´ ì¬ìƒ ì¤‘ë‹¨
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }

            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(sound);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.8;
                utterance.pitch = 1.2;
                utterance.volume = 1.0;

                utterance.onend = () => {
                    console.log('ëª¨ë‹¬ ì†Œë¦¬ ì¬ìƒ ì™„ë£Œ:', sound);
                };

                utterance.onerror = (e) => {
                    console.error('ëª¨ë‹¬ ì†Œë¦¬ ì¬ìƒ ì˜¤ë¥˜:', e);
                };

                console.log('ëª¨ë‹¬ ì†Œë¦¬ ì¬ìƒ ì‹œì‘:', sound);
                window.speechSynthesis.speak(utterance);
            }, 100);
        }

        function closeStrokeModal() {
            document.getElementById('strokeOrderModal').classList.add('hidden');
            if (canvas) {
                clearCanvas();
            }
        }

        function setupCanvas() {
            if (!canvas || !ctx) return;

            // ìº”ë²„ìŠ¤ ì„¤ì •
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.lineWidth = 8;
            
            // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼)
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            
            // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ (ë°ìŠ¤í¬íƒ‘)
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
        }

       function clearCanvas() {
    if (!ctx) return;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawGuideLines();
    
    // ì—°ìŠµ ëª¨ë“œì¼ ë•ŒëŠ” ì—°í•œ ê¸€ì”¨ ê°€ì´ë“œë„ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    if (isPracticeMode) {
        drawGuideCharacter();
    }
}

        function drawGuideLines() {
            if (!ctx) return;
            
            ctx.save();
            ctx.strokeStyle = '#e0e0e0';
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]);
            
            // ì¤‘ì•™ ì‹­ìì„ 
            ctx.beginPath();
            ctx.moveTo(canvas.width / 2, 0);
            ctx.lineTo(canvas.width / 2, canvas.height);
            ctx.moveTo(0, canvas.height / 2);
            ctx.lineTo(canvas.width, canvas.height / 2);
            ctx.stroke();
            
            ctx.restore();
        }

       
        function practiceMode() {
            clearCanvas();
            isPracticeMode = true;
            
            // ì—°í•œ ê¸€ì ê°€ì´ë“œ ê·¸ë¦¬ê¸°
            drawGuideCharacter();
        }

        function drawGuideCharacter() {
            if (!ctx) return;
            
            ctx.save();
            ctx.font = '200px "Malgun Gothic", Arial, sans-serif';
            ctx.fillStyle = 'rgba(200, 200, 200, 0.3)';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(currentJamo, canvas.width / 2, canvas.height / 2);
            ctx.restore();
        }

      
        function startDrawing(e) {
            if (!isPracticeMode) return;
            
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            
            ctx.strokeStyle = '#4facfe';
            ctx.lineWidth = 8;
            ctx.beginPath();
            ctx.moveTo(x, y);
        }

        function draw(e) {
            if (!isDrawing || !isPracticeMode) return;
            
            e.preventDefault();
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            
            ctx.lineTo(x, y);
            ctx.stroke();
        }

        function stopDrawing() {
            isDrawing = false;
        }

        // ë””ë²„ê¹…ì„ ìœ„í•œ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
        function testModalSound() {
            console.log('í…ŒìŠ¤íŠ¸ ì†Œë¦¬ ì¬ìƒ');
            playModalSound('í…ŒìŠ¤íŠ¸');
        }

        function replayModalSound() {
            playJamoSound(currentSound);
        }

        function playJamoSound(sound, cardElement) {
            // ê¸°ì¡´ ì¬ìƒ ì¤‘ë‹¨
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }

            // ëª¨ë“  ì¹´ë“œì˜ playing í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.jamo-card.playing').forEach(card => {
                card.classList.remove('playing');
            });

            // í˜„ì¬ ì¹´ë“œì— playing í´ë˜ìŠ¤ ì¶”ê°€
            cardElement.classList.add('playing');

            setTimeout(() => {
                const utterance = new SpeechSynthesisUtterance(sound);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.8;
                utterance.pitch = 1.2;
                utterance.volume = 1.0;

                const cleanup = () => {
                    cardElement.classList.remove('playing');
                };

                utterance.onend = cleanup;
                utterance.onerror = cleanup;

                // íƒ€ì„ì•„ì›ƒ ì•ˆì „ì¥ì¹˜
                setTimeout(cleanup, 2000);

                window.speechSynthesis.speak(utterance);
            }, 100);
        }
    </script>
</body>
</html>
