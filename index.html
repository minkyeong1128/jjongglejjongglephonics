<!doctypehtml>
   <html lang="ko">
    <meta charset="UTF-8">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <title>ì«‘ê¸€ì«‘ê¸€ íŒŒë‹‰ìŠ¤</title>
    
    <!-- Firebase SDK -->
   <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
// ====== ì™„ì „ ë¬´ë£Œ Web Audio API TTS (ì™¸ë¶€ ì˜ì¡´ì„± ì—†ìŒ) ======
(function() {
    console.log('ğŸµ Web Audio API TTS ì´ˆê¸°í™”');

    // Web Speech APIê°€ ì—†ê±°ë‚˜ Android WebViewì¸ ê²½ìš° ëŒ€ì²´
    const needsReplacement = !('speechSynthesis' in window) || 
                            /Android/.test(navigator.userAgent);

    if (needsReplacement) {
        console.log('ğŸ“± Web Audio API ëª¨ë“œ í™œì„±í™”');

        // SpeechSynthesisUtterance í˜¸í™˜ í´ë˜ìŠ¤
        window.SpeechSynthesisUtterance = function(text) {
            this.text = text || '';
            this.lang = 'ko-KR';
            this.rate = 1.0;
            this.pitch = 1.0;
            this.volume = 1.0;
            this.onstart = null;
            this.onend = null;
            this.onerror = null;
        };

        // speechSynthesis í˜¸í™˜ ê°ì²´
        window.speechSynthesis = {
            speaking: false,
            pending: false,
            paused: false,
            currentUtterance: null,

            speak: function(utterance) {
                console.log('ğŸ”Š ì¬ìƒ:', utterance.text);
                
                this.speaking = true;
                this.currentUtterance = utterance;

                if (utterance.onstart) {
                    setTimeout(utterance.onstart, 10);
                }

                try {
                    playWebAudioSound(utterance.text, utterance.rate, utterance.pitch, () => {
                        this.speaking = false;
                        if (utterance.onend) {
                            utterance.onend();
                        }
                    });
                } catch (error) {
                    console.error('ì¬ìƒ ì˜¤ë¥˜:', error);
                    this.speaking = false;
                    if (utterance.onerror) {
                        utterance.onerror(error);
                    }
                }
            },

            cancel: function() {
                console.log('ğŸ›‘ ì¬ìƒ ì¤‘ë‹¨');
                this.speaking = false;
                this.pending = false;
                this.currentUtterance = null;
            },

            pause: function() {
                this.paused = true;
            },

            resume: function() {
                this.paused = false;
            },

            getVoices: function() {
                return [{
                    name: 'Korean',
                    lang: 'ko-KR',
                    default: true
                }];
            }
        };

        console.log('âœ… Web Audio TTS ì„¤ì • ì™„ë£Œ');
    }

    // Web Audio APIë¡œ ì†Œë¦¬ ìƒì„±
    function playWebAudioSound(text, rate, pitch, onEndCallback) {
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            // í•œê¸€ ë°œìŒë³„ ì£¼íŒŒìˆ˜ ì„¤ì •
            const frequencyMap = {
                // ììŒ
                'ê·¸': [200, 400, 600], 'ë„': [220, 440, 660], 'ëŠ': [250, 500, 750],
                'ë“œ': [200, 400, 600], 'ëœ¨': [220, 440, 660], 'ë¥´': [280, 560, 840],
                'ë¯€': [220, 440, 660], 'ë¸Œ': [200, 400, 600], 'ì˜': [220, 440, 660],
                'ìŠ¤': [400, 800, 1200], 'ì“°': [450, 900, 1350], 'ì¦ˆ': [300, 600, 900],
                'ì¯”': [400, 800, 1200], 'ì¸ ': [450, 900, 1350], 'í¬': [350, 700, 1050],
                'íŠ¸': [350, 700, 1050], 'í”„': [400, 800, 1200], 'í': [300, 600, 900],
                
                // ëª¨ìŒ
                'ì•„': [440, 880, 1320], 'ì• ': [460, 920, 1380], 'ì•¼': [440, 990, 1440],
                'ì–˜': [460, 1010, 1520], 'ì–´': [400, 800, 1200], 'ì—': [420, 840, 1260],
                'ì—¬': [400, 900, 1350], 'ì˜ˆ': [420, 930, 1395], 'ì˜¤': [350, 700, 1050],
                'ì™€': [370, 740, 1110], 'ì™œ': [380, 760, 1140], 'ì™¸': [360, 720, 1080],
                'ìš”': [350, 790, 1185], 'ìš°': [300, 600, 900], 'ì›Œ': [320, 640, 960],
                'ì›¨': [330, 660, 990], 'ìœ„': [340, 680, 1020], 'ìœ ': [300, 690, 1035],
                'ìœ¼': [280, 560, 840], 'ìœ¼ì´': [290, 580, 870], 'ì´': [500, 1000, 1500],
                
                // ë°›ì¹¨
                'ìœ½': [180, 360, 540], 'ì€': [200, 400, 600], 'ì„': [220, 440, 660],
                'ìŒ': [200, 400, 600], 'ì': [180, 360, 540], 'ìƒ': [190, 380, 570],
                'ì‘': [210, 420, 630]
            };

            const frequencies = frequencyMap[text] || [440, 880, 1320];
            const duration = (0.3 / rate) * (text.length > 1 ? 1.2 : 1);
            
            // 3ê°œì˜ í•˜ëª¨ë‹‰ oscillator ìƒì„± (ë” í’ë¶€í•œ ì†Œë¦¬)
            for (let i = 0; i < 3; i++) {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(
                    frequencies[i] * pitch, 
                    audioContext.currentTime
                );
                oscillator.type = i === 0 ? 'sine' : 'triangle';
                
                const volume = [0.25, 0.12, 0.06][i]; // ê° í•˜ëª¨ë‹‰ ë³¼ë¥¨
                gainNode.gain.setValueAtTime(volume, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(
                    0.01, 
                    audioContext.currentTime + duration
                );
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            }
            
            // ì¢…ë£Œ ì½œë°±
            setTimeout(() => {
                if (onEndCallback) onEndCallback();
            }, duration * 1000);
            
        } catch (error) {
            console.error('Web Audio ì¬ìƒ ì˜¤ë¥˜:', error);
            if (onEndCallback) onEndCallback();
        }
    }

})();
</script>

    <style>
        *{margin:0;padding:0;box-sizing:border-box}body{font-family:Arial,sans-serif;background:#ffeb3b;min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px}.main-container{background:#fff;border-radius:25px;box-shadow:0 20px 40px rgba(0,0,0,.1);padding:40px;max-width:500px;width:100%;text-align:center;position:relative;overflow:hidden}.main-container::before{content:'';position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,rgba(255,255,255,.1),transparent);transform:rotate(45deg);animation:shine 3s infinite}@keyframes shine{0%{transform:translateX(-100%) translateY(-100%) rotate(45deg)}100%{transform:translateX(100%) translateY(100%) rotate(45deg)}}.character{font-size:80px;margin-top:15px;margin-bottom:10px;transform:translateY(20px)}.main-title{font-size:32px;font-weight:700;color:#4a5568;margin-bottom:15px;text-shadow:2px 2px 4px rgba(0,0,0,.1)}.main-subtitle{font-size:16px;color:#718096;margin-bottom:40px}.menu-buttons{display:flex;flex-direction:column;gap:20px;margin-bottom:30px}.menu-button{background:linear-gradient(135deg,#4facfe,#00f2fe);border:none;border-radius:20px;color:#fff;padding:20px 30px;font-size:18px;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 8px 16px rgba(79,172,254,.3);position:relative;overflow:hidden;-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none}.menu-button:hover{transform:translateY(-3px);box-shadow:0 12px 24px rgba(79,172,254,.4)}.menu-button.secondary{background:linear-gradient(135deg,#ff6b6b,#ff8e8e);box-shadow:0 8px 16px rgba(255,107,107,.3)}.menu-button.secondary:hover{box-shadow:0 12px 24px rgba(255,107,107,.4)}.menu-button.tertiary{background:linear-gradient(135deg,#28a745,#20c997);box-shadow:0 8px 16px rgba(40,167,69,.3)}.menu-button.tertiary:hover{box-shadow:0 12px 24px rgba(40,167,69,.4)}.back-button{position:absolute;top:20px;left:20px;background:#fff;border:none;border-radius:50%;width:30px;height:30px;color:#666;font-size:20px;cursor:pointer;transition:all .3s ease;box-shadow:0;-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none}.back-button:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(253,203,110,.4)}.hidden{display:none!important}.title{font-size:28px;font-weight:700;color:#4a5568;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,.1)}.subtitle{font-size:16px;color:#718096;margin-bottom:30px}.voice-section{margin-bottom:30px}.mic-button{width:80px;height:80px;border-radius:50%;border:none;background:linear-gradient(135deg,#ff6b6b,#ff8e8e);color:#fff;font-size:30px;cursor:pointer;transition:all .3s ease;box-shadow:0 8px 16px rgba(255,107,107,.3);position:relative;overflow:hidden;-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none}.mic-button:hover{transform:translateY(-2px);box-shadow:0 12px 24px rgba(255,107,107,.4)}.mic-button.recording{background:linear-gradient(135deg,#48bb78,#68d391);animation:pulse 1.5s infinite}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}.voice-status{margin-top:15px;font-size:14px;color:#666;min-height:20px}.result-section{margin:30px 0}.original-text{background:#f8f9fa;padding:20px;border-radius:15px;margin-bottom:20px;font-size:18px;font-weight:700;color:#1565c0;min-height:60px;display:flex;align-items:center;justify-content:center}.phonics-container{background:#f8f9fa;padding:20px;border-radius:15px;margin-bottom:20px}.phonics-grid{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:20px}.syllable-group{display:flex;flex-direction:column;align-items:center;margin:10px;padding:10px;border-radius:15px;background:rgba(255,255,255,.5);border:2px dashed #ccc}.syllable-label{font-size:18px;font-weight:700;color:#333;margin-bottom:10px;padding:5px 10px;background:#fff;border-radius:10px;box-shadow:0 2px 4px rgba(0,0,0,.1)}.syllable-phonics{display:flex;gap:5px;flex-wrap:wrap;justify-content:center}.phonics-item{background:#fff;border-radius:12px;padding:15px;box-shadow:0 4px 8px rgba(0,0,0,.1);cursor:pointer;transition:all .3s ease;min-width:70px;position:relative;border:2px solid transparent;-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none}.phonics-item:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,.15);background:#f8f9ff}.phonics-item.playing{background:linear-gradient(135deg,#fff59d,#ffeb3b);transform:scale(1.05)}.phonics-item.consonant{border-color:#ff6b6b;background:linear-gradient(135deg,#fff5f5,#fed7d7)}.phonics-item.vowel{border-color:#4299e1;background:linear-gradient(135deg,#f0f8ff,#bee3f8)}.phonics-item.final{border-color:#38a169;background:linear-gradient(135deg,#f0fff4,#c6f6d5)}.jamo{font-size:24px;font-weight:700;color:#2d3748;margin-bottom:8px;font-family:'Malgun Gothic',Arial,sans-serif}.pronunciation{font-size:14px;color:#4a5568;font-weight:500;margin-bottom:4px}.jamo-type{font-size:10px;color:#718096;font-style:italic;padding:2px 6px;border-radius:8px;display:inline-block}.jamo-type.consonant{background:#fed7d7;color:#c53030}.jamo-type.vowel{background:#bee3f8;color:#2b6cb0}.jamo-type.final{background:#c6f6d5;color:#276749}.controls{display:flex;justify-content:center;align-items:center;gap:15px;flex-wrap:wrap;margin-top:20px}.control-button{background:linear-gradient(135deg,#4facfe,#00f2fe);border:none;border-radius:50px;color:#fff;padding:12px 20px;font-size:14px;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 8px rgba(79,172,254,.3);-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none}.control-button:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(79,172,254,.4)}.control-button:disabled{opacity:.6;cursor:not-allowed;transform:none}.speed-control{display:flex;align-items:center;gap:10px;background:#fff;padding:10px 15px;border-radius:25px;box-shadow:0 4px 8px rgba(0,0,0,.1)}.speed-slider{width:100px;height:6px;border-radius:3px;background:#ddd;outline:0;-webkit-appearance:none}.speed-slider::-webkit-slider-thumb{-webkit-appearance:none;width:20px;height:20px;border-radius:50%;background:#4facfe;cursor:pointer}.reset-button{background:linear-gradient(135deg,#28a745,#20c997);border:none;border-radius:15px;color:#fff;padding:12px 20px;font-size:14px;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 8px rgba(253,203,110,.3);-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none}.reset-button:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(253,203,110,.4)}.loading{display:none;margin:20px 0}.spinner{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #4facfe;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.emoji{font-size:24px;margin:0 5px}.demo-section{margin-bottom:20px;padding:15px;background:#f8f9fa;border-radius:15px}.demo-button{background:#dee2e6;border:none;border-radius:25px;color:#666;padding:10px 16px;font-size:14px;cursor:pointer;margin:5px;transition:all .3s ease;-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none}.demo-button:hover{transform:translateY(-1px);box-shadow:0 4px 8px rgba(40,167,69,.3)}.legend{display:flex;justify-content:center;gap:15px;margin-bottom:15px;flex-wrap:wrap}.legend-item{display:flex;align-items:center;gap:5px;font-size:12px;color:#666}.legend-color{width:12px;height:12px;border-radius:3px}.legend-color.consonant{background:#fed7d7}.legend-color.vowel{background:#bee3f8}.legend-color.final{background:#c6f6d5}.mode-selection{margin-bottom:30px;display:flex;justify-content:center;gap:20px;flex-wrap:wrap}.mode-button{background:#fff;border:2px solid #ddd;border-radius:15px;padding:12px 20px;color:#666;font-size:14px;cursor:pointer;transition:all .3s ease;font-weight:700}.mode-button:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,.3)}.mode-button.active{background:#fff9c4;border-color:#ffeb3b}.score-board{display:flex;justify-content:space-between;margin-bottom:20px;padding:15px;background:#fff;border-radius:15px;color:#000;font-weight:400}.question-area{margin-bottom:30px}.question-number{font-size:16px;color:#718096;margin-bottom:10px}.word-image{width:200px;height:200px;margin:20px auto;border-radius:15px;background:#fff;position:relative;overflow:hidden;display:flex;align-items:center;justify-content:center}.word-image img{width:100%;height:100%;object-fit:cover;border-radius:12px}
.word-image .loading{font-size:2em;color:#5a67d8}
.word-image,.word-image *,.word-image div,.word-image span{text-decoration:none !important;text-decoration-line:none !important;text-decoration-color:transparent !important;text-decoration-style:none !important;text-decoration-thickness:0 !important;text-underline-offset:0 !important;text-decoration-skip:none !important;text-decoration-skip-ink:none !important;-webkit-text-decoration:none !important;-webkit-text-decoration-line:none !important;-webkit-text-decoration-color:transparent !important;-webkit-text-decoration-style:none !important;-webkit-text-underline-position:unset !important;-moz-text-decoration-line:none !important;-moz-text-decoration-color:transparent !important;-moz-text-decoration-style:none !important;background-image:none !important;border-bottom:none !important;border-top:none !important;box-shadow:none !important}
.audio-button{background:linear-gradient(135deg,#ff6b6b,#ff8e8e);border:none;border-radius:50%;width:80px;height:80px;color:#fff;font-size:2em;cursor:pointer;margin-bottom:30px;box-shadow:0 5px 15px rgba(255,107,107,.4);transition:all .3s ease}.audio-button:hover{transform:scale(1.1);box-shadow:0 8px 20px rgba(255,107,107,.6)}.choices{display:flex;justify-content:center;gap:20px;flex-wrap:wrap;margin-bottom:30px}.choice-button{background:#fff;border:2px solid #ddd;border-radius:15px;padding:10px 20px;font-size:1.3em;color:#666;cursor:pointer;transition:all .3s ease;min-width:80px;box-shadow:0 5px 15px rgba(0,0,0,.1);font-weight:700;margin:10px}.choice-button:hover{transform:translateY(-3px);box-shadow:0 8px 20px rgba(0,0,0,.3)}.choice-button.correct{background:linear-gradient(135deg,#28a745,#20c997);color:#fff}.choice-button.incorrect{background:linear-gradient(45deg,#ff416c,#ff4b2b);color:#fff}.feedback{margin-top:20px;padding:15px;border-radius:10px;font-size:1.1em;font-weight:700}.feedback.correct{background:linear-gradient(45deg,#d4edda,#c3e6cb);color:#155724;border:2px solid #c3e6cb}.feedback.incorrect{background:linear-gradient(45deg,#f8d7da,#f5c6cb);color:#721c24;border:2px solid #f5c6cb}.next-button{background:linear-gradient(135deg,#28a745,#20c997);border:none;border-radius:10px;padding:12px 20px;color:#fff;font-size:14px;cursor:pointer;margin-top:20px;transition:all .3s ease;font-weight:700}.result-screen{display:none;text-align:center}.final-score{font-size:1.2em;color:#000;margin-bottom:20px;text-shadow:2px 2px 4px rgba(0,0,0,.1);line-height:1.5}.retry-button{background:linear-gradient(135deg,#28a745,#20c997);border:none;border-radius:15px;padding:12px 20px;color:#fff;font-size:14px;cursor:pointer;margin-top:20px;transition:all .3s ease;font-weight:700}.wrong-answers{text-align:left;margin-top:20px;padding:20px;background:#f8f9fa;border-radius:10px;border-left:5px solid #dc3545}.wrong-answer-item{margin-bottom:15px;padding:10px;background:#fff;border-radius:5px;border:1px solid #dee2e6}.jamo-tabs{display:flex;justify-content:center;gap:10px;margin-bottom:30px;flex-wrap:wrap}.jamo-tab-button{background:#fff;border:2px solid #ddd;border-radius:15px;padding:12px 20px;color:#666;font-size:14px;cursor:pointer;transition:all .3s ease;font-weight:700}.jamo-tab-button:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,.2)}.jamo-tab-button.active{background:#fff9c4;border-color:#ffeb3b}.jamo-tab-content{margin-bottom:20px}.jamo-section-title{text-align:center;color:#4a5568;margin-bottom:20px;font-size:20px}.jamo-cards-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:15px;padding:20px;max-width:600px;margin:0 auto}.jamo-card{background:#fff;border:3px solid transparent;border-radius:15px;padding:20px;text-align:center;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 8px rgba(0,0,0,.1);position:relative;overflow:hidden;-webkit-tap-highlight-color:transparent;touch-action:manipulation;user-select:none}.jamo-card:hover{transform:translateY(-3px);box-shadow:0 6px 12px rgba(0,0,0,.15)}.jamo-card.playing{transform:scale(1.05);border-color:#ffeb3b;background:linear-gradient(135deg,#fff59d,#ffeb3b)}.jamo-card.consonant-card{border-color:#ff6b6b;background:linear-gradient(135deg,#fff5f5,#fed7d7)}.jamo-card.vowel-card{border-color:#4299e1;background:linear-gradient(135deg,#f0f8ff,#bee3f8)}.jamo-card.final-card{border-color:#38a169;background:linear-gradient(135deg,#f0fff4,#c6f6d5)}.jamo-card-jamo{font-size:32px;font-weight:700;color:#2d3748;margin-bottom:10px;font-family:'Malgun Gothic',Arial,sans-serif}.jamo-card-sound{font-size:16px;color:#4a5568;font-weight:500;margin-bottom:5px}.jamo-card-type{font-size:12px;color:#718096;padding:3px 8px;border-radius:10px;display:inline-block;font-weight:700}.jamo-card-type.consonant-type{background:#fed7d7;color:#c53030}.jamo-card-type.vowel-type{background:#bee3f8;color:#2b6cb0}.jamo-card-type.final-type{background:#c6f6d5;color:#276749}.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content{background:#fff;border-radius:20px;padding:30px;max-width:450px;width:90%;max-height:90%;overflow-y:auto;position:relative;box-shadow:0 20px 40px rgba(0,0,0,.3)}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;border-bottom:2px solid #f0f0f0;padding-bottom:15px}.modal-title{font-size:20px;font-weight:700;color:#2d3748;margin:0;font-family:'Malgun Gothic',Arial,sans-serif}.modal-close{background:0 0;border:none;font-size:30px;color:#999;cursor:pointer;padding:5px 10px;border-radius:50%;transition:all .3s ease}.modal-close:hover{background:#f0f0f0;color:#666}.stroke-info{display:flex;align-items:center;justify-content:center;margin-bottom:20px;padding:15px;background:linear-gradient(135deg,#f8f9fa,#e9ecef);border-radius:15px}.sound-replay-btn{background:linear-gradient(135deg,#ff6b6b,#ff8e8e);border:none;border-radius:25px;padding:12px 20px;color:#fff;font-size:14px;font-weight:700;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 8px rgba(255,107,107,.3)}.sound-replay-btn:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(255,107,107,.4)}.sound-replay-btn:hover{transform:scale(1.1)}.stroke-canvas-container{text-align:center;margin-bottom:20px}#strokeCanvas{border:3px solid #ddd;border-radius:15px;background:#fafafa;cursor:crosshair;touch-action:none}.stroke-controls{display:flex;justify-content:center;gap:10px;margin-top:15px;flex-wrap:wrap}.stroke-btn{background:linear-gradient(135deg,#4facfe,#00f2fe);border:none;border-radius:25px;color:#fff;padding:10px 15px;font-size:14px;cursor:pointer;transition:all .3s ease;font-weight:700}.stroke-btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(79,172,254,.3)}@media (max-width:480px){.main-container{padding:20px;margin:10px}.main-title{font-size:24px}.menu-button{padding:15px 20px;font-size:16px}.mic-button{width:70px;height:70px;font-size:25px}.phonics-grid{gap:8px}.phonics-item{min-width:60px;padding:12px}.controls{gap:10px}.speed-control{padding:8px 12px}.legend{gap:10px}.syllable-group{margin:5px;padding:8px}.mode-selection{gap:10px}.mode-button{padding:12px 18px;font-size:14px}.jamo-tabs{gap:5px}.jamo-tab-button{padding:10px 15px;font-size:12px}.jamo-cards-grid{grid-template-columns:repeat(auto-fit,minmax(80px,1fr));gap:10px;padding:15px}.jamo-card{padding:15px}.jamo-card-jamo{font-size:24px;margin-bottom:8px}.jamo-card-sound{font-size:14px;margin-bottom:4px}.jamo-card-type{font-size:10px;padding:2px 6px}.modal-content{padding:20px;max-width:95%}.modal-title{font-size:36px}.modal-close{font-size:24px}#strokeCanvas{width:100%;max-width:280px;height:280px}.stroke-controls{gap:8px}.stroke-btn{padding:8px 12px;font-size:12px}}
  
/* ë©”ì¸ ì»¨í…Œì´ë„ˆ ìˆ˜ì • */
        .main-container {
            position: relative;
            overflow: hidden;
        }
/* ë¡œê·¸ì¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .login-area {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            align-items: center;
            z-index: 100;
        }

    .login-btn {
            background: none;
            color: #333;
            border: none;
            padding: 8px 16px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .login-btn:hover {
            opacity: 0.7;
        }

        .logout-btn {
            background: none;
            color: #ff6b6b;
            border: none;
            padding: 8px 16px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s ease;
        }

        .logout-btn:hover {
            opacity: 0.7;
        }

   .stats-btn {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            font-size: 20px;
            padding: 8px;
            cursor: pointer;
            transition: transform 0.2s ease;
            color: inherit;
        }

        .stats-btn:hover {
            background: none !important;
            transform: scale(1.1);
        }

      .user-info {
            display: none;
            align-items: center;
            gap: 8px;
            font-size: 15px;
        }

        .user-nickname {
            font-weight: bold;
            color: #333;
        }

        /* ë¡œê·¸ì¸/íšŒì›ê°€ì… ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .auth-modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .auth-modal h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .auth-tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 14px;
            color: #666;
            border-bottom: 2px solid transparent;
        }

        .auth-tab.active {
            color: #4CAF50;
            border-bottom-color: #4CAF50;
        }

       .auth-form, #findForm {
    display: flex;
    flex-direction: column;
    gap: 15px;
    width: 100%;
}

.auth-form input, .auth-form select, #findForm input {
    width: 100%;
    box-sizing: border-box;
}

    .auth-form input, .auth-form select, #findForm input, #findForm button {
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
}

        .auth-form input:focus {
            outline: none;
            border-color: #4CAF50;
        }

    .auth-form button, #findForm button {
   width: 100%;
    box-sizing: border-box;
    background: #4CAF50;
    color: white;
    border: none;
    padding: 12px;
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.3s;
}

.auth-form button:hover, #findForm button:hover {
    background: #45a049;
}

.auth-links {
    display: flex;
    justify-content: flex-end;
    margin-top: 10px;
}

.link-btn {
    background: transparent !important;
    border: none !important;
    color: #ff6b6b !important;
    font-size: 12px;
    cursor: pointer;
    text-decoration: underline;
    box-shadow: none !important;
    outline: none !important;
}

.birthdate-container {
    display: flex;
    gap: 4px;
    width: 100% !important;
    max-width: 350px !important; /* ê°•ì œë¡œ ë„ˆë¹„ ì œí•œ */
    box-sizing: border-box !important;
  margin-top: 15px; /* ì´ë¦„ ì…ë ¥ì°½ê³¼ì˜ ê°„ê²© ì¶”ê°€ */
 margin-bottom: 15px; /* ì°¾ê¸° ë²„íŠ¼ê³¼ì˜ ê°„ê²© ì¶”ê°€ */
}

.birthdate-container select {
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    flex: 1;
    min-width: 0;
    box-sizing: border-box;
}

.birthdate-container select:first-child {
    flex: 1.3;
}

.birthdate-container select:focus {
    outline: none;
    border-color: #4CAF50;
}

.signup-birthdate-container {
    display: flex;
    gap: 4px;
    width: 100% !important;
    max-width: 350px !important;
    box-sizing: border-box !important;
    /* margin ì œê±° - .auth-formì˜ gapìœ¼ë¡œ ê°„ê²© í†µì¼ */
}

.signup-birthdate-container select {
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    flex: 1;
    min-width: 0;
    box-sizing: border-box;
}

.signup-birthdate-container select:first-child {
    flex: 1.3;
}

.signup-birthdate-container select:focus {
    outline: none;
    border-color: #4CAF50;
}

.link-btn:hover {
    color: #ff8e8e !important;
    background: transparent !important;
    box-shadow: none !important;
}

.link-btn:focus {
    color: #ff6b6b !important;
    background: transparent !important;
    box-shadow: none !important;
    outline: none !important;
}

.link-btn:active {
    color: #ff6b6b !important;
    background: transparent !important;
    box-shadow: none !important;
}

        .close-modal {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
/* í†µê³„ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
.stats-tabs {
    display: flex;
    margin-bottom: 20px;
    border-bottom: 2px solid #e0e0e0;
    gap: 5px;
}

.stats-tab {
    flex: 1;
    padding: 12px 8px;
    background: none;
    border: none;
    color: #666;
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s ease;
}

.stats-tab.active {
    color: #4facfe;
    border-bottom-color: #4facfe;
    background: linear-gradient(135deg, rgba(79, 172, 254, 0.1), rgba(0, 242, 254, 0.05));
}

.stats-tab:hover:not(.active) {
    color: #333;
    background: rgba(0, 0, 0, 0.05);
}

.stats-tab-content {
    display: none;
    animation: fadeIn 0.3s ease-in-out;
}

.stats-tab-content.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.stats-section-title {
    text-align: center;
    color: #4a5568;
    margin-bottom: 20px;
    font-size: 18px;
    font-weight: 700;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 15px;
    margin-bottom: 30px;
}

.stat-item {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 15px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
}

.stat-item:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
}

.stat-item.excellent {
    border-color: #38a169;
    background: linear-gradient(135deg, #f0fff4, #c6f6d5);
}

.stat-item.excellent::before {
    content: 'ğŸŒŸ';
    position: absolute;
    top: 5px;
    right: 8px;
    font-size: 14px;
}

.stat-item.good {
    border-color: #4299e1;
    background: linear-gradient(135deg, #f0f8ff, #bee3f8);
}

.stat-item.good::before {
    content: 'ğŸ‘';
    position: absolute;
    top: 5px;
    right: 8px;
    font-size: 14px;
}

.stat-item.average {
    border-color: #ed8936;
    background: linear-gradient(135deg, #fffaf0, #fbd38d);
}

.stat-item.average::before {
    content: 'âš¡';
    position: absolute;
    top: 5px;
    right: 8px;
    font-size: 14px;
}

.stat-item.needs-practice {
    border-color: #e53e3e;
    background: linear-gradient(135deg, #fff5f5, #fed7d7);
}

.stat-item.needs-practice::before {
    content: 'ğŸ¯';
    position: absolute;
    top: 5px;
    right: 8px;
    font-size: 14px;
}

.stat-item.no-data {
    border-color: #a0aec0;
    background: linear-gradient(135deg, #f7fafc, #edf2f7);
    opacity: 0.7;
}

.stat-item.no-data::before {
    content: 'â“';
    position: absolute;
    top: 5px;
    right: 8px;
    font-size: 14px;
}

.stat-jamo {
    font-size: 32px;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 10px;
    font-family: 'Malgun Gothic', Arial, sans-serif;
}

.stat-bar {
    width: 100%;
    height: 8px;
    background: #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 8px;
}

.stat-fill {
    height: 100%;
    background: linear-gradient(90deg, #4facfe, #00f2fe);
    border-radius: 4px;
    transition: width 1s ease-out;
}

.stat-percentage {
    font-size: 14px;
    font-weight: 600;
    color: #4a5568;
}

.practice-section {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    padding: 20px;
    border-radius: 15px;
    margin-top: 20px;
}

.practice-title {
    font-size: 16px;
    font-weight: 700;
    color: #4a5568;
    margin-bottom: 15px;
    text-align: center;
}

.practice-items {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
}

.practice-item {
    background: white;
    border: 2px solid #e53e3e;
    border-radius: 10px;
    padding: 8px 16px;
    font-size: 18px;
    font-weight: 700;
    color: #e53e3e;
    cursor: pointer;
    transition: all 0.3s ease;
    animation: pulse 2s infinite;
}

.practice-item:hover {
    background: #e53e3e;
    color: white;
    transform: scale(1.05);
}

@keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.02); }
}

/* ë°˜ì‘í˜• ë””ìì¸ */
@media (max-width: 480px) {
    .stats-tabs {
        flex-wrap: wrap;
        gap: 2px;
    }
    
    .stats-tab {
        font-size: 12px;
        padding: 8px 4px;
    }
    
    .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
        gap: 10px;
    }
    
    .stat-item {
        padding: 10px;
    }
    
    .stat-jamo {
        font-size: 24px;
        margin-bottom: 8px;
    }
    
    .practice-items {
        gap: 8px;
    }
    
    .practice-item {
        padding: 6px 12px;
        font-size: 16px;
    }
}

/* í†µê³„ ë°ì´í„° ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
.loading-stats {
    text-align: center;
    padding: 40px;
    color: #666;
}

.loading-stats::before {
    content: 'ğŸ“Š';
    display: block;
    font-size: 48px;
    margin-bottom: 15px;
    animation: bounce 1s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

#findForm .back-button {
    position: absolute;
    top: 15px;
    left: 15px;
    background: transparent !important;
    border: none !important;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    color: #666;
    font-size: 20px;
    cursor: pointer;
    transition: all .3s ease;
    box-shadow: none !important;
}

#findForm .back-button:hover {
    transform: translateY(-2px);
    background: transparent !important;
    box-shadow: none !important;
}

/* íƒˆí‡´ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
.withdraw-btn {
    background: none;
    color: #e74c3c;
    border: none;
    padding: 8px 16px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
    transition: opacity 0.3s ease;
}

.withdraw-btn:hover {
    opacity: 0.7;
}

/* íƒˆí‡´ í™•ì¸ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
.withdraw-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6);
    z-index: 1001;
    justify-content: center;
    align-items: center;
}

.withdraw-modal-content {
    background: white;
    padding: 30px;
    border-radius: 15px;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    text-align: center;
    position: relative;
}

.withdraw-modal h3 {
    color: #e74c3c;
    margin-bottom: 20px;
    font-size: 18px;
}

.withdraw-modal p {
    color: #666;
    line-height: 1.5;
    margin-bottom: 30px;
}

.withdraw-modal-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
}

.withdraw-confirm-btn, .withdraw-cancel-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
}

.withdraw-confirm-btn {
    background: #e74c3c;
    color: white;
}

.withdraw-confirm-btn:hover {
    background: #c0392b;
}

.withdraw-cancel-btn {
    background: #95a5a6;
    color: white;
}

.withdraw-cancel-btn:hover {
    background: #7f8c8d;
}
</style>
    <div class="main-container">
  <!-- ë¡œê·¸ì¸ ì˜ì—­ -->
        <div class="login-area">
            <div class="user-info" id="userInfo">
                <span class="user-nickname" id="userNickname"></span>
            </div>
            <button class="login-btn" id="loginBtn" onclick="showAuthModal()">ë¡œê·¸ì¸(íšŒì›ê°€ì…)</button>
            <button class="stats-btn" id="statsBtn" onclick="showStatsModal()" style="display: none;">ğŸ“Š</button>
            <button class="logout-btn" id="logoutBtn" onclick="logout()" style="display: none;">ë¡œê·¸ì•„ì›ƒ</button>
<button class="withdraw-btn" id="withdrawBtn" onclick="showWithdrawModal()" style="display: none;">íƒˆí‡´</button>
        </div>

        <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… ëª¨ë‹¬ -->
        <div class="auth-modal" id="authModal">
            <div class="auth-modal-content">
                <button class="close-modal" onclick="closeAuthModal()">Ã—</button>
                <h2>ì«‘ê¸€ì«‘ê¸€ íŒŒë‹‰ìŠ¤</h2>
                
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('login')">ë¡œê·¸ì¸</button>
                    <button class="auth-tab" onclick="switchAuthTab('signup')">íšŒì›ê°€ì…</button>
                </div>

                <form class="auth-form" id="authForm">
    <input type="text" id="username" placeholder="ì•„ì´ë””" required>
    <input type="password" id="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
    <input type="text" id="nickname" placeholder="ì´ë¦„" style="display: none;">
    <div class="signup-birthdate-container" style="display: none;">
    <select id="signupYear">
        <option value="">ì—°ë„</option>
    </select>
    <select id="signupMonth">
        <option value="">ì›”</option>
    </select>
    <select id="signupDay">
        <option value="">ì¼</option>
    </select>
</div>
    <button type="submit" id="authSubmitBtn">ë¡œê·¸ì¸</button>
   <div class="auth-links" id="authLinks">
    <button type="button" class="link-btn" onclick="showFindForm()">ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
</div>
</form>

<!-- ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í¼ -->
<div class="auth-form hidden" id="findForm">
    <button class="back-button" onclick="hideFindForm()">ğŸ”™</button>
    
      
    <form id="findFormContent">
        <input type="text" id="findName" placeholder="ì´ë¦„" required>
    <div class="birthdate-container">
    <select id="findYear" required>
        <option value="">ì—°ë„</option>
    </select>
    <select id="findMonth" required>
        <option value="">ì›”</option>
    </select>
    <select id="findDay" required>
        <option value="">ì¼</option>
    </select>
</div>
        <button type="submit" id="findSubmitBtn">ì°¾ê¸°</button>
    </form>
</div>
            </div>
        </div>
        <div id="mainMenu">
        <div class="character">
    <img alt="ì«‘ê¸€ì´" 
         src="https://raw.githubusercontent.com/minkyeong1128/main-image/main/images/rabbit.png" 
         style="width:150px;height:150px;object-fit:contain"
         loading="eager">
</div>
            <h1 class="main-title">ì«‘ê¸€ì«‘ê¸€ íŒŒë‹‰ìŠ¤</h1>
            <p class="main-subtitle">í•œê¸€ ì†Œë¦¬ ë†€ì´ë¥¼ ì‹œì‘í•´ë³´ì„¸ìš”!
            <div class="menu-buttons"><button class="menu-button tertiary" onclick="showJamoLearning()">ğŸ“ ììŒÂ·ëª¨ìŒ ë°°ìš°ê¸°<br><small>ììŒ, ëª¨ìŒ, ë°›ì¹¨ì„ í•˜ë‚˜ì”© ë°°ì›Œë³´ì„¸ìš”</small></button> <button class="menu-button" onclick="showSoundAnalysis()">ğŸ¤ ì†Œë¦¬ ë†€ì´<br><small>ë‹¨ì–´ë¥¼ ë§í•˜ë©´ ììŒÂ·ëª¨ìŒÂ·ë°›ì¹¨ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë“¤ë ¤ì¤˜ìš”</small></button> <button class="menu-button secondary" onclick="showSoundGame()">ğŸ® ì†Œë¦¬ ë§ì¶”ê¸° ê²Œì„<br><small>ì†Œë¦¬ë¥¼ ë“£ê³  ë§ëŠ” ë‹¨ì–´ë¥¼ ì°¾ì•„ë³´ì„¸ìš”</small></button></div>
        </div>
        <div class="hidden" id="soundAnalysisScreen"><button class="back-button" onclick="showMainMenu()">ğŸ”™</button>
            <h1 class="title">ğŸ¤ ì†Œë¦¬ ë†€ì´</h1>
            <p class="subtitle">ë‹¨ì–´ë¥¼ ë§í•˜ë©´ ììŒê³¼ ëª¨ìŒ, ë°›ì¹¨ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë“¤ë ¤ì¤„ê²Œìš”!
            <div class="demo-section">
                <p style="margin-bottom:10px;font-size:14px;color:#666">ì˜ˆì‹œ ë‹¨ì–´ë¡œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”:</p><button class="demo-button" onclick='testWord("ì‚¬ê³¼")'>ì‚¬ê³¼</button> <button class="demo-button" onclick='testWord("ë”¸ê¸°")'>ë”¸ê¸°</button> <button class="demo-button" onclick='testWord("ì­ˆê¾¸ë¯¸")'>ì­ˆê¾¸ë¯¸</button> <button class="demo-button" onclick='testWord("ë½€ë½€")'>ë½€ë½€</button> <button class="demo-button" onclick='testWord("í•™êµ")'>í•™êµ</button> <button class="demo-button" onclick='testWord("ì•ˆë…•")'>ì•ˆë…•</button>
            </div>
            <div class="voice-section"><button class="mic-button" id="micButton">ğŸ¤</button>
                <div class="voice-status" id="voiceStatus">ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”</div>
            </div>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ë¶„ì„ì¤‘ì´ì—ìš”... ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!
            </div>
            <div class="hidden result-section" id="resultSection">
                <div class="original-text" id="originalText"><span class="emoji">ğŸ’¬</span> ì—¬ê¸°ì— ì¸ì‹ëœ ë‹¨ì–´ê°€ ë‚˜íƒ€ë‚˜ìš” <span class="emoji">ğŸ’¬</span></div>
                <div class="phonics-container">
                    <h3 style="margin-bottom:15px;color:#f57c00">ììŒê³¼ ëª¨ìŒ, ë°›ì¹¨ìœ¼ë¡œ ë‚˜ëˆ„ì–´ë³´ê¸°</h3>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color consonant"></div><span>ììŒ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color vowel"></div><span>ëª¨ìŒ</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color final"></div><span>ë°›ì¹¨</span>
                        </div>
                    </div>
                    <div class="phonics-grid" id="phonicsGrid"></div>
                    <div class="controls"><button class="control-button" id="playAllButton">â–¶ï¸ ì „ì²´ ì¬ìƒ</button>
                            <div class="speed-control"><span>ğŸŒ</span> <input class="speed-slider" id="speedSlider" max="2.0" min="0.5" step="0.1" type="range" value="0.6"> <span>ğŸ°</span> <span id="speedDisplay">0.6x</span></div>
                    </div>
                </div><button class="reset-button" id="resetButton">ë‹¤ì‹œ ì‹œì‘</button>
            </div>
        </div>
        <div class="hidden" id="gameScreen"><button class="back-button" onclick="showMainMenu()">ğŸ”™</button>
            <h1 class="title">ğŸ® ì†Œë¦¬ ë§ì¶”ê¸° ê²Œì„</h1>
            <div class="question-area">
                <div class="question-number">ë‹¨ì–´ì˜ ììŒÂ·ëª¨ìŒÂ·ë°›ì¹¨ ì†Œë¦¬ë¥¼ ë“£ê³  ë§ëŠ” ë‹¨ì–´ë¥¼ ì„ íƒí•˜ì„¸ìš”!</div><br><br>
                <div class="mode-selection"><button class="active mode-button" onclick='setMode("noBatchim")' id="noBatchimMode">ë°›ì¹¨ ì—†ëŠ” ë‹¨ì–´</button> <button class="mode-button" onclick='setMode("batchim")' id="batchimMode">ë°›ì¹¨ ìˆëŠ” ë‹¨ì–´</button></div>
                <div id="gameArea">
                    <div class="score-board">
                        <div>ë¬¸ì œ: <span id="currentQuestion">1</span> / 10</div>
                        <div>ì ìˆ˜: <span id="score">0</span>ì </div>
                    </div>
                    <div class="word-image" id="wordImage">
                        <div class="icon icon-apple"></div>
                    </div><button class="audio-button" onclick="playAudio()" id="audioButton">ğŸ”Š</button>
                    <div class="choices" id="choices"></div>
                    <div class="hidden feedback" id="feedback"></div><button class="hidden next-button" onclick="nextQuestion()" id="nextButton">ë‹¤ìŒ ë¬¸ì œ</button>
                </div>
            </div>
            <div class="result-screen" id="resultScreen">
                <div class="final-score" id="finalScore"></div>
                <div class="wrong-answers" id="wrongAnswers"></div><button class="retry-button" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘</button>
            </div>
        </div>
        <div class="hidden" id="jamoLearningScreen"><button class="back-button" onclick="showMainMenu()">ğŸ”™</button>
            <h1 class="title">ğŸ“ ììŒÂ·ëª¨ìŒ ë°°ìš°ê¸°</h1>
            <p class="subtitle">ê° ê¸€ìë¥¼ í´ë¦­í•˜ë©´ ì†Œë¦¬ë¥¼ ë“¤ì„ ìˆ˜ ìˆì–´ìš”!
            <div class="jamo-tabs"><button class="jamo-tab-button active" onclick='showJamoTab("consonants")'>ììŒ (ã„±ã„´ã„·...)</button> <button class="jamo-tab-button" onclick='showJamoTab("vowels")'>ëª¨ìŒ (ã…ã…“ã…—...)</button> <button class="jamo-tab-button" onclick='showJamoTab("finals")'>ë°›ì¹¨ (ã„±ã„´ã„·...)</button></div>
            <div class="jamo-tab-content" id="consonantsTab">
                <h3 class="jamo-section-title">ììŒ (ì´ˆì„±)</h3>
                <div class="jamo-cards-grid" id="consonantsGrid"></div>
            </div>
            <div class="hidden jamo-tab-content" id="vowelsTab">
                <h3 class="jamo-section-title">ëª¨ìŒ (ì¤‘ì„±)</h3>
                <div class="jamo-cards-grid" id="vowelsGrid"></div>
            </div>
            <div class="hidden jamo-tab-content" id="finalsTab">
                <h3 class="jamo-section-title">ë°›ì¹¨ (ì¢…ì„±)</h3>
                <div class="jamo-cards-grid" id="finalsGrid"></div>
            </div>
        </div>
        <div class="hidden modal" id="strokeOrderModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 class="modal-title" id="modalJamoTitle">ã„±</h3><button class="modal-close" onclick="closeStrokeModal()">Ã—</button>
                </div>
                <div class="modal-body">
                    <div class="stroke-info"><button class="sound-replay-btn" id="soundReplayBtn">ğŸ”Š</button></div>
                    <div class="stroke-canvas-container"><canvas height="300" id="strokeCanvas" width="300"></canvas>
                        <div class="stroke-controls"><button class="stroke-btn" onclick="clearCanvas()">ğŸ§¹ ì§€ìš°ê¸°</button></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
<!-- í†µê³„ ëª¨ë‹¬ HTML (ê¸°ì¡´ strokeOrderModal ë‹¤ìŒì— ì¶”ê°€) -->
<div class="hidden modal" id="statsModal">
    <div class="modal-content" style="max-width: 600px; max-height: 80vh;">
        <div class="modal-header">
            <h3 class="modal-title">ğŸ“Š í•™ìŠµ í†µê³„</h3>
            <button class="modal-close" onclick="closeStatsModal()">Ã—</button>
        </div>
        <div class="modal-body">
            <!-- íƒ­ ë²„íŠ¼ë“¤ -->
            <div class="stats-tabs">
                <button class="stats-tab active" onclick="switchStatsTab('consonants')">ììŒ</button>
                <button class="stats-tab" onclick="switchStatsTab('doubleConsonants')">ìŒììŒ</button>
                <button class="stats-tab" onclick="switchStatsTab('vowels')">ëª¨ìŒ</button>
                <button class="stats-tab" onclick="switchStatsTab('doubleVowels')">ì´ì¤‘ëª¨ìŒ</button>
                <button class="stats-tab" onclick="switchStatsTab('finals')">ë°›ì¹¨</button>
            </div>
            
            <!-- íƒ­ ë‚´ìš©ë“¤ -->
            <div class="stats-tab-content active" id="consonantsStats">
                <h4 class="stats-section-title">ììŒ í•™ìŠµ í˜„í™©</h4>
                <div class="stats-grid" id="statsConsonantsGrid"></div>
              <div class="practice-section" id="statsConsonantsPractice"></div>
            </div>
            
            <div class="stats-tab-content" id="doubleConsonantsStats">
                <h4 class="stats-section-title">ìŒììŒ í•™ìŠµ í˜„í™©</h4>
              <div class="stats-grid" id="statsDoubleConsonantsGrid"></div>
                <div class="practice-section" id="statsDoubleConsonantsPractice"></div>
            </div>
            
            <div class="stats-tab-content" id="vowelsStats">
                <h4 class="stats-section-title">ëª¨ìŒ í•™ìŠµ í˜„í™©</h4>
               <div class="stats-grid" id="statsVowelsGrid"></div>
               <div class="practice-section" id="statsVowelsPractice"></div>
            </div>
            
            <div class="stats-tab-content" id="doubleVowelsStats">
                <h4 class="stats-section-title">ì´ì¤‘ëª¨ìŒ í•™ìŠµ í˜„í™©</h4>
               <div class="stats-grid" id="statsDoubleVowelsGrid"></div>
               <div class="practice-section" id="statsDoubleVowelsPractice"></div>
            </div>
            
            <div class="stats-tab-content" id="finalsStats">
                <h4 class="stats-section-title">ë°›ì¹¨ í•™ìŠµ í˜„í™©</h4>
               <div class="stats-grid" id="statsFinalsGrid"></div>
               <div class="practice-section" id="statsFinalsPractice"></div>
            </div>
        </div>
    </div>
</div>
<!-- íƒˆí‡´ í™•ì¸ ëª¨ë‹¬ (ì—¬ê¸°ì— ì¶”ê°€) -->
<div class="withdraw-modal" id="withdrawModal">
    <div class="withdraw-modal-content">
        <h3>âš ï¸ íšŒì› íƒˆí‡´</h3>
        <p>
            ì •ë§ë¡œ íƒˆí‡´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?<br>
            íƒˆí‡´ ì‹œ ëª¨ë“  í•™ìŠµ ê¸°ë¡ê³¼ í†µê³„ê°€<br>
            ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë˜ë©° ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
        </p>
        <div class="withdraw-modal-buttons">
            <button class="withdraw-cancel-btn" onclick="closeWithdrawModal()">ì·¨ì†Œ</button>
            <button class="withdraw-confirm-btn" onclick="confirmWithdraw()">íƒˆí‡´í•˜ê¸°</button>
        </div>
    </div>
</div>
    <script>
// Firebase ì„¤ì •
const firebaseConfig = {
  apiKey: "AIzaSyBCdB4toFgq2zzSD_Z7UaoSrVCtq8UqdBs",
  authDomain: "hangul-phonics.firebaseapp.com",
  projectId: "hangul-phonics",
  storageBucket: "hangul-phonics.firebasestorage.app",
  messagingSenderId: "608578910312",
  appId: "1:608578910312:web:0a7041bc78931e2f5023dd"
};

// Firebase ì´ˆê¸°í™” (ê°œì„ ëœ ë²„ì „)
let db = null;

try {
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
        console.log('Firebase ì•± ì´ˆê¸°í™” ì™„ë£Œ');
    } else {
        console.log('Firebase ì•± ì´ë¯¸ ì´ˆê¸°í™”ë¨');
    }
    
    db = firebase.firestore();
    console.log('Firestore ì´ˆê¸°í™” ì™„ë£Œ');
    
} catch (error) {
    console.error('Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
    alert('ì„œë¹„ìŠ¤ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
}

// ì‚¬ìš©ì ë°ì´í„° ê´€ë¦¬
let currentUser = null;
let currentAuthMode = 'login';

// Firestoreì—ì„œ ì‚¬ìš©ì ë°ì´í„° ì½ê¸°
async function getUserData(username) {
    try {
        if (!db) {
            console.error('Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            return null;
        }
        
        const doc = await db.collection('users').doc(username).get();
        
        if (doc.exists) {  // exists() ëŒ€ì‹  exists ì‚¬ìš©
            const data = doc.data();
            console.log('ë°ì´í„° ë¡œë“œ ì„±ê³µ:', username);
            return data;
        } else {
            console.log('ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', username);
            return null;
        }
    } catch (error) {
        console.error('ë°ì´í„° ì½ê¸° ì˜¤ë¥˜:', error);
        
        if (error.code === 'unavailable') {
            alert('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
        
        return null;
    }
}

// Firestoreì— ì‚¬ìš©ì ë°ì´í„° ì €ì¥
async function saveUserData(username, userData) {
    try {
        if (!db) {
            console.error('Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            return false;
        }
        
        await db.collection('users').doc(username).set(userData);
        console.log('ì‚¬ìš©ì ë°ì´í„° ì €ì¥ ì„±ê³µ:', username);
        return true;
    } catch (error) {
        console.error('ë°ì´í„° ì €ì¥ ì˜¤ë¥˜:', error);
        
        if (error.code === 'permission-denied') {
            alert('ë°ì´í„° ì €ì¥ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.');
        } else if (error.code === 'unavailable') {
            alert('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
        }
        
        return false;
    }
}

// Firestoreì—ì„œ ì‚¬ìš©ì í†µê³„ ì—…ë°ì´íŠ¸
async function updateUserStats(username, stats) {
    try {
        await db.collection('users').doc(username).update({ stats: stats });
        return true;
    } catch (error) {
        console.error('í†µê³„ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
        return false;
    }
}
        // ë¡œê·¸ì¸/íšŒì›ê°€ì… ê´€ë ¨ í•¨ìˆ˜ë“¤
      function showAuthModal() {
    console.log('ëª¨ë‹¬ ì—´ê¸° ì‹œì‘'); // ë””ë²„ê¹…ìš©
    
    document.getElementById('authModal').style.display = 'flex';
    
    // ë¡œê·¸ì¸/íšŒì›ê°€ì… íƒ­ ë‹¤ì‹œ ë³´ì´ê¸° (í˜¹ì‹œ ìˆ¨ê²¨ì¡Œì„ ê²½ìš° ëŒ€ë¹„)
    const authTabs = document.querySelector('.auth-tabs');
    if (authTabs) {
        authTabs.style.display = 'flex';
    }
    
    // ê¸°ë³¸ê°’ìœ¼ë¡œ ë¡œê·¸ì¸ íƒ­ ì„¤ì • (ë” ì•ˆì „í•˜ê²Œ)
    if (!currentAuthMode) {
        currentAuthMode = 'login';
    }
    switchAuthTab(currentAuthMode);
    
    // í¼ ë‚´ìš©ë„ ì´ˆê¸°í™”
    document.getElementById('authForm').reset();
    
    // ì°¾ê¸° í¼ì´ ì—´ë ¤ìˆë‹¤ë©´ ìˆ¨ê¸°ê¸°
    document.getElementById('authForm').classList.remove('hidden');
    document.getElementById('findForm').classList.add('hidden');
    
    // ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” (ëª¨ë‹¬ì´ ì™„ì „íˆ ë Œë”ë§ëœ í›„)
    setTimeout(() => {
        console.log('ëª¨ë‹¬ ë Œë”ë§ í›„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì‹œì‘'); // ë””ë²„ê¹…ìš©
        initializeBirthdateDropdowns();
    }, 200); // 200ms ëŒ€ê¸° í›„ ì´ˆê¸°í™”
    
    console.log('ëª¨ë‹¬ ì—´ê¸° ì™„ë£Œ'); // ë””ë²„ê¹…ìš©
}


        function closeAuthModal() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('authForm').reset();
        }

  function switchAuthTab(mode) {
    console.log(`íƒ­ ì „í™˜: ${mode}`); // ë””ë²„ê¹…ìš©
    
    currentAuthMode = mode;
    
    // ë” ì•ˆì „í•œ ìš”ì†Œ ì„ íƒ ë°©ë²•
    const authTabs = document.querySelectorAll('.auth-tab');
    if (authTabs.length < 2) {
        console.error('auth-tab ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    const loginTab = authTabs[0];
    const signupTab = authTabs[1];
    const nicknameField = document.getElementById('nickname');
    const authLinks = document.getElementById('authLinks');
    const submitBtn = document.getElementById('authSubmitBtn');
    const birthdateContainer = document.querySelector('.signup-birthdate-container');
    
    // í•„ìˆ˜ ìš”ì†Œë“¤ì´ ëª¨ë‘ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
    if (!loginTab || !signupTab || !nicknameField || !authLinks || !submitBtn || !birthdateContainer) {
        console.error('í•„ìš”í•œ DOM ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        return;
    }
    
    if (mode === 'login') {
        loginTab.classList.add('active');
        signupTab.classList.remove('active');
        birthdateContainer.style.display = 'none';
        nicknameField.style.display = 'none';
        nicknameField.required = false;
        authLinks.style.display = 'flex';
        submitBtn.textContent = 'ë¡œê·¸ì¸';
    } else {
        loginTab.classList.remove('active');
        signupTab.classList.add('active');
        birthdateContainer.style.display = 'flex';
        nicknameField.style.display = 'block';
        nicknameField.required = true;
        authLinks.style.display = 'none';
        submitBtn.textContent = 'íšŒì›ê°€ì…';
        
        // íšŒì›ê°€ì… íƒ­ìœ¼ë¡œ ì „í™˜ë  ë•Œ ë“œë¡­ë‹¤ìš´ ë‹¤ì‹œ ì´ˆê¸°í™”
        setTimeout(() => {
            console.log('íšŒì›ê°€ì… íƒ­ ì „í™˜ í›„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”'); // ë””ë²„ê¹…ìš©
            initializeBirthdateDropdowns();
        }, 100);
    }
}

async function login(username, password) {
    try {
        const userData = await getUserData(username);
        
        // ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš°
        if (!userData) {
            return { success: false, message: 'ê°€ì…ë˜ì§€ ì•Šì€ ì•„ì´ë””ì…ë‹ˆë‹¤.' };
        }
        
        // ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦° ê²½ìš°
        if (userData.password !== password) {
            return { success: false, message: 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.' };
        }
        
        // ë¡œê·¸ì¸ ì„±ê³µ
        currentUser = {
            username: username,
            nickname: userData.nickname,
            stats: userData.stats || {
                consonantErrors: {},
                vowelErrors: {},
                finalErrors: {},
                totalAttempts: 0,
                correctAttempts: 0
            }
        };
        updateLoginUI();
        closeAuthModal();
        // ë¡œì»¬ì— í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì €ì¥ (ë¡œê·¸ì•„ì›ƒí•  ë•Œê¹Œì§€ ìœ ì§€)
        localStorage.setItem('currentUser', JSON.stringify({
            username: currentUser.username
        }));
        return { success: true };
    } catch (error) {
        console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
        return { success: false, message: 'ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.' };
    }
}
    async function signup(username, password, nickname, birthdate) {
    try {
        // ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì‚¬ìš©ìì¸ì§€ í™•ì¸
        const existingUser = await getUserData(username);
        if (existingUser) {
            return false;
        }
        
        const newUserData = {
            password: password,
            nickname: nickname,
            birthdate: birthdate, // birthdate ì¶”ê°€
            stats: {
                consonantErrors: {},
                vowelErrors: {},
                finalErrors: {},
                totalAttempts: 0,
                correctAttempts: 0
            },
            createdAt: new Date()
        };
        
        const success = await saveUserData(username, newUserData);
        if (success) {
            currentUser = {
                username: username,
                nickname: nickname,
                stats: newUserData.stats
            };
            
            updateLoginUI();
            closeAuthModal();
       // ë¡œì»¬ì— í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì €ì¥ (ë¡œê·¸ì•„ì›ƒí•  ë•Œê¹Œì§€ ìœ ì§€)
localStorage.setItem('currentUser', JSON.stringify({
    username: currentUser.username
}));
            return true;
        }
        return false;
    } catch (error) {
        console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
        return false;
    }
}

 function logout() {
    currentUser = null;
    localStorage.removeItem('currentUser');
    updateLoginUI();
}

        function updateLoginUI() {
            const loginBtn = document.getElementById('loginBtn');
            const logoutBtn = document.getElementById('logoutBtn');
 const withdrawBtn = document.getElementById('withdrawBtn');
            const statsBtn = document.getElementById('statsBtn');
            const userInfo = document.getElementById('userInfo');
            const userNickname = document.getElementById('userNickname');

            if (currentUser) {
                loginBtn.style.display = 'none';
                logoutBtn.style.display = 'inline-block';
withdrawBtn.style.display = 'inline-block';
                statsBtn.style.display = 'inline-block';
                userInfo.style.display = 'flex';
               userNickname.textContent = currentUser.nickname;
            } else {
                loginBtn.style.display = 'inline-block';
                logoutBtn.style.display = 'none';
withdrawBtn.style.display = 'none';
                statsBtn.style.display = 'none';
                userInfo.style.display = 'none';
            }
        }

function showStatsModal() {
    if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.');
        return;
    }
    
    document.getElementById('statsModal').classList.remove('hidden');
    
    // ëª¨ë“  ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
    document.querySelectorAll('.stats-grid').forEach(grid => {
        grid.innerHTML = '';
    });
    
    generateStatsData();
}

function closeStatsModal() {
    document.getElementById('statsModal').classList.add('hidden');
}

function switchStatsTab(tabName) {
    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
    document.querySelectorAll('.stats-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    document.querySelectorAll('.stats-tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
   // ì„ íƒëœ íƒ­ í™œì„±í™” - event.target ëŒ€ì‹  ë‹¤ë¥¸ ë°©ë²• ì‚¬ìš©
    document.querySelector(`[onclick="switchStatsTab('${tabName}')"]`).classList.add('active');
    document.getElementById(tabName + 'Stats').classList.add('active');
    
  // í•´ë‹¹ íƒ­ì˜ ë°ì´í„° ìƒì„± (í•­ìƒ ìƒˆë¡œ ìƒì„±)
generateStatsDataForTab(tabName);
}

// íƒ­ë³„ í†µê³„ ë°ì´í„° ìƒì„±
function generateStatsDataForTab(tabName) {
    let items = [];
    let correctData = {};
    let totalData = {};
    
    // íƒ­ë³„ ê¸€ì ëª©ë¡ ì •ì˜
    switch(tabName) {
        case 'consonants':
            items = ['ã„±', 'ã„´', 'ã„·', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
            break;
        case 'doubleConsonants':
            items = ['ã„²', 'ã„¸', 'ã…ƒ', 'ã…†', 'ã…‰'];
            break;
        case 'vowels':
            items = ['ã…', 'ã…‘', 'ã…“', 'ã…•', 'ã…—', 'ã…›', 'ã…œ', 'ã… ', 'ã…¡', 'ã…£'];
            break;
        case 'doubleVowels':
            items = ['ã…', 'ã…’', 'ã…”', 'ã…–', 'ã…˜', 'ã…™', 'ã…š', 'ã…', 'ã…', 'ã…Ÿ', 'ã…¢'];
            break;
        case 'finals':
            items = ['ã„±', 'ã„´', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡'];
            break;
        default:
            items = [];
    }
    
    // ì‚¬ìš©ì ë°ì´í„°ê°€ ìˆìœ¼ë©´ ê°€ì ¸ì˜¤ê¸°
    if (currentUser && currentUser.stats) {
        if (tabName === 'consonants' || tabName === 'doubleConsonants') {
            correctData = currentUser.stats.consonantCorrect || {};
            totalData = currentUser.stats.consonantTotal || {};
        } else if (tabName === 'vowels' || tabName === 'doubleVowels') {
            correctData = currentUser.stats.vowelCorrect || {};
            totalData = currentUser.stats.vowelTotal || {};
        } else if (tabName === 'finals') {
            correctData = currentUser.stats.finalCorrect || {};
            totalData = currentUser.stats.finalTotal || {};
        }
    }
    
    console.log(`${tabName} íƒ­ - ê¸€ì ìˆ˜:`, items.length, 'ê¸€ìë“¤:', items); // ë””ë²„ê¹…ìš©
    
    generateStatsGrid(tabName, items, correctData, totalData);
}

function generateStatsData() {
    // í•­ìƒ ì²« ë²ˆì§¸ íƒ­(ììŒ) ë°ì´í„° ìƒì„± (ì‚¬ìš©ìê°€ ì—†ì–´ë„)
    generateStatsDataForTab('consonants');
}

function generateStatsGrid(type, items, correctData, totalData) {
    const grid = document.getElementById('stats' + type.charAt(0).toUpperCase() + type.slice(1) + 'Grid');
    const practiceSection = document.getElementById('stats' + type.charAt(0).toUpperCase() + type.slice(1) + 'Practice');

    // null ì²´í¬ ì¶”ê°€
    if (!grid) {
        console.error(`Required elements not found for type: ${type}`);
        return;
    }
    
    grid.innerHTML = '';
    
    // practiceSectionì´ ìˆë‹¤ë©´ ìˆ¨ê¸°ê¸°
    if (practiceSection) {
        practiceSection.style.display = 'none';
    }
    
    items.forEach(item => {
        const correctCount = correctData[item] || 0;
        const totalCount = totalData[item] || 0;
        
      // í¼ì„¼íŠ¸ ê³„ì‚° (1íšŒë‹¹ 2%, ìµœëŒ€ 100%)
const itemType = (type === 'consonants' || type === 'doubleConsonants') ? 'consonant' : 
                (type === 'vowels' || type === 'doubleVowels') ? 'vowel' : 'final';
const accuracy = calculatePercentage(item, itemType);
        
        const statItem = document.createElement('div');
        statItem.className = 'stat-item';
        
       // ì •í™•ë„ì— ë”°ë¥¸ í´ë˜ìŠ¤ ì„¤ì • (ë” ì—„ê²©í•œ ê¸°ì¤€)
        if (totalCount === 0) {
            statItem.classList.add('no-data');
        } else if (accuracy >= 80) {
            statItem.classList.add('excellent');
        } else if (accuracy >= 60) {
            statItem.classList.add('good');
        } else if (accuracy >= 30) {
            statItem.classList.add('average');
        } else {
            statItem.classList.add('needs-practice');
        }
        
      // ì‹¤ì œ ì´ í•™ìŠµ íšŸìˆ˜ ê°€ì ¸ì˜¤ê¸°
        const totalKey = itemType === 'consonant' ? 'consonantTotal' : 
                        itemType === 'vowel' ? 'vowelTotal' : 'finalTotal';
        const actualTotalCount = (currentUser.stats[totalKey] && currentUser.stats[totalKey][item]) || 0;
        
        // í•™ìŠµ íšŸìˆ˜ í‘œì‹œ
        let statusText = '';
        if (actualTotalCount === 0) {
            statusText = 'ë¯¸í•™ìŠµ';
        } else if (actualTotalCount < 10) {
            statusText = 'ì´ˆê¸‰';
        } else if (actualTotalCount < 25) {
            statusText = 'ì¤‘ê¸‰';
        } else if (actualTotalCount < 40) {
            statusText = 'ê³ ê¸‰';
        } else if (actualTotalCount >= 50) {
            statusText = 'ë§ˆìŠ¤í„°';
        } else {
            statusText = 'ìƒê¸‰';
        }
        
        statItem.innerHTML = `
            <div class="stat-jamo">${item}</div>
            <div class="stat-bar">
                <div class="stat-fill" style="width: ${accuracy}%"></div>
            </div>
            <div class="stat-percentage">${accuracy}%</div>
        <div style="font-size: 10px; color: #666; margin-top: 5px;">
                ${statusText} (${actualTotalCount}íšŒ)
            </div>
        `;
        
        grid.appendChild(statItem);
    });
}

        let audioPlayback = null;
// í†µí•© ìŒì„± ì¬ìƒ í•¨ìˆ˜ (ëª¨ë“  í™”ë©´ì—ì„œ ì‚¬ìš©)
function playUnifiedSound(sound, element = null) {
    console.log('í†µí•© ìŒì„± ì¬ìƒ:', sound);
    
    if (window.speechSynthesis.speaking) {
        window.speechSynthesis.cancel();
    }

    setTimeout(() => {
        const utterance = new SpeechSynthesisUtterance(sound);
        utterance.lang = 'ko-KR';
        
        if (sound === 'ê·¸') {
            utterance.rate = 0.4;
            utterance.pitch = 0.8;
        } else if (sound === 'í¬') {
            utterance.rate = 0.4;
            utterance.pitch = 1.4;
        } else if (sound === 'ë“œ') {
            utterance.rate = 0.4;
            utterance.pitch = 0.8;
        } else if (sound === 'íŠ¸') {
            utterance.rate = 0.4;
            utterance.pitch = 1.4;
        } else if (sound === 'ì¦ˆ') {
            utterance.rate = 0.4;
            utterance.pitch = 0.9;
        } else if (sound === 'ì¸ ') {
            utterance.rate = 0.4;
            utterance.pitch = 1.3;
        } else if (sound === 'ë¸Œ') {
            utterance.rate = 0.4;
            utterance.pitch = 0.8;
        } else if (sound === 'í”„') {
            utterance.rate = 0.4;
            utterance.pitch = 1.5;
        } else if (sound === 'ìœ½') {
            utterance.rate = 0.2;
            utterance.pitch = 0.4;
            utterance.volume = 0.9;
        } else if (sound === 'ìƒ') {
               utterance.rate = 0.35;
            utterance.pitch = 1.2;
            utterance.volume = 1.0;
        } else if (sound === 'ìœ¼ì´') {
            utterance.rate = 1.2;
            utterance.pitch = 0.8;
            utterance.volume = 1.0;
 } else if (sound === 'ìš”') {
            utterance.rate = 0.6;
            utterance.pitch = 1.4;
            utterance.volume = 1.0;
        } else {
            utterance.rate = 0.8;
            utterance.pitch = 1.2;
        }
        
        utterance.volume = 1.0;

        if (element) {
            element.classList.add('playing');
            
            const cleanup = () => {
                element.classList.remove('playing');
            };
            
            utterance.onend = cleanup;
            utterance.onerror = cleanup;
            setTimeout(cleanup, 3000);
        }

        window.speechSynthesis.speak(utterance);
    }, 100);
}
                // ì „ì—­ ë³€ìˆ˜
                let currentApp = null;
                let gameState = {
                    currentMode: 'noBatchim',
                    currentQuestionIndex: 0,
                    score: 0,
                    wrongAnswers: [],
                    isAnswered: false,
                    currentQuestion: null,
                    usedWords: [],
                    availableWords: []
                };
        
                // í™”ë©´ ì „í™˜ í•¨ìˆ˜ë“¤
                function showMainMenu() {
    document.getElementById('mainMenu').classList.remove('hidden');
    document.getElementById('soundAnalysisScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.add('hidden');
    document.getElementById('jamoLearningScreen').classList.add('hidden');
    
    // ë¡œê·¸ì¸ ì˜ì—­ í‘œì‹œ
    document.querySelector('.login-area').style.display = 'flex';
    
  // ëª¨ë“  ìŒì„± ì¬ìƒ ì™„ì „íˆ ì¤‘ë‹¨
        if (window.speechSynthesis) {
            window.speechSynthesis.cancel();
            // í•œ ë²ˆ ë” í™•ì‹¤íˆ ì¤‘ë‹¨
            setTimeout(() => {
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }
            }, 100);
        }
        
        // ê²Œì„ì˜ ì˜¤ë””ì˜¤ ì¬ìƒ ì¤‘ë‹¨
        if (typeof stopAudioPlayback === 'function') {
            stopAudioPlayback();
        }

// ì¶”ê°€ë¡œ ê²Œì„ ê´€ë ¨ ëª¨ë“  ìŒì„± ì¬ìƒ ì¤‘ë‹¨
if (audioPlayback && audioPlayback.stop) {
    audioPlayback.stop();
    audioPlayback = null;
}
                    
                    // ì†Œë¦¬ ë¶„ì„ ì•± ë¦¬ì…‹
                    if (currentApp && currentApp.resetApp) {
                        currentApp.resetApp();
                    }
                }
       function showSoundAnalysis() {
    // ë¡œê·¸ì¸ ì²´í¬
    if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('soundAnalysisScreen').classList.remove('hidden');
    document.getElementById('gameScreen').classList.add('hidden');
    document.getElementById('jamoLearningScreen').classList.add('hidden');
    
    // ë¡œê·¸ì¸ ì˜ì—­ ìˆ¨ê¸°ê¸°
    document.querySelector('.login-area').style.display = 'none';
                    
    // ì†Œë¦¬ ë¶„ì„ ì•± ì´ˆê¸°í™”
    if (!currentApp) {
        currentApp = new HangulPhonicsApp();
    }
}
        
             function showSoundGame() {
    // ë¡œê·¸ì¸ ì²´í¬
    if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('soundAnalysisScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.remove('hidden');
    document.getElementById('jamoLearningScreen').classList.add('hidden');
    
    // ë¡œê·¸ì¸ ì˜ì—­ ìˆ¨ê¸°ê¸°
    document.querySelector('.login-area').style.display = 'none';
    
    // ê²Œì„ ìƒíƒœ ì™„ì „ ì´ˆê¸°í™”
    gameState.currentQuestionIndex = 0;
    gameState.score = 0;
    gameState.wrongAnswers = [];
    gameState.isAnswered = false;
    gameState.currentQuestion = null;
    gameState.usedWords = [];
    gameState.availableWords = [];
    
    // UI ì´ˆê¸°í™”
    document.getElementById('score').textContent = '0';
    document.getElementById('gameArea').style.display = 'block';
    document.getElementById('resultScreen').style.display = 'none';
    
    // ê²Œì„ ì‹œì‘
    displayQuestion();
    setTimeout(playAudio, 1000);
}
        
          function showJamoLearning() {
    // ë¡œê·¸ì¸ ì²´í¬
    if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
        return;
    }
    
    document.getElementById('mainMenu').classList.add('hidden');
    document.getElementById('soundAnalysisScreen').classList.add('hidden');
    document.getElementById('gameScreen').classList.add('hidden');
    document.getElementById('jamoLearningScreen').classList.remove('hidden');
    
    // ë¡œê·¸ì¸ ì˜ì—­ ìˆ¨ê¸°ê¸°
    document.querySelector('.login-area').style.display = 'none';
                    
    // ììŒÂ·ëª¨ìŒ í•™ìŠµ ì´ˆê¸°í™”
    initializeJamoLearning();
}
        
                // í•œê¸€ íŒŒë‹‰ìŠ¤ ì•± í´ë˜ìŠ¤ (ê¸°ì¡´ ì½”ë“œ)
                class HangulPhonicsApp {
                    constructor() {
                        this.recognition = null;
                        this.speechSynthesis = window.speechSynthesis;
                        this.currentSpeed = 0.6;
                        this.isPlaying = false;
                        this.currentData = null;
                        this.syllableGroups = [];
                        this.playingIndex = -1;
        
        this.isRecognizing = false;
            this.lastProcessedText = '';
            this.processingTimeout = null;
                        
                        this.initializeElements();
                        this.initializeEventListeners();
                        this.initializeSpeechRecognition();
                        this.checkMicrophonePermission();
                        
                        this.initializeHangulConstants();
// ëª¨ë°”ì¼ì—ì„œ í˜ì´ì§€ visibility ë³€ê²½ ì‹œ ì¬ìƒ ì¤‘ë‹¨ ë°©ì§€
if ('undefined' !== typeof document) {
    document.addEventListener('visibilitychange', () => {
        if (document.hidden && this.isPlaying) {
            // ë°±ê·¸ë¼ìš´ë“œë¡œ ì „í™˜ë  ë•Œ ì¬ìƒ ì¤‘ë‹¨
            console.log('í˜ì´ì§€ê°€ ë°±ê·¸ë¼ìš´ë“œë¡œ ì „í™˜ë˜ì–´ ì¬ìƒ ì¤‘ë‹¨');
            this.isPlaying = false;
            if (this.speechSynthesis.speaking) {
                this.speechSynthesis.cancel();
            }
        }
    });
}

// ëª¨ë°”ì¼ì—ì„œ ìŒì„± í•©ì„± ì¤‘ë‹¨ ì´ë²¤íŠ¸ ê°ì§€
if ('speechSynthesis' in window) {
    // ìŒì„± í•©ì„±ì´ ì˜ˆê¸°ì¹˜ ì•Šê²Œ ì¤‘ë‹¨ë  ë•Œ ì²˜ë¦¬
    const originalCancel = this.speechSynthesis.cancel.bind(this.speechSynthesis);
    this.speechSynthesis.cancel = () => {
        console.log('ìŒì„± ì¬ìƒ ê°•ì œ ì¤‘ë‹¨ë¨');
        originalCancel();
    };
}
}
        
                    initializeHangulConstants() {
                        this.HANGUL_BASE = 0xAC00;
                        this.CONSONANT_COUNT = 19;
                        this.VOWEL_COUNT = 21;
                        this.FINAL_CONSONANT_COUNT = 28;
                        
                        this.INITIAL_CONSONANTS = [
                            'ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……',
                            'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'
                        ];
                        
                        this.VOWELS = [
                            'ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜',
                            'ã…™', 'ã…š', 'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£'
                        ];
                        
                        this.FINAL_CONSONANTS = [
                            '', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½', 'ã„¾', 'ã„¿', 'ã…€', 'ã…',
                            'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'
                        ];
        
                        this.INITIAL_PRONUNCIATION_MAP = {
                            'ã„±': 'ê·¸', 'ã„²': 'ë„', 'ã„´': 'ëŠ', 'ã„·': 'ë“œ', 'ã„¸': 'ëœ¨',
                            'ã„¹': 'ë¥´', 'ã…': 'ë¯€', 'ã…‚': 'ë¸Œ', 'ã…ƒ': 'ì˜', 'ã……': 'ìŠ¤',
                            'ã…†': 'ì“°', 'ã…‡': ' ', 'ã…ˆ': 'ì¦ˆ', 'ã…‰': 'ì¯”', 'ã…Š': 'ì¸ ',
                            'ã…‹': 'í¬', 'ã…Œ': 'íŠ¸', 'ã…': 'í”„', 'ã…': 'í'
                        };
                        
                        this.VOWEL_PRONUNCIATION_MAP = {
                            'ã…': 'ì•„', 'ã…': 'ì• ', 'ã…‘': 'ì•¼', 'ã…’': 'ì–˜', 'ã…“': 'ì–´',
                            'ã…”': 'ì—', 'ã…•': 'ì—¬', 'ã…–': 'ì˜ˆ', 'ã…—': 'ì˜¤', 'ã…˜': 'ì™€',
                            'ã…™': 'ì™œ', 'ã…š': 'ì™¸', 'ã…›': 'ìš”', 'ã…œ': 'ìš°', 'ã…': 'ì›Œ',
                            'ã…': 'ì›¨', 'ã…Ÿ': 'ìœ„', 'ã… ': 'ìœ ', 'ã…¡': 'ìœ¼', 'ã…¢': 'ìœ¼ì´', 'ã…£': 'ì´'
                        };
                        
                        this.FINAL_PRONUNCIATION_MAP = {
                            'ã„±': 'ìœ½', 'ã„²': 'ìœ½', 'ã„³': 'ìœ½', 'ã…‹': 'ìœ½',
                            'ã„´': 'ì€', 'ã„µ': 'ì€', 'ã„¶': 'ì€',
                            'ã„·': 'ìƒ', 'ã……': 'ìƒ', 'ã…†': 'ìƒ', 'ã…ˆ': 'ìƒ', 
                            'ã…Š': 'ìƒ', 'ã…Œ': 'ìƒ', 'ã…': 'ìƒ',
                            'ã„¹': 'ì„', 'ã„º': 'ìœ½', 'ã„»': 'ìŒ', 'ã„¼': 'ì„', 
                            'ã„½': 'ì„', 'ã„¾': 'ì„', 'ã„¿': 'ì', 'ã…€': 'ì„',
                            'ã…': 'ìŒ',
                            'ã…‚': 'ì', 'ã…„': 'ì', 'ã…': 'ì',
                            'ã…‡': 'ì‘'
                        };
                    }
        
                    initializeElements() {
                        this.micButton = document.getElementById('micButton');
                        this.voiceStatus = document.getElementById('voiceStatus');
                        this.loading = document.getElementById('loading');
                        this.resultSection = document.getElementById('resultSection');
                        this.originalText = document.getElementById('originalText');
                        this.phonicsGrid = document.getElementById('phonicsGrid');
                        this.playAllButton = document.getElementById('playAllButton');
                        this.speedSlider = document.getElementById('speedSlider');
                        this.speedDisplay = document.getElementById('speedDisplay');
                        this.resetButton = document.getElementById('resetButton');
                    }
        
                    initializeEventListeners() {
                        this.micButton.addEventListener('click', () => this.toggleRecording());
                        this.playAllButton.addEventListener('click', () => this.playAll());
                        this.speedSlider.addEventListener('input', (e) => this.updateSpeed(e.target.value));
                        this.resetButton.addEventListener('click', () => this.resetApp());
                    }
        
                    initializeSpeechRecognition() {
                        const SpeechRecognition = window.SpeechRecognition || 
                                                window.webkitSpeechRecognition || 
                                                window.mozSpeechRecognition ||
                                                window.msSpeechRecognition;
        
                        if (!SpeechRecognition) {
                            this.voiceStatus.textContent = 'ì£„ì†¡í•´ìš”, ì´ ë¸Œë¼ìš°ì €ëŠ” ìŒì„±ì¸ì‹ì„ ì§€ì›í•˜ì§€ ì•Šì•„ìš”';
                            this.micButton.disabled = true;
                            return;
                        }
        
                        this.recognition = new SpeechRecognition();
                        this.recognition.lang = 'ko-KR';
                        this.recognition.continuous = false;
                        this.recognition.interimResults = false;
                        this.recognition.maxAlternatives = 1;
        
                        this.recognition.onstart = () => {
                            this.micButton.classList.add('recording');
                            this.voiceStatus.textContent = 'ë“£ê³  ìˆì–´ìš”... ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”!';
        this.isRecognizing = true;
                        };
        
                        this.recognition.onresult = (event) => {
            if (!this.isRecognizing) return;
            
            if (event.results && event.results.length > 0) {
                const text = event.results[0][0].transcript.trim();
                
                if (text && text !== this.lastProcessedText) {
                    this.lastProcessedText = text;
                    this.isRecognizing = false;
                    this.micButton.classList.remove('recording');
                    
                    if (this.processingTimeout) {
                        clearTimeout(this.processingTimeout);
                    }
                    
                    this.processingTimeout = setTimeout(() => {
                        this.processVoiceInput(text);
                        this.processingTimeout = null;
                    }, 100);
                }
            }
        };
        
                        this.recognition.onerror = (event) => {
        this.isRecognizing = false;  // â† ì´ ì¤„ì„ ì¶”ê°€
                            this.micButton.classList.remove('recording');
                            let errorMessage = 'ìŒì„±ì¸ì‹ì— ì‹¤íŒ¨í–ˆì–´ìš”. ';
                            switch(event.error) {
                                case 'not-allowed':
                                    errorMessage += 'ë§ˆì´í¬ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
                                    break;
                                case 'no-speech':
                                    errorMessage += 'ìŒì„±ì´ ê°ì§€ë˜ì§€ ì•Šì•˜ì–´ìš”.';
                                    break;
                                default:
                                    errorMessage += 'ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                            }
                            this.voiceStatus.textContent = errorMessage;
                            setTimeout(() => {
                                if (!this.micButton.classList.contains('recording')) {
                                    this.voiceStatus.textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”';
                                }
                            }, 3000);
                        };
        
                        this.recognition.onend = () => {
        this.isRecognizing = false;  // â† ì´ ì¤„ì„ ì¶”ê°€
                            this.micButton.classList.remove('recording');
                            if (this.voiceStatus.textContent.includes('ë“£ê³  ìˆì–´ìš”')) {
                                this.voiceStatus.textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”';
                            }
                        };
                    }
        
                    async checkMicrophonePermission() {
                        try {
                            if (navigator.permissions) {
                                const result = await navigator.permissions.query({ name: 'microphone' });
                                if (result.state === 'denied') {
                                    this.voiceStatus.textContent = 'ë§ˆì´í¬ ê¶Œí•œì´ í•„ìš”í•´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë§ˆì´í¬ë¥¼ í—ˆìš©í•´ì£¼ì„¸ìš”.';
                                }
                            }
                        } catch (error) {
                            console.log('ê¶Œí•œ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
                        }
                    }
        
                   toggleRecording() {
            if (!this.recognition) {
                alert('ìŒì„±ì¸ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
        
            if (this.micButton.classList.contains('recording') || this.isRecognizing) {
                // ì¸ì‹ ì¤‘ë‹¨
                this.isRecognizing = false;
                this.recognition.stop();
                this.micButton.classList.remove('recording');
                this.voiceStatus.textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”';
            } else {
                // ì¸ì‹ ì‹œì‘
                if (this.processingTimeout) {
                    clearTimeout(this.processingTimeout);
                    this.processingTimeout = null;
                }
                
                this.isRecognizing = true;
                this.lastProcessedText = '';
                
                try {
                    this.recognition.start();
                } catch (error) {
                    this.isRecognizing = false;
                    this.voiceStatus.textContent = 'ìŒì„±ì¸ì‹ì„ ì‹œì‘í•  ìˆ˜ ì—†ì–´ìš”. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                }
            }
        }
        
                    processVoiceInput(text) {
        if (this.isRecognizing) return;  // â† ì´ ì¤„ì„ ì¶”ê°€
                        this.voiceStatus.textContent = `"${text}"ë¥¼ ë¶„ì„ì¤‘ì´ì—ìš”...`;
                        this.loading.style.display = 'block';
                        setTimeout(() => {
                            this.analyzeHangul(text);
                            this.loading.style.display = 'none';
                        }, 500);
                    }
        
                     testWord(word) {
                        this.voiceStatus.textContent = `"${word}"ë¥¼ ë¶„ì„ì¤‘ì´ì—ìš”...`;
                        this.loading.style.display = 'block';
                        setTimeout(() => {
                            this.analyzeHangul(word);
                            this.loading.style.display = 'none';
                        }, 500);
                    }
        
                    analyzeHangul(text) {
                        const hangulOnly = text.replace(/[^ê°€-í£]/g, '');
                        
                        if (!hangulOnly) {
                            this.voiceStatus.textContent = 'í•œê¸€ ë‹¨ì–´ë¥¼ ë§í•´ì£¼ì„¸ìš”!';
                            return;
                        }
        
                        this.originalText.innerHTML = `<span class="emoji">ğŸ’¬</span> ${hangulOnly} <span class="emoji">ğŸ’¬</span>`;
                        
                        const syllableData = [];
                        for (let i = 0; i < hangulOnly.length; i++) {
                            const char = hangulOnly[i];
                            const decomposed = this.decompose(char);
                            if (decomposed) {
                                syllableData.push({
                                    original: char,
                                    ...decomposed
                                });
                            }
                        }
        
                        this.currentData = {
                            original: hangulOnly,
                            syllables: syllableData
                        };
        
                        this.displayPhonics(syllableData);
                        this.resultSection.classList.remove('hidden');
                        this.voiceStatus.textContent = 'ì™„ì„±! ê° ì†Œë¦¬ë¥¼ í´ë¦­í•´ë³´ì„¸ìš” ğŸµ';
                    }
        
                    decompose(char) {
                        const code = char.charCodeAt(0) - this.HANGUL_BASE;
                        if (code < 0 || code > 11171) return null;
        
                        const initialIndex = Math.floor(code / (this.VOWEL_COUNT * this.FINAL_CONSONANT_COUNT));
                        const vowelIndex = Math.floor((code % (this.VOWEL_COUNT * this.FINAL_CONSONANT_COUNT)) / this.FINAL_CONSONANT_COUNT);
                        const finalIndex = code % this.FINAL_CONSONANT_COUNT;
        
                        return {
                            initial: this.INITIAL_CONSONANTS[initialIndex],
                            vowel: this.VOWELS[vowelIndex],
                            final: finalIndex > 0 ? this.FINAL_CONSONANTS[finalIndex] : null
                        };
                    }
        
                    displayPhonics(syllableData) {
                        this.phonicsGrid.innerHTML = '';
                        this.syllableGroups = [];
        
                        syllableData.forEach((syllable) => {
                            const syllableGroup = document.createElement('div');
                            syllableGroup.className = 'syllable-group';
                            
                            const label = document.createElement('div');
                            label.className = 'syllable-label';
                            label.textContent = syllable.original;
                            syllableGroup.appendChild(label);
        
                            const phonicsContainer = document.createElement('div');
                            phonicsContainer.className = 'syllable-phonics';
        
                            const phonicsItems = [];
        
                         if (syllable.initial) {
            const pronunciation = this.INITIAL_PRONUNCIATION_MAP[syllable.initial] || syllable.initial;
            const initialItem = this.createPhonicsItem(
                syllable.initial, 
                pronunciation,
                'consonant',
                'ììŒ'
            );
            phonicsContainer.appendChild(initialItem);
            phonicsItems.push(initialItem);
        }
        
                            if (syllable.vowel) {
                                const vowelItem = this.createPhonicsItem(
                                    syllable.vowel,
                                    this.VOWEL_PRONUNCIATION_MAP[syllable.vowel] || syllable.vowel,
                                    'vowel',
                                    'ëª¨ìŒ'
                                );
                                phonicsContainer.appendChild(vowelItem);
                                phonicsItems.push(vowelItem);
                            }
        
                            if (syllable.final) {
                                const finalItem = this.createPhonicsItem(
                                    syllable.final,
                                    this.FINAL_PRONUNCIATION_MAP[syllable.final] || syllable.final,
                                    'final',
                                    'ë°›ì¹¨'
                                );
                                phonicsContainer.appendChild(finalItem);
                                phonicsItems.push(finalItem);
                            }
        
                            syllableGroup.appendChild(phonicsContainer);
                            this.phonicsGrid.appendChild(syllableGroup);
                            
                            this.syllableGroups.push({
                                element: syllableGroup,
                                items: phonicsItems
                            });
                        });
                    }
        
                  createPhonicsItem(jamo, pronunciation, type, typeLabel) {
            const item = document.createElement('div');
            item.className = `phonics-item ${type}`;
            
            item.innerHTML = `
                <div class="jamo">${jamo}</div>
                <div class="pronunciation" style="display: none;">${pronunciation}</div>
                <div class="jamo-type ${type}">${typeLabel}</div>
            `;
        
                        item.addEventListener('click', () => {
                            this.playSound(pronunciation, item);
                        });
        
                        return item;
                    }
        
             playSound(text, element = null) {
    playUnifiedSound(text, element);
   // ì†Œë¦¬ ë†€ì´ì—ì„œëŠ” ë‹¨ìˆœ ì¬ìƒë§Œ (í†µê³„ ê¸°ë¡ ì•ˆ í•¨)
}
        
                 async playAll() {
    if (this.isPlaying || !this.currentData) return;

    this.isPlaying = true;
    this.playAllButton.disabled = true;
    this.playAllButton.textContent = 'ğŸµ ì¬ìƒì¤‘...';

    try {
        // ëª¨ë°”ì¼ì—ì„œ ë” ì§§ì€ ëŒ€ê¸° ì‹œê°„
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        const baseDelay = isMobile ? 100 : 100;
        const wordDelay = isMobile ? 400 : 600;
        const jamoDelay = isMobile ? 200 : 400;
        const groupDelay = isMobile ? 200 : 300;
        
                   
                            await this.delay(100);
                            await this.playWithDelay(this.currentData.original, null, 800);
        
                            for (let i = 0; i < this.syllableGroups.length; i++) {
                                if (!this.isPlaying) break;
                                
                                const group = this.syllableGroups[i];
                                await this.playWithDelay(this.currentData.syllables[i].original, null, 600);
                                
                              for (let j = 0; j < group.items.length; j++) {
            if (!this.isPlaying) break;
            const item = group.items[j];
            const pronunciationElement = item.querySelector('.pronunciation');
            if (pronunciationElement) {
                const pronunciation = pronunciationElement.textContent;
                await this.playWithDelay(pronunciation, item, 400);
            }
        }
                                
                                if (i < this.syllableGroups.length - 1) {
                                    await this.delay(300);
                                }
                            }
        
                            if (this.isPlaying) {
                                await this.playWithDelay(this.currentData.original, null, 0);
                            }
        
                        } catch (error) {
                            console.error('ì¬ìƒ ì¤‘ ì˜¤ë¥˜:', error);
                        } finally {
                            this.isPlaying = false;
                            this.playAllButton.disabled = false;
                            this.playAllButton.textContent = 'â–¶ï¸ ì „ì²´ ì¬ìƒ';
                            
                            document.querySelectorAll('.phonics-item.playing').forEach(item => {
                                item.classList.remove('playing');
                            });
                        }
                    }
        
                   playWithDelay(text, element, delayMs) {
    return new Promise((resolve) => {
        if (this.speechSynthesis.speaking) {
            this.speechSynthesis.cancel();
        }
        
        // ëª¨ë°”ì¼ ì•ˆì •ì„±ì„ ìœ„í•œ ì§§ì€ ëŒ€ê¸° ì‹œê°„
        setTimeout(() => {
            // ì¬ìƒ ì¤‘ë‹¨ ì²´í¬
            if (!this.isPlaying) {
                resolve();
                return;
            }
    const utterance = new SpeechSynthesisUtterance(text);
    utterance.lang = 'ko-KR';
    
    // ê¸°ì¡´ì˜ utterance.rate = this.currentSpeed; ë¶€ë¶„ì„ ë‹¤ìŒìœ¼ë¡œ êµì²´
   if (text === 'ê·¸') {
                utterance.rate = 0.4;
                utterance.pitch = 0.8;
            } else if (text === 'í¬') {
                utterance.rate = 0.4;
                utterance.pitch = 1.4;
            } else if (text === 'ë“œ') {
                utterance.rate = 0.4;
                utterance.pitch = 0.8;
            } else if (text === 'íŠ¸') {
                utterance.rate = 0.4;
                utterance.pitch = 1.4;
            } else if (text === 'ì¦ˆ') {
                utterance.rate = 0.4;
                utterance.pitch = 0.9;
            } else if (text === 'ì¸ ') {
                utterance.rate = 0.4;
                utterance.pitch = 1.3;
            } else if (text === 'ë¸Œ') {
                utterance.rate = 0.4;
                utterance.pitch = 0.8;
            } else if (text === 'í”„') {
                utterance.rate = 0.4;
                utterance.pitch = 1.5;
            } else if (text === 'ìœ½') {
                utterance.rate = 0.2;
                utterance.pitch = 0.4;
                utterance.volume = 0.9;
            } else if (text === 'ìƒ') {
                  utterance.rate = 0.35;
            utterance.pitch = 1.2;
            utterance.volume = 1.0;
            } else if (text === 'ìœ¼ì´') {
                utterance.rate = 1.2;
                utterance.pitch = 0.8;
                utterance.volume = 1.0;
 } else if (text === 'ìš”') {
            utterance.rate = 0.6;
            utterance.pitch = 1.4;
            utterance.volume = 1.0;
            } else {
                utterance.rate = this.currentSpeed;
                utterance.pitch = 1.2;
            }
            
            utterance.volume = 1.0;
            // ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
            
            if (element) {
                element.classList.add('playing');
            }

            let isResolved = false;
            const resolveOnce = () => {
                if (!isResolved) {
                    isResolved = true;
                    if (element) {
                        element.classList.remove('playing');
                    }
                    setTimeout(resolve, delayMs);
                }
            };

            utterance.onend = resolveOnce;
            utterance.onerror = resolveOnce;

            const timeoutId = setTimeout(() => {
                this.speechSynthesis.cancel();
                resolveOnce();
            }, Math.max(text.length * 200, 2000));

            utterance.onstart = () => {
                clearTimeout(timeoutId);
            };

            this.speechSynthesis.speak(utterance);
        }, 50);
    });
}
        
                    delay(ms) {
                        return new Promise(resolve => setTimeout(resolve, ms));
                    }
        
                    updateSpeed(value) {
                        this.currentSpeed = parseFloat(value);
                        this.speedDisplay.textContent = `${value}x`;
                    }
        
                    resetApp() {
                        this.isPlaying = false;
                         this.isRecognizing = false;      // â† ì¶”ê°€
            this.lastProcessedText = '';     // â† ì¶”ê°€
            
            if (this.processingTimeout) {    // â† ì¶”ê°€ ì‹œì‘
                clearTimeout(this.processingTimeout);
                this.processingTimeout = null;
            }                                // â† ì¶”ê°€ ë
                        if (this.speechSynthesis.speaking) {
                            this.speechSynthesis.cancel();
                        }
                        
                        setTimeout(() => {
                            this.resultSection.classList.add('hidden');
                            this.voiceStatus.textContent = 'ë§ˆì´í¬ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¨ì–´ë¥¼ ë§í•´ë³´ì„¸ìš”';
                            this.currentData = null;
                            this.syllableGroups = [];
                            
                            this.playAllButton.disabled = false;
                            this.playAllButton.textContent = 'â–¶ï¸ ì „ì²´ ì¬ìƒ';
                            
                            document.querySelectorAll('.phonics-item.playing').forEach(item => {
                                item.classList.remove('playing');
                            });
                        }, 100);
                    }
                }
        
                // ì „ì—­ í•¨ìˆ˜ë¡œ testWord ë…¸ì¶œ
                function testWord(word) {
                    if (currentApp && currentApp.testWord) {
                        currentApp.testWord(word);
                    }
                }
        
                // ê²Œì„ ê´€ë ¨ ì½”ë“œ
                const INITIAL_PRONUNCIATION = {
                    'ã„±': 'ê·¸', 'ã„²': 'ë„', 'ã„´': 'ëŠ', 'ã„·': 'ë“œ', 'ã„¸': 'ëœ¨',
                    'ã„¹': 'ë¥´', 'ã…': 'ë¯€', 'ã…‚': 'ë¸Œ', 'ã…ƒ': 'ì˜', 'ã……': 'ìŠ¤',
                    'ã…†': 'ì“°', 'ã…‡': ' ', 'ã…ˆ': 'ì¦ˆ', 'ã…‰': 'ì¯”', 'ã…Š': 'ì¸ ',
                    'ã…‹': 'í¬', 'ã…Œ': 'íŠ¸', 'ã…': 'í”„', 'ã…': 'í'
                };
                
              const VOWEL_PRONUNCIATION = {
    'ã…': 'ì•„', 'ã…': 'ì• ', 'ã…‘': 'ì•¼', 'ã…’': 'ì–˜', 'ã…“': 'ì–´',
    'ã…”': 'ì—', 'ã…•': 'ì—¬', 'ã…–': 'ì˜ˆ', 'ã…—': 'ì˜¤', 'ã…˜': 'ì™€',
    'ã…™': 'ì™œ', 'ã…š': 'ì™¸', 'ã…›': 'ìš”', 'ã…œ': 'ìš°', 'ã…': 'ì›Œ',
    'ã…': 'ì›¨', 'ã…Ÿ': 'ìœ„', 'ã… ': 'ìœ ', 'ã…¡': 'ìœ¼', 'ã…¢': 'ìœ¼ì´', 'ã…£': 'ì´'
};
                
                const FINAL_PRONUNCIATION = {
                    // ê¸°ë³¸ ë°›ì¹¨ 7ê°œ (ã„±,ã„´,ã„¹,ã…,ã…‚,ã……,ã…‡)
                    'ã„±': 'ìœ½',  // ã„± ë°›ì¹¨
                    'ã„´': 'ì€',   // ã„´ ë°›ì¹¨
                    'ã„¹': 'ì„',   // ã„¹ ë°›ì¹¨
                    'ã…': 'ìŒ',   // ã… ë°›ì¹¨
                    'ã…‚': 'ì',   // ã…‚ ë°›ì¹¨
                    'ã……': 'ìƒ',   // ã…… ë°›ì¹¨
                    'ã…‡': 'ì‘',   // ã…‡ ë°›ì¹¨
                    
                    // ë‚˜ë¨¸ì§€ ë°›ì¹¨ë“¤ (ê²Œì„ìš©ìœ¼ë¡œ ìœ ì§€)
                    'ã„²': 'ìœ½', 'ã„³': 'ìœ½', 'ã…‹': 'ìœ½',
                    'ã„µ': 'ì€', 'ã„¶': 'ì€',
                    'ã„·': 'ìƒ', 'ã…†': 'ìƒ', 'ã…ˆ': 'ìƒ', 
                    'ã…Š': 'ìƒ', 'ã…Œ': 'ìƒ', 'ã…': 'ìƒ',
                    'ã„º': 'ìœ½', 'ã„»': 'ìŒ', 'ã„¼': 'ì„', 
                    'ã„½': 'ì„', 'ã„¾': 'ì„', 'ã„¿': 'ì', 'ã…€': 'ì„',
                    'ã…„': 'ì', 'ã…': 'ì'
                };
        
                // í•œê¸€ ìì†Œ ë¶„í•´ í•¨ìˆ˜
                function decomposeHangul(char) {
                    const code = char.charCodeAt(0) - 0xAC00;
                    if (code < 0 || code > 11171) return null;
        
                    const initial = Math.floor(code / 588);
                    const medial = Math.floor((code % 588) / 28);
                    const final = code % 28;
        
                    const initials = ['ã„±', 'ã„²', 'ã„´', 'ã„·', 'ã„¸', 'ã„¹', 'ã…', 'ã…‚', 'ã…ƒ', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…‰', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
                    const medials = ['ã…', 'ã…', 'ã…‘', 'ã…’', 'ã…“', 'ã…”', 'ã…•', 'ã…–', 'ã…—', 'ã…˜', 'ã…™', 'ã…š', 'ã…›', 'ã…œ', 'ã…', 'ã…', 'ã…Ÿ', 'ã… ', 'ã…¡', 'ã…¢', 'ã…£'];
                    const finals = ['', 'ã„±', 'ã„²', 'ã„³', 'ã„´', 'ã„µ', 'ã„¶', 'ã„·', 'ã„¹', 'ã„º', 'ã„»', 'ã„¼', 'ã„½', 'ã„¾', 'ã„¿', 'ã…€', 'ã…', 'ã…‚', 'ã…„', 'ã……', 'ã…†', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…'];
        
                    return {
                        initial: initials[initial],
                        medial: medials[medial],
                        final: finals[final]
                    };
                }
        
                // ë‹¨ì–´ë¥¼ íŒŒë‹‰ìŠ¤ë¡œ ë¶„í•´ (ë””ë²„ê¹… ë²„ì „)
               function wordToPhonics(word) {
            const phonics = [];
            
            console.log('ë¶„í•´í•  ë‹¨ì–´:', word);
            
            for (let char of word) {
                const decomposed = decomposeHangul(char);
                console.log(`${char} ë¶„í•´ ê²°ê³¼:`, decomposed);
                
                if (decomposed) {
                    // ìŒì ˆë³„ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬
                    const syllablePhonics = [];
                    
                    // ì´ˆì„± (ììŒ)
                    const initialSound = INITIAL_PRONUNCIATION[decomposed.initial] || decomposed.initial;
                    syllablePhonics.push(initialSound);
                    
                    // ì¤‘ì„± (ëª¨ìŒ)
                    const vowelSound = VOWEL_PRONUNCIATION[decomposed.medial] || decomposed.medial;
                    syllablePhonics.push(vowelSound);
                    
                    // ì¢…ì„± (ë°›ì¹¨) - ìˆëŠ” ê²½ìš°ì—ë§Œ
                    if (decomposed.final) {
                        const finalSound = FINAL_PRONUNCIATION[decomposed.final] || decomposed.final;
                        syllablePhonics.push(finalSound);
                    }
                    
                    // ìŒì ˆ ë‹¨ìœ„ë¡œ phonics ë°°ì—´ì— ì¶”ê°€
                    phonics.push(...syllablePhonics);
                }
            }
            
            // ì—°ì†ëœ ë™ì¼í•œ ì†Œë¦¬ ì œê±°
            const uniquePhonics = [];
            for (let i = 0; i < phonics.length; i++) {
                if (i === 0 || phonics[i] !== phonics[i-1]) {
                    uniquePhonics.push(phonics[i]);
                }
            }
            
            console.log('ì¤‘ë³µ ì œê±° í›„ íŒŒë‹‰ìŠ¤:', uniquePhonics);
            return uniquePhonics;
        }
        
                // ë‹¨ì–´ ë°ì´í„°
              const noBatchimWordsWithIcons = [
    'ë‚˜ë¹„', 'ì—¬ìš°', 'ê°œêµ¬ë¦¬', 'ë‘ë”ì§€', 'í•˜ë§ˆ', 'ë©”ëšœê¸°', 'í† ë¼', 'ì½”ë¼ë¦¬', 'ì‚¬ì', 'ë¼ì§€', 'ê³ ë˜', 'ê°œë¯¸', 'ì‹œì†Œ', 'ê³ ì¶”', 
    'ì‚¬ê³¼', 'ë°”ë‚˜ë‚˜', 'í¬ë„', 'í† ë§ˆí† ', 'ì²´ë¦¬', 'ìš°ìœ ', 'ì¹˜ì¦ˆ', 'ì¼€ì´í¬', 'ê³ ê¸°', 'ê±°ë¯¸', 'ì‚¬ë‹¤ë¦¬', 'ê·¸ë„¤', 'êµ¬ë‘', 'ëª¨ê¸°',
    'ë‚˜ë¬´', 'í•´', 'ë¹„', 'ë¬´ì§€ê°œ', 'ê·€', 'ì½”', 'í•´íŒŒë¦¬', 'í•´ë°”ë¼ê¸°', 'í—ˆìˆ˜ì•„ë¹„', 'ê³ êµ¬ë§ˆ', 'ìƒˆìš°',
    'ëª¨ì', 'ì‹œê³„', 'ì¹´ë©”ë¼', 'ë¹„ëˆ„', 'ì˜ì', 'ì', 'ê°€ìœ„', 'í”¼ì', 'ì¡°ê°œ', 'ê°€ì˜¤ë¦¬', 'ê²Œ', 'ë„ˆêµ¬ë¦¬', 'íƒ€ì¡°', 'ì£¼ì‚¬ê¸°', 'ë¼ë””ì˜¤',
    'ë²„ìŠ¤', 'ê¸°ì°¨', 'ë°°', 'ì˜¤í† ë°”ì´', 'ë„í† ë¦¬', 'ê°€ì§€', 'ë°°ì¶”', 'ë¶€ì±„', 'ê¸°íƒ€', 'í”¼ì•„ë…¸',
    'ì˜¤ë¦¬', 'ê±°ìœ„', 'ì†Œ', 'í¬ë ˆíŒŒìŠ¤', 'íŒŒí”„ë¦¬ì¹´', 'íŠœë¸Œ', 'í‚¤ìœ„', 'ì§€êµ¬', 'ë³´ë¼', 'ì¹˜ë§ˆ', 'ë°”ì§€', 'ë¨¸ë¦¬ë ', 
];

const batchimWordsWithIcons = [
    'ê°•ì•„ì§€', 'ê³ ì–‘ì´', 'í˜¸ë‘ì´', 'ë¬¼ê³ ê¸°', 'ìƒì–´', 'ë¬¸ì–´', 'ëŒê³ ë˜', 'ë¶€ì—‰ì´',
    'ë‹­', 'ë§', 'ì–‘', 'ê¸°ë¦°', 'ì›ìˆ­ì´', 'íŒ¬ë”', 'ê³°', 'ì‚¬ìŠ´', 'ë„ë„›', 'ë¡œë´‡',
    'ë‹¤ëŒì¥', 'ê³ ìŠ´ë„ì¹˜', 'ë°•ì¥', 'í­ê·„', 'ìº¥ê±°ë£¨', 'ì°¸ìƒˆ', 'ë¸Œë¡œì½œë¦¬', 'ë¬´ë‹¹ë²Œë ˆ', 'ê¿€ë²Œ',
    'ë”¸ê¸°', 'ì‚¬íƒ•', 'ë°¥', 'ë‹¬ê±€', 'ë¹µ', 'ë–¡', 'ì•„ì´ìŠ¤í¬ë¦¼', 'ì´ˆì½œë¦¿','ì½©', 'ê°', 'ë‹¹ê·¼', 'ë°¤',
    'ë°”ëŒ','ë²ˆê°œ', 'ì‚°', 'ì „êµ¬', 'í’ì„ ', 'ë¦¬ë³¸', 'ì™•ê´€', 'ë²„ì„¯', 'ë ˆëª¬',
    'ì‹ ë°œ', 'ê±°ìš¸', 'ê°€ë°©', 'ì±…', 'ì—°í•„', 'ê³µì±…', 'ë³µìˆ­ì•„', 'í–„ë²„ê±°', 'í–„ìŠ¤í„°',
    'íœ', 'ì•ˆê²½', 'ì–‘ë§', 'ì¥ê°‘', 'ìš°ì‚°', 'ìƒˆì‹¹', 'ëˆˆì‚¬ëŒ',
    'ìì „ê±°', 'íŠ¸ëŸ­', 'ìë™ì°¨', 'ë¹„í–‰ê¸°', 'í—¬ë¦¬ì½¥í„°', 'êµ¬ê¸‰ì°¨', 'ì ìë¦¬', 'ê²½ì°°ì°¨',
    'ë¹¨ê°•', 'ë…¸ë‘', 'íŒŒë‘', 'ì´ˆë¡', 'ì£¼í™©', 'ì˜¥ìˆ˜ìˆ˜', 'ìˆ˜ë°•', 'ì˜¤ì§•ì–´', 'ì• ë²Œë ˆ',
    'ì–¼êµ´', 'ëˆˆ', 'ì…', 'ì†', 'ë°œ', 'ë°˜ì§€', 'ìš¸íƒ€ë¦¬', 'ê±°ë¶ì´', 'ì„ ì¸ì¥',
    'ì§‘', 'í•™êµ', 'ë³‘ì›', 'êµ¬ë¦„', 'ì„±', 'ë³„', 'ì˜¤ë Œì§€', 'ê·€ê±¸ì´', 'ì•µë¬´ìƒˆ'
];
        
     
const wordImageMap = {
    // ë°›ì¹¨ ì—†ëŠ” ë‹¨ì–´ë“¤
    'ë‚˜ë¹„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/butterfly.png.png',
    'ì—¬ìš°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/fox.png.png',
    'ê°œêµ¬ë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/frog.png.png',
    'ë‘ë”ì§€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/mole.png.png',
    'í•˜ë§ˆ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/hippo.png.png',
    'ë©”ëšœê¸°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/grasshopper.png.png',
    'í† ë¼': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/rabbit.png.png',
    'ì½”ë¼ë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/elephant.png.png',
    'ì‚¬ì': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/lion.png.png',
    'ë¼ì§€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/pig.png.png',
    'ê³ ë˜': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/whale.png.png',
    'ê°œë¯¸': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ant.png.png',
    'ì‚¬ê³¼': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/apple.png.png',
    'ë°”ë‚˜ë‚˜': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/banana.png.png',
    'í¬ë„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/grape.png.png',
    'í† ë§ˆí† ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/tomato.png.png',
    'ì²´ë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/cherry.png.png',
    'ìš°ìœ ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/milk.png.png',
    'ì¹˜ì¦ˆ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/cheese.png.png',
    'ì¼€ì´í¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/cake.png.png',
    'ê³ ê¸°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/meat.png.png',
    'ê±°ë¯¸': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/spider.png.png',
    'ë‚˜ë¬´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/tree.png.png',
    'í•´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/sun.png.png',
    'ë¹„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/rain.png.png',
    'ë¬´ì§€ê°œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/rainbow.png.png',
    'ê·€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ear.png.png',
    'ì½”': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/nose.png.png',
    'í•´íŒŒë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/jellyfish.png.png',
    'í•´ë°”ë¼ê¸°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/sunflower.png.png',
    'í—ˆìˆ˜ì•„ë¹„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/scarecrow.png.png',
    'ê³ êµ¬ë§ˆ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/sweet_potato.png.png',
    'ëª¨ì': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/hat.png.png',
    'ì‹œê³„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/clock.png.png',
    'ì¹´ë©”ë¼': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/camera.png.png',
    'ë¹„ëˆ„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/soap.png.png',
    'ì˜ì': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/chair.png.png',
    'ì': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ruler.png.png',
    'ê°€ìœ„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/scissors.png.png',
    'í”¼ì': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/pizza.png.png',
    'ì¡°ê°œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/shell.png.png',
    'ë²„ìŠ¤': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/bus.png.png',
    'ê¸°ì°¨': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/train.png.png',
    'ë°°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ship.png.png',
    'ì˜¤í† ë°”ì´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/motorcycle.png.png',
    'ë„í† ë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/acorn.png.png',
    'ê°€ì§€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/eggplant.png.png',
    'ë°°ì¶”': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/cabbage.png.png',
    'ë¶€ì±„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/fan.png.png',
    'ê¸°íƒ€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/guitar.png.png',
    'í”¼ì•„ë…¸': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/piano.png.png',
    'ì˜¤ë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/duck.png.png',
    'ê±°ìœ„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/goose.png.png',
    'ì†Œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/cow.png.png',
    'í¬ë ˆíŒŒìŠ¤': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/crayon.png.png',
    'íŒŒí”„ë¦¬ì¹´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/paprika.png.png',
    'íŠœë¸Œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/tube.png.png',
    'í‚¤ìœ„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/kiwi.png.png',
    'ì§€êµ¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/earth.png.png',
    'ë³´ë¼': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/purple.png.png',
 'ì¹˜ë§ˆ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/skirt.png.png',
 'ë°”ì§€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/pants.png.png',
 'ë¨¸ë¦¬ë ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/headband.png.png',
'ê°€ì˜¤ë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/stingray.png',
'ê²Œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/crab.png.png',
'ë„ˆêµ¬ë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/raccoon.png.png',
'íƒ€ì¡°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ostrich.png.png',
'ì£¼ì‚¬ê¸°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/syringe.png.png',
'ë¼ë””ì˜¤': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/radio.png.png',
'ì‹œì†Œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/seesaw.png.png',
'ê³ ì¶”': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/chili.png',
'ì‚¬ë‹¤ë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ladder.png.png',
'ê·¸ë„¤': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/swing.png.png',
'êµ¬ë‘': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/heels.png.png',
'ëª¨ê¸°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/mosquito.png.png',
'ìƒˆìš°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/shrimp.png.png',





    
    

// ë°›ì¹¨ ìˆëŠ” ë‹¨ì–´ë“¤
    'ê°•ì•„ì§€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/puppy.png.png',
    'ê³ ì–‘ì´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/cat.png.png',
    'í˜¸ë‘ì´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/tiger.png.png',
    'ë¬¼ê³ ê¸°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/fish.png.png',
    'ìƒì–´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/shark.png.png',
    'ë¬¸ì–´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/octopus.png.png',
    'ëŒê³ ë˜': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/dolphin.png.png',
    'ë¶€ì—‰ì´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/owl.png.png',
    'ë‹­': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/chicken.png.png',
    'ë§': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/horse.png.png',
    'ì–‘': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/sheep.png.png',
    'ê¸°ë¦°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/giraffe.png.png',
    'ì›ìˆ­ì´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/monkey.png.png',
    'íŒ¬ë”': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/panda.png.png',
    'ê³°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/bear.png.png',
    'ì‚¬ìŠ´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/deer.png.png',
    'ë„ë„›': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/donut.png.png',
    'ë¡œë´‡': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/robot.png.png',
    'ë‹¤ëŒì¥': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/squirrel.png.png',
    'ê³ ìŠ´ë„ì¹˜': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/hedgehog.png.png',
    'ë°•ì¥': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/bat.png.png',
    'í­ê·„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/penguin.png.png',
    'ìº¥ê±°ë£¨': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/kangaroo.png.png',
    'ì°¸ìƒˆ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/sparrow.png.png',
    'ë¸Œë¡œì½œë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/broccoli.png.png',
    'ë¬´ë‹¹ë²Œë ˆ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ladybug.png.png',
    'ê¿€ë²Œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/bee.png.png',
    'ë”¸ê¸°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/strawberry.png.png',
    'ì‚¬íƒ•': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/candy.png.png',
    'ë°¥': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/rice.png.png',
    'ë‹¬ê±€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/egg.png.png',
    'ë¹µ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/bread.png.png',
    'ë–¡': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/rice_cake.png.png',
    'ì•„ì´ìŠ¤í¬ë¦¼': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ice_cream.png.png',
    'ì´ˆì½œë¦¿': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/chocolate.png.png',
    'ì½©': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/bean.png.png',
    'ê°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/persimmon.png.png',
    'ë‹¹ê·¼': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/carrot.png.png',
    'ë°¤': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/chestnut.png.png',
    'ë°”ëŒ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/wind.png.png',
    'ë²ˆê°œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/lightning.png.png',
    'ì‚°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/mountain.png.png',
    'ì „êµ¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/light_bulb.png.png',
    'í’ì„ ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/balloon.png.png',
    'ë¦¬ë³¸': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ribbon.png.png',
    'ì™•ê´€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/crown.png.png',
    'ë²„ì„¯': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/mushroom.png.png',
    'ë ˆëª¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/lemon.png.png',
    'ì‹ ë°œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/shoes.png.png',
    'ê±°ìš¸': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/mirror.png.png',
    'ê°€ë°©': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/bag.png.png',
    'ì±…': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/book.png.png',
    'ì—°í•„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/pencil.png.png',
    'ê³µì±…': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/notebook.png.png',
    'ë³µìˆ­ì•„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/peach.png.png',
    'í–„ë²„ê±°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/hamburger.png.png',
    'í–„ìŠ¤í„°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/hamster.png.png',
    'íœ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/pen.png.png',
    'ì•ˆê²½': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/glasses.png.png',
    'ì–‘ë§': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/socks.png.png',
    'ì¥ê°‘': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/gloves.png.png',
    'ìš°ì‚°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/umbrella.png.png',
    'ìƒˆì‹¹': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/sprout.png.png',
    'ëˆˆì‚¬ëŒ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/snowman.png.png',
    'ìì „ê±°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/bicycle.png.png',
    'íŠ¸ëŸ­': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/truck.png.png',
    'ìë™ì°¨': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/car.png.png',
    'ë¹„í–‰ê¸°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/airplane.png.png',
    'í—¬ë¦¬ì½¥í„°': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/helicopter.png.png',
    'êµ¬ê¸‰ì°¨': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ambulance.png.png',
    'ì ìë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/dragonfly.png.png',
    'ê²½ì°°ì°¨': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/police_car.png.png',
    'ë¹¨ê°•': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/red.png.png',
    'ë…¸ë‘': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/yellow.png.png',
    'íŒŒë‘': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/blue.png.png',
    'ì´ˆë¡': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/green.png.png',
    'ì£¼í™©': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/orange_color.png.png',
    'ì˜¥ìˆ˜ìˆ˜': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/corn.png.png',
    'ìˆ˜ë°•': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/watermelon.png.png',
    'ì˜¤ì§•ì–´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/squid.png.png',
    'ì• ë²Œë ˆ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/caterpillar.png.png',
    'ì–¼êµ´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/face.png.png',
    'ëˆˆ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/eye.png.png',
    'ì…': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/mouth.png.png',
    'ì†': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/hand.png.png',
    'ë°œ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/foot.png.png',
    'ë°˜ì§€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/ring.png.png',
    'ìš¸íƒ€ë¦¬': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/fence.png.png',
    'ê±°ë¶ì´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/turtle.png.png',
    'ì„ ì¸ì¥': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/cactus.png.png',
    'ì§‘': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/house.png.png',
    'í•™êµ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/school.png.png',
    'ë³‘ì›': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/hospital.png.png',
    'êµ¬ë¦„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/cloud.png.png',
    'ì„±': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/castle.png.png',
    'ë³„': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/star.png.png',
    'ì˜¤ë Œì§€': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/orange_fruit.png.png',
    'ê·€ê±¸ì´': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/earrings.png.png',
    'ì•µë¬´ìƒˆ': 'https://raw.githubusercontent.com/minkyeong1128/phonics-images/main/images/parrot.png.png'
};
        
         function loadImageForWord(word) {
    const wordImageContainer = document.getElementById('wordImage');
    const imageUrl = wordImageMap[word];
    
    // ì™„ì „íˆ ì´ˆê¸°í™”
    wordImageContainer.innerHTML = '';
    wordImageContainer.style.cssText = '';
    
    if (imageUrl) {
        // ì‹¤ì œ ì´ë¯¸ì§€ ë¡œë“œ
        const img = document.createElement('img');
        
        // ë¡œë”© í‘œì‹œ ë¨¼ì € ë³´ì—¬ì£¼ê¸°
        const loadingDiv = document.createElement('div');
        loadingDiv.textContent = 'ë¡œë”©ì¤‘...';
        loadingDiv.style.cssText = `
            font-size: 18px !important;
            color: #666 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            height: 100% !important;
        `;
        wordImageContainer.appendChild(loadingDiv);
        
        // ì´ë¯¸ì§€ ë¡œë“œ ì„±ê³µ ì‹œ
        img.onload = function() {
            wordImageContainer.innerHTML = ''; // ë¡œë”© ë©”ì‹œì§€ ì œê±°
            wordImageContainer.appendChild(img);
        };
        
        // ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨ ì‹œ ê¸°ë³¸ ì´ëª¨ì§€ í‘œì‹œ
        img.onerror = function() {
            console.warn(`ì´ë¯¸ì§€ ë¡œë“œ ì‹¤íŒ¨: ${word} - ${imageUrl}`);
            wordImageContainer.innerHTML = '';
            
            const fallbackDiv = document.createElement('div');
            fallbackDiv.textContent = 'ğŸ–¼ï¸';
            fallbackDiv.style.cssText = `
                font-size: 4em !important;
                color: #5a67d8 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                height: 100% !important;
                text-decoration: none !important;
            `;
            wordImageContainer.appendChild(fallbackDiv);
        };
        
        // ì´ë¯¸ì§€ ì†ì„± ì„¤ì •
        img.setAttribute('style', `
            width: 100% !important;
            height: 100% !important;
            object-fit: contain !important;
            border-radius: 12px !important;
            background: transparent !important;
            text-decoration: none !important;
            border: none !important;
            outline: none !important;
            display: block !important;
        `);
        
        img.src = imageUrl;
        img.alt = word;
        
    } else {
        // ì´ë¯¸ì§€ URLì´ ì—†ì„ ë•Œ ê¸°ë³¸ í‘œì‹œ
        console.warn(`ì´ë¯¸ì§€ URLì„ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${word}`);
        const fallbackDiv = document.createElement('div');
        fallbackDiv.textContent = 'â“';
        fallbackDiv.style.cssText = `
            font-size: 4em !important;
            color: #5a67d8 !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            height: 100% !important;
            text-decoration: none !important;
        `;
        wordImageContainer.appendChild(fallbackDiv);
    }
}
        
                function playCorrectSound() {
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.5);
                    } catch (error) {
                        console.log('ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:', error);
                    }
                }
        
                function playIncorrectSound() {
                    try {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                        const oscillator = audioContext.createOscillator();
                        const gainNode = audioContext.createGain();
                        
                        oscillator.connect(gainNode);
                        gainNode.connect(audioContext.destination);
                        
                        oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                        oscillator.frequency.setValueAtTime(250, audioContext.currentTime + 0.1);
                        oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.2);
                        
                        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.4);
                        
                        oscillator.start(audioContext.currentTime);
                        oscillator.stop(audioContext.currentTime + 0.4);
                    } catch (error) {
                        console.log('ì˜¤ë””ì˜¤ ì¬ìƒ ì‹¤íŒ¨:', error);
                    }
                }
        
                function generateRandomChoices(correctAnswer, wordPool) {
                    const choices = [correctAnswer];
                    const correctSyllableCount = correctAnswer.length;
                    
                    const availableWords = wordPool.filter(word => 
                        word !== correctAnswer && word.length === correctSyllableCount
                    );
                    
                    const finalWordPool = availableWords.length >= 2 ? availableWords : 
                                         wordPool.filter(word => word !== correctAnswer);
                    
                    while (choices.length < 3) {
                        const randomWord = finalWordPool[Math.floor(Math.random() * finalWordPool.length)];
                        if (!choices.includes(randomWord)) {
                            choices.push(randomWord);
                        }
                    }
                    
                    return choices.sort(() => Math.random() - 0.5);
                }
        
                function generateNewQuestion() {
                    if (gameState.availableWords.length === 0) {
                        const wordPool = gameState.currentMode === 'noBatchim' ? noBatchimWordsWithIcons : batchimWordsWithIcons;
                        gameState.availableWords = [...wordPool];
                    }
                    
                    const randomIndex = Math.floor(Math.random() * gameState.availableWords.length);
                    const correctWord = gameState.availableWords.splice(randomIndex, 1)[0];
                    
                    gameState.usedWords.push(correctWord);
                    
                    const wordPool = gameState.currentMode === 'noBatchim' ? noBatchimWordsWithIcons : batchimWordsWithIcons;
                    const choices = generateRandomChoices(correctWord, wordPool);
                    
                    return {
                        word: correctWord,
                        choices: choices,
                        correct: choices.indexOf(correctWord)
                    };
                }
        
                function setMode(mode) {
                    gameState.currentMode = mode;
                    document.getElementById('noBatchimMode').classList.toggle('active', mode === 'noBatchim');
                    document.getElementById('batchimMode').classList.toggle('active', mode === 'batchim');
        
                    gameState.usedWords = [];
                    gameState.availableWords = [];
        
                    restartGame();
                }
        
                function playAudio() {
            if (!gameState.currentQuestion) return;
        
            // ê¸°ì¡´ ì¬ìƒ ì¤‘ë‹¨
            stopAudioPlayback();
        
            const phonics = wordToPhonics(gameState.currentQuestion.word);
            console.log('ì¬ìƒí•  íŒŒë‹‰ìŠ¤:', phonics);
            
            const uniquePhonics = [];
            for (let i = 0; i < phonics.length; i++) {
                if (i === 0 || phonics[i] !== phonics[i-1]) {
                    uniquePhonics.push(phonics[i]);
                }
            }
            
            console.log('ì¤‘ë³µ ì œê±° í›„:', uniquePhonics);
            
            let index = 0;
            let isStopped = false;
        
            function playNext() {
                if (index >= uniquePhonics.length || isStopped) return;
        
             const utterance = new SpeechSynthesisUtterance(uniquePhonics[index]);
utterance.lang = 'ko-KR';

  const sound = uniquePhonics[index];
        if (sound === 'ê·¸') {
            utterance.rate = 0.4;
            utterance.pitch = 0.8;
        } else if (sound === 'í¬') {
            utterance.rate = 0.4;
            utterance.pitch = 1.4;
        } else if (sound === 'ë“œ') {
            utterance.rate = 0.4;
            utterance.pitch = 0.8;
        } else if (sound === 'íŠ¸') {
            utterance.rate = 0.4;
            utterance.pitch = 1.4;
        } else if (sound === 'ì¦ˆ') {
            utterance.rate = 0.4;
            utterance.pitch = 0.9;
        } else if (sound === 'ì¸ ') {
            utterance.rate = 0.4;
            utterance.pitch = 1.3;
        } else if (sound === 'ë¸Œ') {
            utterance.rate = 0.4;
            utterance.pitch = 0.8;
        } else if (sound === 'í”„') {
            utterance.rate = 0.4;
            utterance.pitch = 1.5;
        } else if (sound === 'ìœ½') {
            utterance.rate = 0.2;
            utterance.pitch = 0.4;
            utterance.volume = 0.9;
        } else if (sound === 'ìƒ') {
             utterance.rate = 0.35;
            utterance.pitch = 1.2;
            utterance.volume = 1.0;
        } else if (sound === 'ìœ¼ì´') {
            utterance.rate = 1.2;
            utterance.pitch = 0.8;
            utterance.volume = 1.0;
 } else if (sound === 'ìš”') {
            utterance.rate = 0.6;
            utterance.pitch = 1.4;
            utterance.volume = 1.0;
        } else {
            utterance.rate = 0.5;
            utterance.pitch = 1.2;
        }

        utterance.volume = 1.0;
        
        utterance.onend = function() {
            index++;
            if (index < uniquePhonics.length && !isStopped) {
                setTimeout(playNext, 400);
            }
        };

        utterance.onerror = function() {
            console.log('ìŒì„± ì¬ìƒ ì˜¤ë¥˜');
            index++;
            if (index < uniquePhonics.length && !isStopped) {
                setTimeout(playNext, 400);
            }
        };

        window.speechSynthesis.speak(utterance);
    }

    audioPlayback = {
        stop: function() {
            isStopped = true;
            window.speechSynthesis.cancel();
        }
    };

    setTimeout(playNext, 100);
}
        function stopAudioPlayback() {
            if (audioPlayback && audioPlayback.stop) {
                audioPlayback.stop();
                audioPlayback = null;
            }
            window.speechSynthesis.cancel();
        }
        
                function displayQuestion() {
                    gameState.currentQuestion = generateNewQuestion();
        
                    document.getElementById('currentQuestion').textContent = gameState.currentQuestionIndex + 1;
                    
                    loadImageForWord(gameState.currentQuestion.word);
        
                    const choicesContainer = document.getElementById('choices');
                    choicesContainer.innerHTML = '';
        
                    gameState.currentQuestion.choices.forEach((choice, index) => {
                        const button = document.createElement('button');
                        button.className = 'choice-button';
                        button.textContent = choice;
                        button.onclick = () => selectAnswer(index);
                        choicesContainer.appendChild(button);
                    });
        
                    document.getElementById('feedback').classList.add('hidden');
                    document.getElementById('nextButton').classList.add('hidden');
                    gameState.isAnswered = false;

setTimeout(() => {
    playAudio();
}, 1000);
                }
        
                function selectAnswer(selectedIndex) {
                    if (gameState.isAnswered) return;
                    
                // íŒŒë‹‰ìŠ¤ ì¬ìƒ ì™„ì „íˆ ì¤‘ë‹¨
        stopAudioPlayback();
        
        // ì§§ì€ ëŒ€ê¸° í›„ ì™„ì „íˆ ì¤‘ë‹¨ë˜ì—ˆëŠ”ì§€ í™•ì¸
        setTimeout(() => {
            if (window.speechSynthesis.speaking) {
                window.speechSynthesis.cancel();
            }
        }, 50);
        
        // ì„ íƒí•œ ë³´ê¸°ì˜ ì†Œë¦¬ ì¬ìƒ
        setTimeout(() => {
            const selectedWord = gameState.currentQuestion.choices[selectedIndex];
            const utterance = new SpeechSynthesisUtterance(selectedWord);
            utterance.lang = 'ko-KR';
            utterance.rate = 0.8;
            utterance.volume = 1.0;
            utterance.pitch = 1.0;
            window.speechSynthesis.speak(utterance);
        }, 200);
                    
                    gameState.isAnswered = true;
        
                    const correctIndex = gameState.currentQuestion.choices.indexOf(gameState.currentQuestion.word);
                    const buttons = document.querySelectorAll('.choice-button');
                    const feedback = document.getElementById('feedback');
        
                    buttons.forEach(btn => btn.style.pointerEvents = 'none');
        
                    if (selectedIndex === correctIndex) {
                        gameState.score++;
                        document.getElementById('score').textContent = gameState.score;
// í†µê³„ ì—…ë°ì´íŠ¸
if (currentUser) {
    updateGameStats(gameState.currentQuestion.word, true);
}
        
                        buttons[selectedIndex].classList.add('correct');
                        feedback.className = 'feedback correct';
                        feedback.innerHTML = `<strong>ì •ë‹µì…ë‹ˆë‹¤! ğŸ‰</strong><br>ì •ë‹µ: ${gameState.currentQuestion.word}`;
                        feedback.classList.remove('hidden');
                        
                        playCorrectSound();
                    } else {
                        buttons.forEach((btn, index) => {
                            if (index === correctIndex) {
                                btn.classList.add('correct');
                            } else {
                                btn.classList.add('incorrect');
                            }
                        });
       
 // í†µê³„ ì—…ë°ì´íŠ¸
if (currentUser) {
    updateGameStats(gameState.currentQuestion.word, false);
}

                        gameState.wrongAnswers.push({
                            question: gameState.currentQuestionIndex + 1,
                            word: gameState.currentQuestion.word,
                            userAnswer: gameState.currentQuestion.choices[selectedIndex],
                            correctAnswer: gameState.currentQuestion.word
                        });
        
                        feedback.className = 'feedback incorrect';
                        feedback.innerHTML = `<strong>í‹€ë ¸ìŠµë‹ˆë‹¤! ğŸ˜…</strong><br>ì •ë‹µ: ${gameState.currentQuestion.word}`;
                        feedback.classList.remove('hidden');
                        
                        playIncorrectSound();
                    }
        
                    document.getElementById('nextButton').classList.remove('hidden');
                }
        
                function nextQuestion() {
                    gameState.currentQuestionIndex++;
                    
                    if (gameState.currentQuestionIndex >= 10) {
                        showResult();
                    } else {
                        displayQuestion();
                    }
                }
        
                function showResult() {
                    document.getElementById('gameArea').style.display = 'none';
                    document.getElementById('resultScreen').style.display = 'block';
        
                    const totalQuestions = 10;
                    const correctAnswers = gameState.score;
                    const percentage = Math.round((correctAnswers / totalQuestions) * 100);
                    
                    let message = '';
                    if (percentage === 100) {
                        message = 'ğŸ‰ ì™„ë²½í•´ìš”! ëª¨ë“  ë¬¸ì œë¥¼ ë§ì·„ì–´ìš”! ğŸ‰';
                    } else if (percentage >= 80) {
                        message = 'ğŸŒŸ í›Œë¥­í•´ìš”! ì •ë§ ì˜í–ˆì–´ìš”! ğŸŒŸ';
                    } else if (percentage >= 60) {
                        message = 'ğŸ‘ ì¢‹ì•„ìš”! ì¡°ê¸ˆë§Œ ë” ì—°ìŠµí•˜ë©´ ë” ì˜í•  ìˆ˜ ìˆì–´ìš”! ğŸ‘';
                    } else {
                        message = 'ğŸ’ª ê´œì°®ì•„ìš”! ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”! ğŸ’ª';
                    }
                    
                    document.getElementById('finalScore').innerHTML = `
                        <div style="margin-bottom: 20px;">
                            <div style="font-size: 1.1em; margin-bottom: 10px;">
                                ì´ <span style="color: #ff6b6b;">${totalQuestions}</span>ë¬¸ì œ ì¤‘ 
                                <span style="color: #ff6b6b;">${correctAnswers}</span>ë¬¸ì œ ì •ë‹µ!
                            </div>
                            <div style="font-size: 1.5em; color: #ff6b6b;">
                                ìµœì¢… ì ìˆ˜: ${gameState.score}ì 
                            </div>
                            <div style="font-size: 1.1em; margin-top: 20px; color: #000000;">
                                ${message}
                            </div>
                        </div>
                    `;
        
                    const wrongAnswersContainer = document.getElementById('wrongAnswers');
                    wrongAnswersContainer.style.display = 'none';
                }
        
                function restartGame() {
                    gameState.currentQuestionIndex = 0;
                    gameState.score = 0;
                    gameState.wrongAnswers = [];
                    gameState.isAnswered = false;
                    gameState.currentQuestion = null;
                    gameState.usedWords = [];
                    gameState.availableWords = [];
        
                    document.getElementById('score').textContent = '0';
                    document.getElementById('gameArea').style.display = 'block';
                    document.getElementById('resultScreen').style.display = 'none';

// ì¶”ê°€: í˜¹ì‹œ ìˆ¨ê²¨ì ¸ ìˆì„ ìˆ˜ ìˆëŠ” í”¼ë“œë°±ê³¼ ë‹¤ìŒ ë²„íŠ¼ë„ ì´ˆê¸°í™”
    document.getElementById('feedback').classList.add('hidden');
    document.getElementById('nextButton').classList.add('hidden');
        
                    displayQuestion();
                }
        
             function initializeGame() {
    // ê²Œì„ ìƒíƒœ ì™„ì „ ì´ˆê¸°í™”
    gameState.currentQuestionIndex = 0;
    gameState.score = 0;
    gameState.wrongAnswers = [];
    gameState.isAnswered = false;
    gameState.currentQuestion = null;
    gameState.usedWords = [];
    gameState.availableWords = [];
    
    // UI ì´ˆê¸°í™”
    document.getElementById('score').textContent = '0';
    document.getElementById('gameArea').style.display = 'block';
    document.getElementById('resultScreen').style.display = 'none';
    
    displayQuestion();
    setTimeout(playAudio, 1000);
}
        
                // ì•± ì‹œì‘ ì‹œ ë©”ì¸ ë©”ë‰´ í‘œì‹œ
                window.onload = function() {
                    showMainMenu();
                };
        
               // íšìˆœ ë°ì´í„° ì •ì˜
        
        // ê° ìëª¨ë³„ ê°œë³„ ì¡°ì •ê°’ (í¬ê¸°, ìœ„ì¹˜)
        const STROKE_ADJUSTMENTS = {
            'ã„±': { scaleX: 1.4, scaleY: 1.0, offsetX: 20, offsetY: -10 },
            'ã„´': { scaleX: 1.4, scaleY: 1.0, offsetX: 0, offsetY: -13 },
            'ã„·': { scaleX: 1.1, scaleY: 1.0, offsetX: 10, offsetY: -10 },  
            'ã„¹': { scaleX: 1.2, scaleY: 1.0, offsetX: 30, offsetY: 0 },  
            'ã…': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: -10 },
            'ã…‚': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: -10 },
            'ã……': { scaleX: 1.1, scaleY: 1.0, offsetX: -10, offsetY: 0 },
            'ã…‡': { scaleX: 1.1, scaleY: 1.0, offsetX: 0, offsetY: 0 },
            'ã…ˆ': { scaleX: 1.3, scaleY: 1.0, offsetX: 0, offsetY: -10 },
            'ã…Š': { scaleX: 1.4, scaleY: 1.0, offsetX: 15, offsetY: 0 },
            'ã…‹': { scaleX: 1.4, scaleY: 1.0, offsetX: 20, offsetY: -10 },
            'ã…Œ': { scaleX: 1.1, scaleY: 1.0, offsetX: 10, offsetY: -10 },
            'ã…': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: -10 },
            'ã…': { scaleX: 1.0, scaleY: 1.0, offsetX: 20, offsetY: -15 },
            
            // ëª¨ìŒ
            'ã…': { scaleX: 1.4, scaleY: 1.0, offsetX: 0, offsetY: 0 },
            'ã…‘': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
            'ã…“': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
            'ã…•': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
            'ã…—': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
            'ã…›': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
            'ã…œ': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
            'ã… ': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
            'ã…¡': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
           'ã…£': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        
        // ìŒììŒ ì¡°ì •ê°’
        'ã„²': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: -10 },
        'ã„¸': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: -10 },
        'ã…ƒ': { scaleX: 0.9, scaleY: 1.0, offsetX: 0, offsetY: -10 },
        'ã…†': { scaleX: 0.8, scaleY: 1.0, offsetX: -10, offsetY: 0 },
        'ã…‰': { scaleX: 1.1, scaleY: 1.0, offsetX: 0, offsetY: -10 },
        
        // ì´ì¤‘ëª¨ìŒ ì¡°ì •ê°’
        'ã…': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…’': { scaleX: 0.9, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…”': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…–': { scaleX: 0.9, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…˜': { scaleX: 0.8, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…™': { scaleX: 0.7, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…š': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…': { scaleX: 0.8, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…': { scaleX: 0.7, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…Ÿ': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 },
        'ã…¢': { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 }
        };
        
        // ê¸°ë³¸ê°’ (ì¡°ì •ê°’ì´ ì—†ëŠ” ìëª¨ìš©)
        const DEFAULT_ADJUSTMENT = { scaleX: 1.0, scaleY: 1.0, offsetX: 0, offsetY: 0 };
        const STROKE_ORDER = {
            'ã„±': [
                [{ type: 'line', start: [0.2, 0.3], end: [0.6, 0.3] }, { type: 'line', start: [0.6, 0.3], end: [0.6, 0.7] }]  // 1íš: ê°€ë¡œ+ì„¸ë¡œ ì—°ê²°
            ],
            'ã„´': [
                [{ type: 'line', start: [0.3, 0.2], end: [0.3, 0.7] }, { type: 'line', start: [0.3, 0.7], end: [0.7, 0.7] }]  // 1íš: ì„¸ë¡œ+ê°€ë¡œ ì—°ê²°
            ],
            'ã„·': [
                [{ type: 'line', start: [0.2, 0.3], end: [0.7, 0.3] }],  // 1íš: ìœ„ìª½ ê°€ë¡œíš
                [{ type: 'line', start: [0.2, 0.3], end: [0.2, 0.7] }, { type: 'line', start: [0.2, 0.7], end: [0.7, 0.7] }]  // 2íš: ì„¸ë¡œ+ê°€ë¡œ ì—°ê²°
            ],
         'ã„¹': [
            [{ type: 'line', start: [0.15, 0.25], end: [0.6, 0.25] }, { type: 'line', start: [0.6, 0.25], end: [0.6, 0.45] }],  // 1íš: ê°€ë¡œ+ì„¸ë¡œ
            [{ type: 'line', start: [0.15, 0.45], end: [0.6, 0.45] }],  // 2íš: ê°€ë¡œíš
            [{ type: 'line', start: [0.15, 0.45], end: [0.15, 0.65] }, { type: 'line', start: [0.15, 0.65], end: [0.6, 0.65] }]  // 3íš: ì„¸ë¡œ+ê°€ë¡œ (0.7â†’0.65ë¡œ ë‹¨ì¶•)
        ],
          'ã…': [
            [{ type: 'line', start: [0.25, 0.3], end: [0.25, 0.7] }],  // 1íš: ì™¼ìª½ ì„¸ë¡œíš (0.25â†’0.3, 0.75â†’0.7)
            [{ type: 'line', start: [0.25, 0.3], end: [0.75, 0.3] }, { type: 'line', start: [0.75, 0.3], end: [0.75, 0.7] }],  // 2íš: ê°€ë¡œ+ì„¸ë¡œ (0.25â†’0.3, 0.75â†’0.7)
            [{ type: 'line', start: [0.25, 0.7], end: [0.75, 0.7] }]  // 3íš: ì•„ë˜ ê°€ë¡œíš (0.75â†’0.7)
        ],
           'ã…‚': [
            [{ type: 'line', start: [0.25, 0.3], end: [0.25, 0.7] }],   // 1íš: ì™¼ìª½ ì„¸ë¡œíš (0.25â†’0.3, 0.75â†’0.7)
            [{ type: 'line', start: [0.75, 0.3], end: [0.75, 0.7] }],   // 2íš: ì˜¤ë¥¸ìª½ ì„¸ë¡œíš (0.25â†’0.3, 0.75â†’0.7)
            [{ type: 'line', start: [0.25, 0.45], end: [0.75, 0.45] }], // 3íš: ê°€ìš´ë° ê°€ë¡œíš (0.5â†’0.45)
            [{ type: 'line', start: [0.25, 0.7], end: [0.75, 0.7] }]    // 4íš: ì•„ë˜ ê°€ë¡œíš (0.75â†’0.7)
        ],
        'ã……': [
            [{ type: 'line', start: [0.6, 0.3], end: [0.3, 0.7] }],     // 1íš: ì˜¤ë¥¸ìª½ ëŒ€ê°ì„  (ê·¸ëŒ€ë¡œ ìœ ì§€)
            [{ type: 'line', start: [0.53, 0.4], end: [0.8, 0.66] }]    // 2íš: ì™¼ìª½ ëŒ€ê°ì„  (ì¡°ê¸ˆ ë” ì´ë™ + ê¸¸ì´ ì—°ì¥)
        ],
            'ã…‡': [
                [{ type: 'circle', center: [0.5, 0.5], radius: 0.2 }]       // 1íš: ì›
            ],
           'ã…ˆ': [
            [{ type: 'line', start: [0.2, 0.3], end: [0.6, 0.3] }, { type: 'line', start: [0.6, 0.3], end: [0.3, 0.7] }],  // 1íš: ê°€ë¡œ+ëŒ€ê°ì„ 
            [{ type: 'line', start: [0.45, 0.5], end: [0.7, 0.65] }]    // 2íš: ì˜¤ë¥¸ìª½ ëŒ€ê°ì„  (ê¸¸ì´ ë‹¨ì¶•)
        ],
          'ã…Š': [
            [{ type: 'line', start: [0.3, 0.25], end: [0.5, 0.25] }],   // 1íš: ì§§ì€ ê°€ë¡œì¤„
            [{ type: 'line', start: [0.2, 0.35], end: [0.6, 0.35] }, { type: 'line', start: [0.6, 0.35], end: [0.3, 0.7] }],  // 2íš: ê°€ë¡œ+ëŒ€ê°ì„ 
            [{ type: 'line', start: [0.45, 0.525], end: [0.65, 0.7] }]  // 3íš: ì˜¤ë¥¸ìª½ ëŒ€ê°ì„  (ê¸¸ì´ ë‹¨ì¶•)
        ],
            'ã…‹': [
                [{ type: 'line', start: [0.2, 0.3], end: [0.6, 0.3] }, { type: 'line', start: [0.6, 0.3], end: [0.6, 0.7] }],  // 1íš: ê°€ë¡œ+ì„¸ë¡œ
                [{ type: 'line', start: [0.2, 0.5], end: [0.6, 0.5] }]      // 2íš: ê°€ìš´ë° ê°€ë¡œíš
            ],
         'ã…Œ': [
            [{ type: 'line', start: [0.2, 0.3], end: [0.7, 0.3] }],     // 1íš: ìœ„ ê°€ë¡œíš
            [{ type: 'line', start: [0.2, 0.5], end: [0.7, 0.5] }],     // 2íš: ê°€ìš´ë° ê°€ë¡œíš
            [{ type: 'line', start: [0.2, 0.3], end: [0.2, 0.7] }, { type: 'line', start: [0.2, 0.7], end: [0.7, 0.7] }]   // 3íš: ì„¸ë¡œ+ì•„ë˜ ê°€ë¡œ
        ],
            'ã…': [
                [{ type: 'line', start: [0.2, 0.3], end: [0.8, 0.3] }],     // 1íš: ìœ„ ê°€ë¡œíš
                [{ type: 'line', start: [0.35, 0.3], end: [0.35, 0.7] }],   // 2íš: ì™¼ìª½ ì„¸ë¡œíš
                [{ type: 'line', start: [0.65, 0.3], end: [0.65, 0.7] }],   // 3íš: ì˜¤ë¥¸ìª½ ì„¸ë¡œíš
                [{ type: 'line', start: [0.2, 0.7], end: [0.8, 0.7] }]      // 4íš: ì•„ë˜ ê°€ë¡œíš
            ],
        'ã…': [
            [{ type: 'line', start: [0.3, 0.25], end: [0.5, 0.25] }],   // 1íš: ì§§ì€ ê°€ë¡œì¤„ (ê¸¸ì´ ë‹¨ì¶•)
            [{ type: 'line', start: [0.15, 0.35], end: [0.65, 0.35] }], // 2íš: ê¸´ ê°€ë¡œì¤„
            [{ type: 'circle', center: [0.4, 0.6], radius: 0.15 }]      // 3íš: ì›
        ],    
            // ëª¨ìŒ
            'ã…': [
                [{ type: 'line', start: [0.5, 0.2], end: [0.5, 0.8] }],     // 1íš: ê¸´ ì„¸ë¡œì¤„
                [{ type: 'line', start: [0.5, 0.5], end: [0.7, 0.5] }]      // 2íš: ì§§ì€ ê°€ë¡œì¤„
            ],
           'ã…‘': [
            [{ type: 'line', start: [0.5, 0.2], end: [0.5, 0.8] }],     // 1íš: ê¸´ ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.5, 0.42], end: [0.7, 0.42] }],   // 2íš: ìœ„ ê°€ë¡œì¤„ (0.45â†’0.42)
            [{ type: 'line', start: [0.5, 0.58], end: [0.7, 0.58] }]    // 3íš: ì•„ë˜ ê°€ë¡œì¤„ (0.55â†’0.58)
        ],
            'ã…“': [
                [{ type: 'line', start: [0.3, 0.5], end: [0.5, 0.5] }],     // 1íš: ì§§ì€ ê°€ë¡œì¤„
                [{ type: 'line', start: [0.5, 0.2], end: [0.5, 0.8] }]      // 2íš: ê¸´ ì„¸ë¡œì¤„
            ],
           'ã…•': [
            [{ type: 'line', start: [0.3, 0.42], end: [0.5, 0.42] }],   // 1íš: ìœ„ ê°€ë¡œì¤„ (0.45â†’0.42)
            [{ type: 'line', start: [0.3, 0.58], end: [0.5, 0.58] }],   // 2íš: ì•„ë˜ ê°€ë¡œì¤„ (0.55â†’0.58)
            [{ type: 'line', start: [0.5, 0.2], end: [0.5, 0.8] }]      // 3íš: ê¸´ ì„¸ë¡œì¤„
        ],
            'ã…—': [
                [{ type: 'line', start: [0.5, 0.3], end: [0.5, 0.45] }],    // 1íš: ì§§ì€ ì„¸ë¡œì¤„
                [{ type: 'line', start: [0.2, 0.45], end: [0.8, 0.45] }]    // 2íš: ê¸´ ê°€ë¡œì¤„
            ],
           'ã…›': [
            [{ type: 'line', start: [0.42, 0.3], end: [0.42, 0.45] }],  // 1íš: ì™¼ìª½ ì„¸ë¡œì¤„ (0.45â†’0.42)
            [{ type: 'line', start: [0.58, 0.3], end: [0.58, 0.45] }],  // 2íš: ì˜¤ë¥¸ìª½ ì„¸ë¡œì¤„ (0.55â†’0.58)
            [{ type: 'line', start: [0.2, 0.45], end: [0.8, 0.45] }]    // 3íš: ê¸´ ê°€ë¡œì¤„
        ],
            'ã…œ': [
                [{ type: 'line', start: [0.2, 0.55], end: [0.8, 0.55] }],   // 1íš: ê¸´ ê°€ë¡œì¤„
                [{ type: 'line', start: [0.5, 0.55], end: [0.5, 0.7] }]     // 2íš: ì§§ì€ ì„¸ë¡œì¤„
            ],
            'ã… ': [
                [{ type: 'line', start: [0.2, 0.55], end: [0.8, 0.55] }],   // 1íš: ê¸´ ê°€ë¡œì¤„
                [{ type: 'line', start: [0.4, 0.55], end: [0.4, 0.7] }],    // 2íš: ì™¼ìª½ ì„¸ë¡œì¤„
                [{ type: 'line', start: [0.6, 0.55], end: [0.6, 0.7] }]     // 3íš: ì˜¤ë¥¸ìª½ ì„¸ë¡œì¤„
            ],
            'ã…¡': [
                [{ type: 'line', start: [0.2, 0.5], end: [0.8, 0.5] }]      // 1íš: ê¸´ ê°€ë¡œì¤„
            ],
         'ã…£': [
            [{ type: 'line', start: [0.5, 0.2], end: [0.5, 0.8] }]      // 1íš: ê¸´ ì„¸ë¡œì¤„
        ],
        
        // ìŒììŒ (ê¸°ë³¸ ììŒ 2ë²ˆ ë°˜ë³µ)
        'ã„²': [
            [{ type: 'line', start: [0.15, 0.3], end: [0.45, 0.3] }, { type: 'line', start: [0.45, 0.3], end: [0.45, 0.7] }],  // 1íš: ì²« ë²ˆì§¸ ã„±
            [{ type: 'line', start: [0.55, 0.3], end: [0.85, 0.3] }, { type: 'line', start: [0.85, 0.3], end: [0.85, 0.7] }]   // 2íš: ë‘ ë²ˆì§¸ ã„±
        ],
        'ã„¸': [
            [{ type: 'line', start: [0.15, 0.3], end: [0.45, 0.3] }],  // 1íš: ì²« ë²ˆì§¸ ã„· ìœ„ìª½ ê°€ë¡œíš
            [{ type: 'line', start: [0.15, 0.3], end: [0.15, 0.7] }, { type: 'line', start: [0.15, 0.7], end: [0.45, 0.7] }],  // 2íš: ì²« ë²ˆì§¸ ã„· ì„¸ë¡œ+ê°€ë¡œ
            [{ type: 'line', start: [0.55, 0.3], end: [0.85, 0.3] }],  // 3íš: ë‘ ë²ˆì§¸ ã„· ìœ„ìª½ ê°€ë¡œíš
            [{ type: 'line', start: [0.55, 0.3], end: [0.55, 0.7] }, { type: 'line', start: [0.55, 0.7], end: [0.85, 0.7] }]   // 4íš: ë‘ ë²ˆì§¸ ã„· ì„¸ë¡œ+ê°€ë¡œ
        ],
        'ã…ƒ': [
            [{ type: 'line', start: [0.16, 0.3], end: [0.16, 0.7] }],   // 1íš: ì²« ë²ˆì§¸ ã…‚ ì™¼ìª½ ì„¸ë¡œíš (0.18â†’0.16)
            [{ type: 'line', start: [0.39, 0.3], end: [0.39, 0.7] }],   // 2íš: ì²« ë²ˆì§¸ ã…‚ ì˜¤ë¥¸ìª½ ì„¸ë¡œíš (0.37â†’0.39)
            [{ type: 'line', start: [0.16, 0.45], end: [0.39, 0.45] }], // 3íš: ì²« ë²ˆì§¸ ã…‚ ê°€ìš´ë° ê°€ë¡œíš
            [{ type: 'line', start: [0.16, 0.7], end: [0.39, 0.7] }],   // 4íš: ì²« ë²ˆì§¸ ã…‚ ì•„ë˜ ê°€ë¡œíš
            [{ type: 'line', start: [0.61, 0.3], end: [0.61, 0.7] }],   // 5íš: ë‘ ë²ˆì§¸ ã…‚ ì™¼ìª½ ì„¸ë¡œíš (0.63â†’0.61)
            [{ type: 'line', start: [0.84, 0.3], end: [0.84, 0.7] }],   // 6íš: ë‘ ë²ˆì§¸ ã…‚ ì˜¤ë¥¸ìª½ ì„¸ë¡œíš (0.82â†’0.84)
            [{ type: 'line', start: [0.61, 0.45], end: [0.84, 0.45] }], // 7íš: ë‘ ë²ˆì§¸ ã…‚ ê°€ìš´ë° ê°€ë¡œíš
            [{ type: 'line', start: [0.61, 0.7], end: [0.84, 0.7] }]    // 8íš: ë‘ ë²ˆì§¸ ã…‚ ì•„ë˜ ê°€ë¡œíš
        ],
        'ã…†': [
            [{ type: 'line', start: [0.4, 0.3], end: [0.15, 0.7] }],    // 1íš: ì²« ë²ˆì§¸ ã…… ì˜¤ë¥¸ìª½ ëŒ€ê°ì„ 
            [{ type: 'line', start: [0.33, 0.4], end: [0.55, 0.66] }],  // 2íš: ì²« ë²ˆì§¸ ã…… ì™¼ìª½ ëŒ€ê°ì„ 
            [{ type: 'line', start: [0.8, 0.3], end: [0.55, 0.7] }],    // 3íš: ë‘ ë²ˆì§¸ ã…… ì˜¤ë¥¸ìª½ ëŒ€ê°ì„ 
            [{ type: 'line', start: [0.73, 0.4], end: [0.95, 0.66] }]   // 4íš: ë‘ ë²ˆì§¸ ã…… ì™¼ìª½ ëŒ€ê°ì„ 
        ],
        'ã…‰': [
            [{ type: 'line', start: [0.2, 0.3], end: [0.4, 0.3] }, { type: 'line', start: [0.4, 0.3], end: [0.25, 0.7] }],   // 1íš: ì²« ë²ˆì§¸ ã…ˆ ê°€ë¡œ+ëŒ€ê°ì„ 
            [{ type: 'line', start: [0.32, 0.5], end: [0.45, 0.65] }],  // 2íš: ì²« ë²ˆì§¸ ã…ˆ ì˜¤ë¥¸ìª½ ëŒ€ê°ì„ 
            [{ type: 'line', start: [0.5, 0.3], end: [0.7, 0.3] }, { type: 'line', start: [0.7, 0.3], end: [0.55, 0.7] }],   // 3íš: ë‘ ë²ˆì§¸ ã…ˆ ê°€ë¡œ+ëŒ€ê°ì„  (0.6â†’0.5, 0.8â†’0.7)
            [{ type: 'line', start: [0.62, 0.5], end: [0.75, 0.65] }]   // 4íš: ë‘ ë²ˆì§¸ ã…ˆ ì˜¤ë¥¸ìª½ ëŒ€ê°ì„  (0.72â†’0.62, 0.85â†’0.75)
        ],
        // ì´ì¤‘ëª¨ìŒ (ê¸°ë³¸ ëª¨ìŒ ì¡°í•©)
        'ã…': [
            [{ type: 'line', start: [0.4, 0.2], end: [0.4, 0.8] }],     // 1íš: ã… ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.4, 0.5], end: [0.6, 0.5] }],     // 2íš: ã… ê°€ë¡œì¤„
            [{ type: 'line', start: [0.6, 0.2], end: [0.6, 0.8] }]      // 3íš: ã…£ ì„¸ë¡œì¤„
        ],
        'ã…’': [
            [{ type: 'line', start: [0.4, 0.2], end: [0.4, 0.8] }],     // 1íš: ã…‘ ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.4, 0.42], end: [0.6, 0.42] }],   // 2íš: ã…‘ ìœ„ ê°€ë¡œì¤„ (ê¸¸ì´ 0.2)
            [{ type: 'line', start: [0.4, 0.58], end: [0.6, 0.58] }],   // 3íš: ã…‘ ì•„ë˜ ê°€ë¡œì¤„ (ê¸¸ì´ 0.2)
            [{ type: 'line', start: [0.6, 0.2], end: [0.6, 0.8] }]      // 4íš: ã…£ ì„¸ë¡œì¤„ (0.7â†’0.6)
        ],
        'ã…”': [
            [{ type: 'line', start: [0.4, 0.5], end: [0.6, 0.5] }],     // 1íš: ã…“ ê°€ë¡œì¤„
            [{ type: 'line', start: [0.6, 0.2], end: [0.6, 0.8] }],     // 2íš: ã…“ ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.7, 0.2], end: [0.7, 0.8] }]      // 3íš: ã…£ ì„¸ë¡œì¤„
        ],
        'ã…–': [
            [{ type: 'line', start: [0.3, 0.42], end: [0.5, 0.42] }],   // 1íš: ã…• ìœ„ ê°€ë¡œì¤„
            [{ type: 'line', start: [0.3, 0.58], end: [0.5, 0.58] }],   // 2íš: ã…• ì•„ë˜ ê°€ë¡œì¤„
            [{ type: 'line', start: [0.5, 0.2], end: [0.5, 0.8] }],     // 3íš: ã…• ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.6, 0.2], end: [0.6, 0.8] }]      // 4íš: ã…£ ì„¸ë¡œì¤„ (0.7â†’0.6)
        ],
        'ã…˜': [
            [{ type: 'line', start: [0.4, 0.3], end: [0.4, 0.45] }],    // 1íš: ã…— ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.15, 0.45], end: [0.65, 0.45] }], // 2íš: ã…— ê°€ë¡œì¤„
            [{ type: 'line', start: [0.75, 0.15], end: [0.75, 0.75] }], // 3íš: ã… ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.75, 0.4], end: [0.95, 0.4] }]    // 4íš: ã… ê°€ë¡œì¤„ (ìœ„ë¡œ ì´ë™)
        ],
        'ã…™': [
            [{ type: 'line', start: [0.35, 0.3], end: [0.35, 0.45] }],  // 1íš: ã…— ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.1, 0.45], end: [0.6, 0.45] }],   // 2íš: ã…— ê°€ë¡œì¤„
            [{ type: 'line', start: [0.7, 0.15], end: [0.7, 0.75] }],   // 3íš: ã… ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.7, 0.4], end: [0.9, 0.4] }],     // 4íš: ã… ê°€ë¡œì¤„ (ìœ„ë¡œ ì´ë™)
            [{ type: 'line', start: [0.95, 0.15], end: [0.95, 0.75] }]  // 5íš: ã…£ ì„¸ë¡œì¤„
        ],
        
        'ã…š': [
            [{ type: 'line', start: [0.4, 0.3], end: [0.4, 0.45] }],    // 1íš: ã…— ì„¸ë¡œì¤„
            [{ type: 'line', start: [0.15, 0.45], end: [0.65, 0.45] }], // 2íš: ã…— ê°€ë¡œì¤„ (y=0.45)
            [{ type: 'line', start: [0.7, 0.15], end: [0.7, 0.75] }]    // 3íš: ã…£ ì„¸ë¡œì¤„ (0.1â†’0.15, 0.75â†’0.75)
        ],
        'ã…': [
            [{ type: 'line', start: [0.15, 0.55], end: [0.65, 0.55] }], // 1íš: ã…œ ê°€ë¡œì¤„
            [{ type: 'line', start: [0.4, 0.55], end: [0.4, 0.75] }],    // 2íš: ã…œ ì„¸ë¡œì¤„ (ê¸¸ì´ ëŠ˜ë¦¼)
            [{ type: 'line', start: [0.55, 0.65], end: [0.75, 0.65] }],   // 3íš: ã…“ ê°€ë¡œì¤„ (ì›ë˜ ê¸¸ì´ë¡œ ë³µì›)
            [{ type: 'line', start: [0.75, 0.3], end: [0.75, 0.8] }]    // 4íš: ã…“ ì„¸ë¡œì¤„ (0.45â†’0.3ìœ¼ë¡œ ìœ„ë¡œ ì—°ì¥)
        ],
        'ã…': [
            [{ type: 'line', start: [0.05, 0.5], end: [0.5, 0.5] }],    // 1íš: ã…œ ê°€ë¡œì¤„
            [{ type: 'line', start: [0.275, 0.5], end: [0.275, 0.7] }], // 2íš: ã…œ ì„¸ë¡œì¤„ (ê¸¸ì´ ëŠ˜ë¦¼)
            [{ type: 'line', start: [0.5, 0.6], end: [0.7, 0.6] }],   // 3íš: ã…“ ê°€ë¡œì¤„ (0.55â†’0.6ë¡œ ë” ì•„ë˜ë¡œ ì´ë™)
            [{ type: 'line', start: [0.7, 0.25], end: [0.7, 0.75] }],     // 4íš: ã…“ ì„¸ë¡œì¤„ (0.3â†’0.25ë¡œ ìœ„ë¡œ ì—°ì¥)
            [{ type: 'line', start: [0.85, 0.25], end: [0.85, 0.75] }]    // 5íš: ã…£ ì„¸ë¡œì¤„ (0.3â†’0.25ë¡œ ìœ„ë¡œ ì—°ì¥)
        ],
        'ã…Ÿ': [
            [{ type: 'line', start: [0.15, 0.55], end: [0.65, 0.55] }], // 1íš: ã…œ ê°€ë¡œì¤„
            [{ type: 'line', start: [0.4, 0.55], end: [0.4, 0.7] }],    // 2íš: ã…œ ì„¸ë¡œì¤„ (0.3â†’0.4, ê°€ìš´ë°ë¡œ)
            [{ type: 'line', start: [0.7, 0.2], end: [0.7, 0.8] }]      // 3íš: ã…£ ì„¸ë¡œì¤„
        ],
        'ã…¢': [
            [{ type: 'line', start: [0.2, 0.5], end: [0.6, 0.5] }],     // 1íš: ã…¡ ê°€ë¡œì¤„
            [{ type: 'line', start: [0.7, 0.2], end: [0.7, 0.8] }]      // 2íš: ã…£ ì„¸ë¡œì¤„
        ]
        };
        
        // ììŒÂ·ëª¨ìŒ í•™ìŠµ ê´€ë ¨ í•¨ìˆ˜ë“¤
                function initializeJamoLearning() {
                    createConsonantCards();
                    createVowelCards();
                    createFinalCards();
                    showJamoTab('consonants'); // ê¸°ë³¸ì ìœ¼ë¡œ ììŒ íƒ­ í‘œì‹œ
                }
        
                function showJamoTab(tabName) {
                    // ëª¨ë“  íƒ­ ë²„íŠ¼ ë¹„í™œì„±í™”
                    document.querySelectorAll('.jamo-tab-button').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // ëª¨ë“  íƒ­ ì»¨í…ì¸  ìˆ¨ê¸°ê¸°
                    document.querySelectorAll('.jamo-tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    
                    // ì„ íƒëœ íƒ­ í™œì„±í™”
                    if (tabName === 'consonants') {
                        document.querySelector('.jamo-tab-button:nth-child(1)').classList.add('active');
                        document.getElementById('consonantsTab').classList.remove('hidden');
                    } else if (tabName === 'vowels') {
                        document.querySelector('.jamo-tab-button:nth-child(2)').classList.add('active');
                        document.getElementById('vowelsTab').classList.remove('hidden');
                    } else if (tabName === 'finals') {
                        document.querySelector('.jamo-tab-button:nth-child(3)').classList.add('active');
                        document.getElementById('finalsTab').classList.remove('hidden');
                    }
                }
        
                function createConsonantCards() {
                    // ê¸°ë³¸ ììŒ (ã„±-ã…) + ìŒììŒ ìˆœì„œë¡œ ë°°ì—´
                    const consonants = [
                        // ê¸°ë³¸ ììŒ
                        'ã„±', 'ã„´', 'ã„·', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡', 'ã…ˆ', 'ã…Š', 'ã…‹', 'ã…Œ', 'ã…', 'ã…',
                        // ìŒììŒ
                        'ã„²', 'ã„¸', 'ã…ƒ', 'ã…†', 'ã…‰'
                    ];
                    const grid = document.getElementById('consonantsGrid');
                    grid.innerHTML = '';
        
                    consonants.forEach(consonant => {
                        const sound = INITIAL_PRONUNCIATION[consonant] || consonant;
                        const card = createJamoCard(consonant, sound, 'consonant', 'ììŒ');
                        grid.appendChild(card);
                    });
                }
        
                function createVowelCards() {
                    // ê¸°ë³¸ ëª¨ìŒ (ã…-ã…£) + ì´ì¤‘ëª¨ìŒ ìˆœì„œë¡œ ë°°ì—´
                    const vowels = [
                        // ê¸°ë³¸ ëª¨ìŒ
                        'ã…', 'ã…‘', 'ã…“', 'ã…•', 'ã…—', 'ã…›', 'ã…œ', 'ã… ', 'ã…¡', 'ã…£',
                        // ì´ì¤‘ëª¨ìŒ
                        'ã…', 'ã…’', 'ã…”', 'ã…–', 'ã…˜', 'ã…™', 'ã…š', 'ã…', 'ã…', 'ã…Ÿ', 'ã…¢'
                    ];
                    const grid = document.getElementById('vowelsGrid');
                    grid.innerHTML = '';
        
                    vowels.forEach(vowel => {
                        const sound = VOWEL_PRONUNCIATION[vowel] || vowel;
                        const card = createJamoCard(vowel, sound, 'vowel', 'ëª¨ìŒ');
                        grid.appendChild(card);
                    });
                }
        
                function createFinalCards() {
                    // ê¸°ë³¸ ë°›ì¹¨ 7ê°œ (ã„±,ã„´,ã„¹,ã…,ã…‚,ã……,ã…‡)
                    const finals = ['ã„±', 'ã„´', 'ã„¹', 'ã…', 'ã…‚', 'ã……', 'ã…‡'];
                    const grid = document.getElementById('finalsGrid');
                    grid.innerHTML = '';
        
                    finals.forEach(final => {
                        const sound = FINAL_PRONUNCIATION[final] || final;
                        const card = createJamoCard(final, sound, 'final', 'ë°›ì¹¨');
                        grid.appendChild(card);
                    });
                }
        
              function createJamoCard(jamo, sound, type, typeLabel) {
            const card = document.createElement('div');
            card.className = `jamo-card ${type}-card`;
            
            card.innerHTML = `
                <div class="jamo-card-jamo">${jamo}</div>
                <div class="jamo-card-type ${type}-type">${typeLabel}</div>
            `;
        
                card.addEventListener('click', () => {
    // íšìˆœ ëª¨ë‹¬ì°½ ì—´ê¸° (í†µê³„ëŠ” ëª¨ë‹¬ì°½ì—ì„œ ì‹¤ì œ ê·¸ë¦¬ê¸° í›„ ë‹«ì„ ë•Œ ê¸°ë¡)
    openStrokeModal(jamo, sound, type);
});
              
                    return card;
                }
        
                // íšìˆœ ëª¨ë‹¬ì°½ ê´€ë ¨ ë³€ìˆ˜ë“¤
                let currentJamo = '';
                let currentSound = '';
                let currentType = '';
                let canvas = null;
                let ctx = null;
                let isDrawing = false;
                let isPracticeMode = false;
        let currentStrokeIndex = 0;
                let strokeAnimationInterval = null;
                let isShowingStrokes = false;
let hasUserDrawn = false;
        
          function openStrokeModal(jamo, sound, type) {
    console.log('ëª¨ë‹¬ ì—´ê¸°:', jamo, sound, type);
    currentJamo = jamo;
    currentSound = sound;
    currentType = type;
    hasUserDrawn = false;

    document.getElementById('modalJamoTitle').textContent = jamo;
    document.getElementById('strokeOrderModal').classList.remove('hidden');

    // ëª¨ë‹¬ì´ ì—´ë¦¬ìë§ˆì ì¦‰ì‹œ ì§€ìš°ê¸° ë²„íŠ¼ ìˆ¨ê¸°ê¸°
    const clearButton = document.querySelector('.stroke-btn');
    if (clearButton) {
        clearButton.style.display = 'none';
    }

    // ì†Œë¦¬ ì¬ìƒ ë²„íŠ¼ì— ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    const soundReplayBtn = document.getElementById('soundReplayBtn');
    soundReplayBtn.removeEventListener('click', handleSoundReplay);
    soundReplayBtn.addEventListener('click', handleSoundReplay);

    // typeì´ 'consonant'ì´ê³  jamoê°€ 'ã…‡'ì¼ ë•Œë§Œ ìŠ¤í”¼ì»¤ ë²„íŠ¼ ìˆ¨ê¸°ê¸° (ììŒ ã…‡)
    if (jamo === 'ã…‡' && type === 'consonant') {
        soundReplayBtn.style.display = 'none';
    } else {
        soundReplayBtn.style.display = 'block';
        // ë°›ì¹¨ ã…‡ì´ë‚˜ ë‹¤ë¥¸ ì†Œë¦¬ê°€ ìˆì„ ë•Œ ìë™ ì†Œë¦¬ ì¬ìƒ
        setTimeout(() => {
            playModalSound(sound);
        }, 300);
    }

    // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
    canvas = document.getElementById('strokeCanvas');
    ctx = canvas.getContext('2d');
    
    // ì•„ì´íŒ¨ë“œìš© ìº”ë²„ìŠ¤ ì„¤ì • ì¶”ê°€
    if (canvas) {
        canvas.style.touchAction = 'none';
        canvas.style.userSelect = 'none';
        canvas.style.webkitUserSelect = 'none';
        canvas.style.webkitTouchCallout = 'none';
    }
    
    setupCanvas();
    
    // ì•„ì´íŒ¨ë“œ í˜¸í™˜ì„±ì„ ìœ„í•œ ìº”ë²„ìŠ¤ ì™„ì „ ì´ˆê¸°í™” ì¶”ê°€
    setTimeout(() => {
        if (ctx) {
            // ìº”ë²„ìŠ¤ ì™„ì „ ì´ˆê¸°í™”
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.setTransform(1, 0, 0, 1, 0, 0);
            ctx.globalAlpha = 1;
            ctx.globalCompositeOperation = 'source-over';
            ctx.setLineDash([]);
            ctx.shadowColor = 'transparent';
            ctx.shadowBlur = 0;
        }
        
        clearCanvas();
        isPracticeMode = false;  // íšìˆœ ì¬ìƒ ëª¨ë“œë¡œ ì‹œì‘
        drawGuideCharacter();    // íšìˆœ ì¬ìƒ ì‹œì‘
    }, 300);
    console.log('ëª¨ë‹¬ ì„¤ì • ì™„ë£Œ, currentSound:', currentSound);
}
        
                // ì†Œë¦¬ ì¬ìƒ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
                function handleSoundReplay(event) {
                    event.preventDefault();
                    console.log('ì†Œë¦¬ ì¬ìƒ ë²„íŠ¼ í´ë¦­ë¨, currentSound:', currentSound);
                    try {
                        if (currentSound) {
                            playModalSound(currentSound);
                        } else {
                            console.error('currentSoundê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
                        }
                    } catch (error) {
                        console.error('ì†Œë¦¬ ì¬ìƒ ì¤‘ ì˜¤ë¥˜:', error);
                    }
                }
        
                // ëª¨ë‹¬ì°½ìš© ì†Œë¦¬ ì¬ìƒ í•¨ìˆ˜
           function playModalSound(sound) {
    playUnifiedSound(sound);
}
        
           function closeStrokeModal() {
    // ì‚¬ìš©ìê°€ ì‹¤ì œë¡œ ê·¸ë ¸ì„ ë•Œë§Œ í•™ìŠµ í†µê³„ ì—…ë°ì´íŠ¸
    if (hasUserDrawn && currentUser && currentJamo && currentType) {
        updateLearningStats(currentJamo, currentType);
    }
    
    // íšìˆœ ì• ë‹ˆë©”ì´ì…˜ ì¤‘ë‹¨
    stopStrokeAnimation();
    
    // ì§€ìš°ê¸° ë²„íŠ¼ ë‹¤ì‹œ í‘œì‹œ (ë‹¤ìŒ ëª¨ë‹¬ ì—´ê¸°ë¥¼ ìœ„í•´)
    const clearButton = document.querySelector('.stroke-btn');
    if (clearButton) {
        clearButton.style.display = 'block';
    }
    
    document.getElementById('strokeOrderModal').classList.add('hidden');
    if (canvas) {
        clearCanvas();
    }
    
    // ë³€ìˆ˜ ì´ˆê¸°í™”
    hasUserDrawn = false;
}
        
           function setupCanvas() {
    if (!canvas || !ctx) return;

    // ìº”ë²„ìŠ¤ ì„¤ì •
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    ctx.lineWidth = 8;
    
    // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°
    canvas.removeEventListener('touchstart', startDrawing);
    canvas.removeEventListener('touchmove', draw);
    canvas.removeEventListener('touchend', stopDrawing);
    canvas.removeEventListener('mousedown', startDrawing);
    canvas.removeEventListener('mousemove', draw);
    canvas.removeEventListener('mouseup', stopDrawing);
    canvas.removeEventListener('mouseout', stopDrawing);
    
    // í„°ì¹˜ ì´ë²¤íŠ¸ (ëª¨ë°”ì¼/ì•„ì´íŒ¨ë“œ) - passive: falseë¡œ preventDefault í—ˆìš©
    canvas.addEventListener('touchstart', startDrawing, { passive: false });
    canvas.addEventListener('touchmove', draw, { passive: false });
    canvas.addEventListener('touchend', stopDrawing, { passive: false });
    canvas.addEventListener('touchcancel', stopDrawing, { passive: false });
    
    // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸ (ë°ìŠ¤í¬íƒ‘)
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    
    // ì•„ì´íŒ¨ë“œìš© ì¶”ê°€ ì„¤ì •
    canvas.style.touchAction = 'none';
    canvas.style.userSelect = 'none';
    canvas.style.webkitUserSelect = 'none';
}
        
      function clearCanvas() {
    if (!ctx) return;
    
    // íšìˆœ ì• ë‹ˆë©”ì´ì…˜ ì¤‘ë‹¨
    stopStrokeAnimation();
    
    // ì•„ì´íŒ¨ë“œì—ì„œ ìº”ë²„ìŠ¤ ì™„ì „ ì´ˆê¸°í™”
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    // ìº”ë²„ìŠ¤ ìƒíƒœ ì™„ì „ ë¦¬ì…‹
    ctx.setTransform(1, 0, 0, 1, 0, 0);
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = '#000000';
    ctx.fillStyle = '#000000';
    ctx.lineWidth = 1;
    ctx.lineCap = 'butt';
    ctx.lineJoin = 'miter';
    ctx.setLineDash([]);
    ctx.shadowColor = 'transparent';
    ctx.shadowBlur = 0;
    
    // ì—°ìŠµëª¨ë“œì¼ ë•Œë§Œ ê°€ì´ë“œë¼ì¸ í‘œì‹œ
    if (isPracticeMode) {
        drawGuideLines();
    } else {
        drawGuideLines();
    }
}
        
               function drawGuideLines() {
    if (!ctx) return;
    
    // ì•„ì´íŒ¨ë“œì—ì„œ ê¸°ì¡´ ê·¸ë¦¬ê¸° ìƒíƒœ ì™„ì „ ì´ˆê¸°í™”
    ctx.save();
    ctx.setTransform(1, 0, 0, 1, 0, 0); // ë³€í˜• í–‰ë ¬ ì´ˆê¸°í™”
    ctx.globalAlpha = 1;
    ctx.globalCompositeOperation = 'source-over';
    
    // ê°€ì´ë“œë¼ì¸ ì „ìš© ìŠ¤íƒ€ì¼ ì„¤ì •
    ctx.strokeStyle = '#e0e0e0';
    ctx.fillStyle = 'transparent';
    ctx.lineWidth = 1;
    ctx.lineCap = 'butt';
    ctx.lineJoin = 'miter';
    ctx.setLineDash([5, 5]);
    ctx.shadowColor = 'transparent';
    ctx.shadowBlur = 0;
    
    // ì¤‘ì•™ ì‹­ìì„  ê·¸ë¦¬ê¸°
    ctx.beginPath();
    ctx.moveTo(canvas.width / 2, 0);
    ctx.lineTo(canvas.width / 2, canvas.height);
    ctx.moveTo(0, canvas.height / 2);
    ctx.lineTo(canvas.width, canvas.height / 2);
    ctx.stroke();
    
    // ìƒíƒœ ì™„ì „ ë³µì›
    ctx.setLineDash([]);
    ctx.restore();
}
        
               
     function practiceMode() {
    // ì•„ì´íŒ¨ë“œì—ì„œ ì™„ì „í•œ ëª¨ë“œ ì „í™˜ì„ ìœ„í•œ ê°•ë ¥í•œ ì´ˆê¸°í™”
    stopStrokeAnimation();
    isShowingStrokes = false;
    strokeAnimationInterval = null;
    
    // ìº”ë²„ìŠ¤ ì™„ì „ ì´ˆê¸°í™”
    if (ctx) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.restore(); // ì´ì „ ì €ì¥ëœ ìƒíƒœ ë³µì›
    }
    
    isPracticeMode = true;
    
    // ì—°ìŠµëª¨ë“œì—ì„œëŠ” ê°€ì´ë“œë¼ì¸ë§Œ í‘œì‹œ
    drawGuideLines();
}
        
         // â† ì—¬ê¸°ì— ì•„ë˜ í•¨ìˆ˜ë¥¼ ì¶”ê°€
                function createStrokeMask(strokeIndex) {
                    if (!ctx) return null;
                    
                    const strokes = STROKE_ORDER[currentJamo];
                    if (!strokes) return null;
                    
                    // ì„ì‹œ ìº”ë²„ìŠ¤ ìƒì„±
                    const maskCanvas = document.createElement('canvas');
                    const maskCtx = maskCanvas.getContext('2d');
                    maskCanvas.width = canvas.width;
                    maskCanvas.height = canvas.height;
                    
                    // í˜„ì¬ íšê¹Œì§€ì˜ ì˜ì—­ì„ ë§ˆìŠ¤í¬ë¡œ ìƒì„±
                    maskCtx.fillStyle = 'white';
                    const centerX = maskCanvas.width / 2;
                    const centerY = maskCanvas.height / 2;
                    
        
        // ê°œë³„ ì¡°ì •ê°’ ê°€ì ¸ì˜¤ê¸°
        const adjustment = STROKE_ADJUSTMENTS[currentJamo] || DEFAULT_ADJUSTMENT;
        
                    // ê¸€ì í¬ê¸° ê³„ì‚° + ê°œë³„ ì¡°ì •
        maskCtx.font = '200px "Malgun Gothic", Arial, sans-serif';
        const metrics = maskCtx.measureText(currentJamo);
        const actualFontHeight = 200 * 1.0;
        const scaleX = actualFontHeight * adjustment.scaleX;
        const scaleY = actualFontHeight * adjustment.scaleY;
        const adjustedCenterX = centerX + adjustment.offsetX;
        const adjustedCenterY = centerY + adjustment.offsetY;
                    
                    for (let i = 0; i <= strokeIndex; i++) {
                        const strokeGroup = strokes[i];
                        maskCtx.lineWidth = 12;
                        maskCtx.lineCap = 'round';
                        maskCtx.strokeStyle = 'white';
                        
                        for (let j = 0; j < strokeGroup.length; j++) {
                            const stroke = strokeGroup[j];
                            maskCtx.beginPath();
                            
                           if (stroke.type === 'line') {
            const startX = adjustedCenterX + (stroke.start[0] - 0.5) * scaleX;
            const startY = adjustedCenterY + (stroke.start[1] - 0.5) * scaleY;
            const endX = adjustedCenterX + (stroke.end[0] - 0.5) * scaleX;
            const endY = adjustedCenterY + (stroke.end[1] - 0.5) * scaleY;
                                
                                maskCtx.moveTo(startX, startY);
                                maskCtx.lineTo(endX, endY);
                          } else if (stroke.type === 'circle') {
            const circleX = adjustedCenterX + (stroke.center[0] - 0.5) * scaleX;
            const circleY = adjustedCenterY + (stroke.center[1] - 0.5) * scaleY;
                                const radius = stroke.radius * scaleX;  
                                
                                maskCtx.arc(circleX, circleY, radius, 0, 2 * Math.PI);
                            }
                            maskCtx.stroke();
                        }
                    }
                    
                    return maskCanvas;
                }
        
  function drawGuideCharacter() {
    if (!ctx) return;
    
    // ì—°í•œ ê¸€ì”¨ ì œê±° - ë°”ë¡œ íšìˆœ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
    showStrokeOrder();
}

function showStrokeOrder() {
    const strokes = STROKE_ORDER[currentJamo];
    if (!strokes) return;
    
    console.log('íšìˆœ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘, ì´ íšìˆ˜:', strokes.length);
    
    currentStrokeIndex = 0;
    isShowingStrokes = true;
    isPracticeMode = false;  // íšìˆœ ì¬ìƒ ì¤‘ì—ëŠ” ì—°ìŠµ ëª¨ë“œ ë¹„í™œì„±í™”
    showStrokeInfo();
    
    strokeAnimationInterval = setInterval(() => {
        console.log('í˜„ì¬ íšìˆœ:', currentStrokeIndex + 1, '/', strokes.length);
        
        if (currentStrokeIndex < strokes.length - 1) {
            currentStrokeIndex++;
            showStrokeInfo();
        } else {
            console.log('íšìˆœ ì• ë‹ˆë©”ì´ì…˜ ì™„ë£Œ, ì—°ìŠµ ëª¨ë“œ ì‹œì‘');
            clearInterval(strokeAnimationInterval);
            strokeAnimationInterval = null;
            isShowingStrokes = false;
            
           setTimeout(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawGuideLines();
                isPracticeMode = true;  // ì´ì œ ë¸ŒëŸ¬ì‹œ ì‚¬ìš© ê°€ëŠ¥
                
                // ì—°ìŠµ ëª¨ë“œ ì‹œì‘ ì‹œ ì§€ìš°ê¸° ë²„íŠ¼ í‘œì‹œ
                const clearButton = document.querySelector('.stroke-btn');
                if (clearButton) {
                    clearButton.style.display = 'block';
                }
                
                console.log('ì—°ìŠµ ëª¨ë“œ ì‹œì‘ - ë¸ŒëŸ¬ì‹œ ì‚¬ìš© ê°€ëŠ¥, í™”ì‚´í‘œ ì œê±°ë¨');
            }, 2000);
        }
    }, 3000);
}
        
  function showStrokeInfo() {
    const strokes = STROKE_ORDER[currentJamo];
    if (!strokes || currentStrokeIndex >= strokes.length) return;
    
    // í•œ ë²ˆë§Œ ìº”ë²„ìŠ¤ í´ë¦¬ì–´
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawGuideLines();
    
    // ëª¨ë“  ë Œë”ë§ì„ í•œ ë²ˆì— ì²˜ë¦¬
    ctx.save();
    
    // í˜„ì¬ íšê¹Œì§€ ëª¨ë“  íšì„ ëˆ„ì í•´ì„œ ê·¸ë¦¬ê¸°
    for (let i = 0; i <= currentStrokeIndex; i++) {
        ctx.beginPath();
        drawStrokePath(strokes[i], i);
        ctx.stroke();
    }
    
    ctx.restore();
    
    // ë²ˆí˜¸ í‘œì‹œ
    showStrokeNumber(strokes[currentStrokeIndex][0], currentStrokeIndex + 1);
    
    // ë°©í–¥ í™”ì‚´í‘œ í‘œì‹œ - íšìˆœ ì¬ìƒ ì¤‘ì—ë§Œ í‘œì‹œ
    if (isShowingStrokes) {
        drawDirectionArrows(strokes[currentStrokeIndex], currentStrokeIndex);
    }
}
        
        
             function drawCharacterWithStrokes() {
    const strokes = STROKE_ORDER[currentJamo];
    if (!strokes) return;
    
    // ã…‡ì€ íŠ¹ë³„ ì²˜ë¦¬ (clipping ì—†ì´ ì§ì ‘ ê·¸ë¦¬ê¸°)
    if (currentJamo === 'ã…‡' || currentJamo === 'ã…') {
        for (let i = 0; i <= currentStrokeIndex; i++) {
            ctx.save();
            ctx.fillStyle = '#000000';  // ê²€ì •ìƒ‰ìœ¼ë¡œ í†µì¼
            ctx.lineWidth = 12;
            ctx.lineCap = 'round';
            
            const adjustment = STROKE_ADJUSTMENTS[currentJamo] || DEFAULT_ADJUSTMENT;
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const actualFontHeight = 200 * 1.0;
            const scaleX = actualFontHeight * adjustment.scaleX;
            const scaleY = actualFontHeight * adjustment.scaleY;
            const adjustedCenterX = centerX + adjustment.offsetX;
            const adjustedCenterY = centerY + adjustment.offsetY;
            
            const strokeGroup = strokes[i];
            for (let stroke of strokeGroup) {
                if (stroke.type === 'circle') {
                    const circleX = adjustedCenterX + (stroke.center[0] - 0.5) * scaleX;
                    const circleY = adjustedCenterY + (stroke.center[1] - 0.5) * scaleY;
                    const radius = stroke.radius * Math.min(scaleX, scaleY) + 5;
                    
                    ctx.beginPath();
                    // ì—¬ê¸°ì„œë„ ì‹œê³„ë°©í–¥ìœ¼ë¡œ ë³€ê²½
                    ctx.arc(circleX, circleY, radius, 0, 2 * Math.PI, false); // false ì¶”ê°€
                    ctx.stroke();
                } else if (stroke.type === 'line') {
                    const startX = adjustedCenterX + (stroke.start[0] - 0.5) * scaleX;
                    const startY = adjustedCenterY + (stroke.start[1] - 0.5) * scaleY;
                    const endX = adjustedCenterX + (stroke.end[0] - 0.5) * scaleX;
                    const endY = adjustedCenterY + (stroke.end[1] - 0.5) * scaleY;
                    
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = 12;
                    ctx.beginPath();
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(endX, endY);
                    ctx.stroke();
                }
            }
            ctx.restore();
        }
        return;
    }
            
            // ë‹¤ë¥¸ ê¸€ìë“¤ì€ ê¸°ì¡´ ë°©ì‹
            for (let i = 0; i <= currentStrokeIndex; i++) {
                ctx.save();
                ctx.font = '200px "Malgun Gothic", Arial, sans-serif';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                if (i === currentStrokeIndex) {
                    ctx.fillStyle = 'rgba(255, 100, 100, 0.7)';
                } else {
                    ctx.fillStyle = 'rgba(100, 150, 255, 0.5)';
                }
                
                // í´ë¦¬í•‘ ë§ˆìŠ¤í¬ ì ìš©
                ctx.save();
                ctx.beginPath();
               drawStrokePath(strokes[i], i);  // íšìˆœ ì¸ë±ìŠ¤ë„ í•¨ê»˜ ì „ë‹¬
                ctx.clip();
                ctx.fillText(currentJamo, canvas.width / 2, canvas.height / 2);
                ctx.restore();
                ctx.restore();
            }
        }
        
        function drawStrokePath(strokeGroup, strokeIndex) { 
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // ê°œë³„ ì¡°ì •ê°’ ê°€ì ¸ì˜¤ê¸°
            const adjustment = STROKE_ADJUSTMENTS[currentJamo] || DEFAULT_ADJUSTMENT;
            
            // ì‹¤ì œ ê¸€ìì™€ ë™ì¼í•œ í¬ê¸° ê³„ì‚° + ê°œë³„ ì¡°ì •
            ctx.save();
            ctx.font = '200px "Malgun Gothic", Arial, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            const metrics = ctx.measureText(currentJamo);
            
            const actualFontHeight = 200 * 1.0;
            const scaleX = actualFontHeight * adjustment.scaleX;
            const scaleY = actualFontHeight * adjustment.scaleY;
            const adjustedCenterX = centerX + adjustment.offsetX;
            const adjustedCenterY = centerY + adjustment.offsetY;
            ctx.restore();
            
            // íšìˆœë³„ ìƒ‰ìƒ ë°°ì—´
            const strokeColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', '#FF9FF3', '#54A0FF', '#5F27CD'];
            
            ctx.strokeStyle = strokeColors[strokeIndex] || '#000000';
            ctx.lineWidth = 12;
            ctx.lineCap = 'round';
            
            for (let stroke of strokeGroup) {
                ctx.beginPath(); // ê° íšë§ˆë‹¤ ìƒˆë¡œìš´ ê²½ë¡œ ì‹œì‘
                
                if (stroke.type === 'line') {
                    const startX = adjustedCenterX + (stroke.start[0] - 0.5) * scaleX;
                    const startY = adjustedCenterY + (stroke.start[1] - 0.5) * scaleY;
                    const endX = adjustedCenterX + (stroke.end[0] - 0.5) * scaleX;
                    const endY = adjustedCenterY + (stroke.end[1] - 0.5) * scaleY;
                    
                    ctx.moveTo(startX, startY);
                    ctx.lineTo(endX, endY);
                } else if (stroke.type === 'circle') {
                    const circleX = adjustedCenterX + (stroke.center[0] - 0.5) * scaleX;
                    const circleY = adjustedCenterY + (stroke.center[1] - 0.5) * scaleY;
                    const radius = stroke.radius * Math.min(scaleX, scaleY) + 5;
                    
                ctx.arc(circleX, circleY, radius, 0, 2 * Math.PI, false); // false ì¶”ê°€
}
                
                ctx.stroke(); // ê° íšë§ˆë‹¤ ê°œë³„ì ìœ¼ë¡œ stroke í˜¸ì¶œ
            }
        }
        
        function drawStroke(stroke) {
                    if (!ctx) return;
                    
                    // ê¸€ì”¨ì²´ì™€ ë™ì¼í•œ ì„¤ì •ìœ¼ë¡œ ìŠ¤ì¼€ì¼ ê³„ì‚°
                    ctx.save();
                    ctx.font = '200px "Malgun Gothic", Arial, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    
                    // ì‹¤ì œ ê¸€ì í¬ê¸°ë¥¼ ì¸¡ì •
                    const metrics = ctx.measureText(currentJamo);
                    const actualWidth = metrics.width;
                    const actualHeight = 200; // í°íŠ¸ í¬ê¸°
                    
                    const centerX = canvas.width / 2;
                    const centerY = canvas.height / 2;
                    
                    // ê¸€ì í¬ê¸°ì— ë§ì¶˜ ìŠ¤ì¼€ì¼
                    const scaleX = actualWidth;
                    const scaleY = actualHeight;
                    
                    ctx.restore();
                    
                    // ì„  êµµê¸°ë¥¼ ê¸€ì êµµê¸°ì™€ ë¹„ìŠ·í•˜ê²Œ ì„¤ì •
                    const originalLineWidth = ctx.lineWidth;
                    ctx.lineWidth = Math.max(originalLineWidth, 12); // ê¸€ìì™€ ë¹„ìŠ·í•œ êµµê¸°
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    
                    ctx.beginPath();
                    
                    if (stroke.type === 'line') {
                        const startX = centerX + (stroke.start[0] - 0.5) * scaleX;
                        const startY = centerY + (stroke.start[1] - 0.5) * scaleY;
                        const endX = centerX + (stroke.end[0] - 0.5) * scaleX;
                        const endY = centerY + (stroke.end[1] - 0.5) * scaleY;
                        
                        ctx.moveTo(startX, startY);
                        ctx.lineTo(endX, endY);
                  } else if (stroke.type === 'circle') {
            const circleX = adjustedCenterX + (stroke.center[0] - 0.5) * scaleX;
            const circleY = adjustedCenterY + (stroke.center[1] - 0.5) * scaleY;
            const radius = stroke.radius * Math.min(scaleX, scaleY) + 5;
            
            // íšìˆœë³„ ìƒ‰ìƒ ë°°ì—´
            const strokeColors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FECA57', '#FF9FF3', '#54A0FF', '#5F27CD'];
            
           ctx.strokeStyle = strokeColors[strokeIndex] || '#000000';
            ctx.lineWidth = 12;
            ctx.lineCap = 'round';
            
            ctx.arc(circleX, circleY, radius, 0, 2 * Math.PI);
        }
                    
        
                }
        
      function showStrokeNumber(stroke, number) {
    if (!ctx) return;
    
    // ê¸€ì í¬ê¸°ì— ë§ì¶˜ ìŠ¤ì¼€ì¼ ê³„ì‚°
    ctx.save();
    ctx.font = '200px "Malgun Gothic", Arial, sans-serif';
    const metrics = ctx.measureText(currentJamo);
    const actualWidth = metrics.width;
    const actualHeight = 200;
    ctx.restore();
    
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const scaleX = actualWidth;
    const scaleY = actualHeight;
    
    let numberX, numberY;
    
    if (stroke.type === 'circle') {
        const adjustment = STROKE_ADJUSTMENTS[currentJamo] || DEFAULT_ADJUSTMENT;
        const adjustedCenterX = centerX + adjustment.offsetX;
        const adjustedCenterY = centerY + adjustment.offsetY;
        
        // ì›ì˜ ì™¼ìª½ì— ë²ˆí˜¸ í‘œì‹œ (ì‹œì‘ì  ìœ„ì¹˜)
        const circleX = adjustedCenterX + (stroke.center[0] - 0.5) * actualHeight * adjustment.scaleX;
        const circleY = adjustedCenterY + (stroke.center[1] - 0.5) * actualHeight * adjustment.scaleY;
        const radius = stroke.radius * Math.min(actualHeight * adjustment.scaleX, actualHeight * adjustment.scaleY) + 5;
        
        // ì™¼ìª½ ìœ„ ë°©í–¥ì— ë²ˆí˜¸ ìœ„ì¹˜ (ì‹œê³„ë°©í–¥ ì‹œì‘ì )
        numberX = circleX + radius * Math.cos(-2*Math.PI/3) - 25; // ì™¼ìª½ìœ¼ë¡œ ë” ì´ë™
        numberY = circleY + radius * Math.sin(-2*Math.PI/3) - 15; // ìœ„ìª½ìœ¼ë¡œ ì•½ê°„ ì´ë™
    } else {
        numberX = centerX + (stroke.start[0] - 0.5) * scaleX - 20;
        numberY = centerY + (stroke.start[1] - 0.5) * scaleY - 15;
    }
    
    ctx.save();
    ctx.fillStyle = 'rgba(255, 100, 100, 0.9)';
    ctx.beginPath();
    ctx.arc(numberX, numberY, 18, 0, 2 * Math.PI);
    ctx.fill();
    
    ctx.fillStyle = 'white';
    ctx.font = 'bold 18px Arial';
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(number.toString(), numberX, numberY);
    ctx.restore();
}
        
        function stopStrokeAnimation() {
                    if (strokeAnimationInterval) {
                        clearInterval(strokeAnimationInterval);
                        strokeAnimationInterval = null;
                    }
                    isShowingStrokes = false;
                    currentStrokeIndex = 0;
                }
        // ë°©í–¥ í™”ì‚´í‘œë¥¼ ê·¸ë¦¬ëŠ” í•¨ìˆ˜ (ì •í™•í•œ íšìˆœ ìœ„ì¹˜)
        function drawDirectionArrows(strokeGroup, strokeIndex) {
            if (!ctx) return;
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            
            // ê°œë³„ ì¡°ì •ê°’ ê°€ì ¸ì˜¤ê¸°
            const adjustment = STROKE_ADJUSTMENTS[currentJamo] || DEFAULT_ADJUSTMENT;
            
            // ì‹¤ì œ ê¸€ìì™€ ë™ì¼í•œ í¬ê¸° ê³„ì‚° + ê°œë³„ ì¡°ì •
            ctx.save();
            ctx.font = '200px "Malgun Gothic", Arial, sans-serif';
            const metrics = ctx.measureText(currentJamo);
            const actualFontHeight = 200 * 1.0;
            const scaleX = actualFontHeight * adjustment.scaleX;
            const scaleY = actualFontHeight * adjustment.scaleY;
            const adjustedCenterX = centerX + adjustment.offsetX;
            const adjustedCenterY = centerY + adjustment.offsetY;
            ctx.restore();
            
            // í™”ì‚´í‘œ ìƒ‰ìƒ ì„¤ì •
            ctx.strokeStyle = '#FF4757';
            ctx.fillStyle = '#FF4757';
            ctx.lineWidth = 3;
        
            // êº¾ì´ëŠ” íšì¸ì§€ í™•ì¸ (strokeGroupì˜ lengthê°€ 2 ì´ìƒì´ê³  ëª¨ë‘ lineì¸ ê²½ìš°)
            if (strokeGroup.length >= 2 && strokeGroup.every(s => s.type === 'line')) {
                // êº¾ì´ëŠ” íšì˜ ê²½ìš°: ì²« ë²ˆì§¸ ì„ ë¶„ì—ë§Œ í™”ì‚´í‘œ í‘œì‹œ
                const firstStroke = strokeGroup[0];
                const startX = adjustedCenterX + (firstStroke.start[0] - 0.5) * scaleX;
                const startY = adjustedCenterY + (firstStroke.start[1] - 0.5) * scaleY;
                const endX = adjustedCenterX + (firstStroke.end[0] - 0.5) * scaleX;
                const endY = adjustedCenterY + (firstStroke.end[1] - 0.5) * scaleY;
                
                drawArrowOutside(startX, startY, endX, endY, strokeIndex);
                
            } else {
                // ê° strokeë³„ë¡œ í™”ì‚´í‘œ ê·¸ë¦¬ê¸°
                for (let i = 0; i < strokeGroup.length; i++) {
                    const stroke = strokeGroup[i];
                    
                    if (stroke.type === 'line') {
                        const startX = adjustedCenterX + (stroke.start[0] - 0.5) * scaleX;
                        const startY = adjustedCenterY + (stroke.start[1] - 0.5) * scaleY;
                        const endX = adjustedCenterX + (stroke.end[0] - 0.5) * scaleX;
                        const endY = adjustedCenterY + (stroke.end[1] - 0.5) * scaleY;
                        
                        drawArrowOutside(startX, startY, endX, endY, strokeIndex);
                        
                    } else if (stroke.type === 'circle') {
                        // ì›í˜• ê¸€ìëŠ” ì¤‘ì•™ì— ìœ„ì¹˜í•˜ë„ë¡ offset ë¬´ì‹œ
                        const circleX = centerX + (stroke.center[0] - 0.5) * scaleX;
                        const circleY = centerY + (stroke.center[1] - 0.5) * scaleY;
                        const radius = stroke.radius * Math.min(scaleX, scaleY) + 5;
                        
                        // ì›í˜• í™”ì‚´í‘œëŠ” í•œ ë²ˆë§Œ ê·¸ë¦¬ê¸°
                        drawCircleArrowOutside(circleX, circleY, radius);
                    }
                }
            }
        }
        
        // ì§ì„  í™”ì‚´í‘œ ê·¸ë¦¬ê¸° í•¨ìˆ˜ (ëª¨ë“  ìëª¨ ìµœì í™”)
        function drawArrowOutside(startX, startY, endX, endY, strokeIndex) {
            const headLength = 20;
            const headAngle = Math.PI / 6;
            let offset = 40; // ê¸°ë³¸ ê±°ë¦¬
            
            // ë°©í–¥ ê³„ì‚°
            const angle = Math.atan2(endY - startY, endX - startX);
            const lineLength = Math.sqrt((endX - startX) ** 2 + (endY - startY) ** 2);
            
            let arrowX, arrowY;
            let positionRatio = 0.2; // ê¸°ë³¸ ìœ„ì¹˜
            
            // ìëª¨ë³„ ê°œë³„ ì„¤ì •
            if (currentJamo === 'ã„±') {
                offset = 25; // íšê³¼ ê°€ê¹ê²Œ
                positionRatio = 0.15;
            } else if (currentJamo === 'ã„´') {
                offset = 25; // íšê³¼ ê°€ê¹ê²Œ
                positionRatio = 0.25; // ì¡°ê¸ˆ ë‚´ë ¤ì™€ì„œ
            } else if (currentJamo === 'ã„·') {
                if (strokeIndex === 0) {
                    // 1íšì€ íšê³¼ ê°€ê¹ê²Œ
                    offset = 25;
                    positionRatio = 0.15;
                } else {
                    // 2íšì€ ë” ì•„ë˜ë¡œ ë‚´ë ¤ì„œ
                    offset = 25;
                    positionRatio = 0.5; // 0.35ì—ì„œ 0.5ë¡œ ë” ì•„ë˜ë¡œ
                }
            } else if (currentJamo === 'ã„¹') {
                if (strokeIndex === 1) {
                    // 2íšë§Œ ë°”ë¡œ ìœ„ì— í‘œì‹œ
                    offset = 20; // 25â†’20ìœ¼ë¡œ ë” ê°€ê¹ê²Œ
                    const midX = (startX + endX) / 2;
                    const midY = (startY + endY) / 2;
                    arrowX = midX;
                    arrowY = midY - offset;
                } else if (strokeIndex === 2) {
                    // 3íšì€ ë” ì•„ë˜ë¡œ, ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
                    offset = 25;
                    positionRatio = 0.4; // 0.35â†’0.4ë¡œ ì¡°ê¸ˆ ë” ì˜¤ë¥¸ìª½ìœ¼ë¡œ
                } else {
                    // 1íš
                    offset = 25;
                    positionRatio = 0.25;
                }
            } else if (currentJamo === 'ã…') {
                if (strokeIndex === 0) {
                    // 1íšì€ ë” ì•„ë˜ë¡œ
                    offset = 25;
                    positionRatio = 0.4; // 0.25â†’0.4ë¡œ ë” ì•„ë˜ë¡œ
                } else {
                    offset = 25;
                    positionRatio = 0.25;
                }
            } else if (currentJamo === 'ã…‚') {
                if (strokeIndex === 2) {
                    // 3íš (ê°€ìš´ë° ê°€ë¡œíš)ì€ ì‹­ìì„  ì„¸ë¡œì„  ìœ„ì¹˜ì— í‘œì‹œ
                    offset = 25; // 30â†’25ë¡œ ë” ê°€ê¹ê²Œ
                    const centerX = canvas.width / 2;
                    const midY = (startY + endY) / 2;
                    arrowX = centerX;
                    arrowY = midY - offset;
                } else if (strokeIndex === 3) {
                    // 4íš (ì•„ë˜ ê°€ë¡œíš)ì€ ì‹­ìì„  ì„¸ë¡œì„  ìœ„ì¹˜ ì•„ë˜ì— í‘œì‹œ
                    offset = 25; // 30â†’25ë¡œ ë” ê°€ê¹ê²Œ
                    const centerX = canvas.width / 2;
                    const midY = (startY + endY) / 2;
                    arrowX = centerX;
                    arrowY = midY + offset; // ì•„ë˜ìª½ìœ¼ë¡œ ë³€ê²½
                } else {
                    offset = 25; // 50â†’25ë¡œ ë” ê°€ê¹ê²Œ
                    positionRatio = 0.4; // 0.5â†’0.4ë¡œ ì¡°ê¸ˆ ì˜¬ë ¤ì„œ
                }
            } else if (currentJamo === 'ã……') {
                if (strokeIndex === 1) {
                    // 2íšì€ ì˜¤ë¥¸ìª½ ì•„ë˜ ëŒ€ê°ì„ ìœ¼ë¡œ ë” ë‚´ë ¤ì„œ
                    offset = 30;
                    positionRatio = 0.5; // 0.3â†’0.5ë¡œ ë” ì•„ë˜ë¡œ
                } else {
                    offset = 30;
                    positionRatio = 0.3;
                }
            } else if (currentJamo === 'ã…‡') {
                // ì›í˜•ì´ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” ì²˜ë¦¬í•˜ì§€ ì•ŠìŒ
                return;
          } else if (currentJamo === 'ã…ˆ') {
            if (strokeIndex === 1) {
                // 2íšì€ ì˜¤ë¥¸ìª½ ì•„ë˜ë¡œ ë” ë©€ë¦¬, ê±°ë¦¬ëŠ” ê°€ê¹ê²Œ
                offset = 25;
                positionRatio = 0.6;
            } else {
                offset = 25;  // 50 â†’ 25ë¡œ ë³€ê²½ (1íš í™”ì‚´í‘œë¥¼ íšê³¼ ê°€ê¹ê²Œ)
                positionRatio = 0.2;
            }
        } else if (currentJamo === 'ã…Š') {
            if (strokeIndex === 0) {
                // 1íšì€ íšì˜ ì •í™•í•œ ê°€ìš´ë°ì— í‘œì‹œ
                offset = 30;
                positionRatio = 0.5; // íšì˜ ì •í™•í•œ ê°€ìš´ë° (50% ì§€ì )
            } else if (strokeIndex === 1) {
                // 2íš (ê°€ë¡œ+ëŒ€ê°ì„ )ì€ ê°€ë¡œ ë¶€ë¶„ ê°€ìš´ë°ì— í‘œì‹œ
                offset = 20;
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 15; // ì™¼ìª½ìœ¼ë¡œ 15px ì´ë™
                arrowY = midY + offset; // ê°€ë¡œíšë³´ë‹¤ ì‚´ì§ ì•„ë˜
            } else if (strokeIndex === 2) {
                // 3íš (ì˜¤ë¥¸ìª½ ëŒ€ê°ì„ )ì€ ì˜¤ë¥¸ìª½ ì•„ë˜ë¡œ í‘œì‹œ
                offset = 20;
                positionRatio = 0.5;
            } else {
                offset = 25;
                positionRatio = 0.2;
            }
        } else if (currentJamo === 'ã…‹') {
            if (strokeIndex === 1) {
                // 2íšì€ íš ë°”ë¡œ ìœ„ì— í‘œì‹œ
                offset = 20;
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY - offset;
            } else {
                offset = 25;  // 55 â†’ 25ë¡œ ë³€ê²½ (1íš í™”ì‚´í‘œë¥¼ íšê³¼ ê°€ê¹ê²Œ)
                positionRatio = 0.15;
            }
        } else if (currentJamo === 'ã…Œ') {
            if (strokeIndex === 1) {
                // 2íšì€ íš ë°”ë¡œ ìœ„ì— í‘œì‹œ
                offset = 20;
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY - offset;
            } else if (strokeIndex === 2) {
                // 3íšì€ ì•„ë˜ë¡œ ì´ë™ì‹œì¼œì„œ íšìˆœë²ˆí˜¸ë¥¼ ê°€ë¦¬ì§€ ì•Šê²Œ í•¨
                offset = 30;
                positionRatio = 0.7;  // 0.15 â†’ 0.7ë¡œ ë³€ê²½í•˜ì—¬ ì•„ë˜ë¡œ ì´ë™
            } else {
                offset = 25;  // 55 â†’ 25ë¡œ ë³€ê²½ (1íš í™”ì‚´í‘œë¥¼ íšê³¼ ê°€ê¹ê²Œ)
                positionRatio = 0.15;
            }
            } else if (currentJamo === 'ã…') {
            if (strokeIndex === 0) {
                // 1íš (ìœ„ ê°€ë¡œíš)ì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25;
                positionRatio = 0.2;
            } else if (strokeIndex === 1) {
                // 2íš (ì™¼ìª½ ì„¸ë¡œíš)ì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25;
                positionRatio = 0.6;
            } else if (strokeIndex === 2) {
                // 3íš (ì˜¤ë¥¸ìª½ ì„¸ë¡œíš)ì€ íšê³¼ ê°€ê¹ê²Œ, ì•„ë˜ìª½ìœ¼ë¡œ ë‚´ë ¤ì„œ íšìˆœë²ˆí˜¸ ì•ˆ ê°€ë¦¬ê²Œ
                offset = 25;
                positionRatio = 0.7; // ì•„ë˜ìª½ìœ¼ë¡œ ì´ë™
            } else if (strokeIndex === 3) {
                // 4íš (ì•„ë˜ ê°€ë¡œíš)ì€ íšê³¼ ê°€ê¹ê²Œ, ì•„ë˜ìª½ìœ¼ë¡œ ë‚´ë ¤ì„œ íšìˆœë²ˆí˜¸ ì•ˆ ê°€ë¦¬ê²Œ
                offset = 25;
                positionRatio = 0.7; // ì•„ë˜ìª½ìœ¼ë¡œ ì´ë™
            } else {
                offset = 25;
                positionRatio = 0.2;
            }
        } else if (currentJamo === 'ã…') {
                if (strokeIndex === 0) {
                    // 1íš (ì§§ì€ ê°€ë¡œì¤„)ì€ í•´ë‹¹ íš ë°”ë¡œ ì•„ë˜ì— í‘œì‹œ
                    const midX = (startX + endX) / 2;
                    const midY = (startY + endY) / 2;
                    arrowX = midX;
                    arrowY = midY - 25; // ì•„ë˜ìª½ìœ¼ë¡œ 25px ì´ë™
                } else if (strokeIndex === 1) {
                    // 2íš (ê¸´ ê°€ë¡œì¤„)ì€ í•´ë‹¹ íš ë°”ë¡œ ì•„ë˜ì— í‘œì‹œ
                    const midX = (startX + endX) / 2;
                    const midY = (startY + endY) / 2;
                    arrowX = midX;
                    arrowY = midY + 25; // ì•„ë˜ìª½ìœ¼ë¡œ 25px ì´ë™
                } else {
                    // 3íš (ì›)ì€ ê¸°ì¡´ ì„¤ì • ìœ ì§€
                    offset = 60;
                    positionRatio = 0.2;
                }
            }
        
            // ìŒììŒ
          // ìŒììŒ
        else if (currentJamo === 'ã„²') {
            offset = 25;  // 55 â†’ 25ë¡œ ë³€ê²½ (íšê³¼ ê°€ê¹ê²Œ)
            positionRatio = 0.15;
        } else if (currentJamo === 'ã„¸') {
            if (strokeIndex === 0) {
                // 1íš (ì²« ë²ˆì§¸ ã„· ìœ„ìª½ ê°€ë¡œíš)ì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25;
                positionRatio = 0.15;
            } else if (strokeIndex === 1) {
                // 2íš (ì²« ë²ˆì§¸ ã„· ì„¸ë¡œ+ê°€ë¡œ)ì€ íšê³¼ ê°€ê¹ê²Œ, ë” ì•„ë˜ë¡œ ë‚´ë ¤ì„œ íšìˆœë²ˆí˜¸ ì•ˆ ê°€ë¦¬ê²Œ
                offset = 25;
                positionRatio = 0.6; // ë” ì•„ë˜ë¡œ ì´ë™
            } else if (strokeIndex === 2) {
                // 3íš (ë‘ ë²ˆì§¸ ã„· ìœ„ìª½ ê°€ë¡œíš)ì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25;
                positionRatio = 0.15;
            } else if (strokeIndex === 3) {
               arrowX = startX - 20;  
                arrowY = startY + 40;  
         
            } else {
                offset = 25;
                positionRatio = 0.15;
            }
        } else if (currentJamo === 'ã…ƒ') {
            if (strokeIndex === 0) {
                // 1íš (ì²« ë²ˆì§¸ ã…‚ ì™¼ìª½ ì„¸ë¡œíš)ì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25;
                positionRatio = 0.3;
            } else if (strokeIndex === 1) {
                // 2íš (ì²« ë²ˆì§¸ ã…‚ ì˜¤ë¥¸ìª½ ì„¸ë¡œíš)ì€ íšì˜ ì˜¤ë¥¸ìª½ì— ê°€ê¹ê²Œ
                offset = 25;
                const quarterX = startX + (endX - startX) * 0.3;
                const quarterY = startY + (endY - startY) * 0.3;
                arrowX = quarterX + 30; // ì˜¤ë¥¸ìª½ìœ¼ë¡œ 30px ì´ë™
                arrowY = quarterY;
            } else if (strokeIndex === 2) {
                // 3íš (ì²« ë²ˆì§¸ ã…‚ ê°€ìš´ë° ê°€ë¡œíš)ì€ íš ë°”ë¡œ ìœ„ì— (í™”ì‚´í‘œ ê¸¸ì´ ì¤„ì„)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY - 20; // ìœ„ìª½ìœ¼ë¡œ 20px (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 3) {
                // 4íš (ì²« ë²ˆì§¸ ã…‚ ì•„ë˜ ê°€ë¡œíš)ì€ íš ë°”ë¡œ ì•„ë˜ì— (í™”ì‚´í‘œ ê¸¸ì´ ì¤„ì„)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 20; // ì•„ë˜ìª½ìœ¼ë¡œ 20px (ì§§ì€ í™”ì‚´í‘œ)
           
              } else if (strokeIndex === 4) {
            // 5íš (ë‘ ë²ˆì§¸ ã…‚ ì™¼ìª½ ì„¸ë¡œíš)ì€ ì™¼ìª½ìœ¼ë¡œ ì´ë™
            const quarterX = startX + (endX - startX) * 0.3;
            const quarterY = startY + (endY - startY) * 0.3;
            arrowX = quarterX - 15; // ì™¼ìª½ìœ¼ë¡œ 30px ì´ë™
            arrowY = quarterY;
        
            } else if (strokeIndex === 5) {
                // 6íš (ë‘ ë²ˆì§¸ ã…‚ ì˜¤ë¥¸ìª½ ì„¸ë¡œíš)ì€ íšì˜ ì˜¤ë¥¸ìª½ì— ê°€ê¹ê²Œ
                offset = 25;
                const quarterX = startX + (endX - startX) * 0.3;
                const quarterY = startY + (endY - startY) * 0.3;
                arrowX = quarterX + 30; // ì˜¤ë¥¸ìª½ìœ¼ë¡œ 30px ì´ë™
                arrowY = quarterY;
            } else if (strokeIndex === 6) {
                // 7íš (ë‘ ë²ˆì§¸ ã…‚ ê°€ìš´ë° ê°€ë¡œíš)ì€ íš ë°”ë¡œ ìœ„ì— (í™”ì‚´í‘œ ê¸¸ì´ ì¤„ì„)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY - 20; // ìœ„ìª½ìœ¼ë¡œ 20px (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 7) {
                // 8íš (ë‘ ë²ˆì§¸ ã…‚ ì•„ë˜ ê°€ë¡œíš)ì€ íš ë°”ë¡œ ì•„ë˜ì— (í™”ì‚´í‘œ ê¸¸ì´ ì¤„ì„)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 20; // ì•„ë˜ìª½ìœ¼ë¡œ 20px (ì§§ì€ í™”ì‚´í‘œ)
            } else {
                offset = 25;
                positionRatio = 0.15;
            }
        } else if (currentJamo === 'ã…†') {
            if (strokeIndex === 0) {
                // 1íšì€ ì™¼ìª½ ëŒ€ê°ì„  ì•„ë˜ë¡œ
                arrowX = startX - 40;  // ì™¼ìª½ìœ¼ë¡œ 40px ì´ë™
                arrowY = startY + 40;  // ì•„ë˜ë¡œ 40px ì´ë™
            } else if (strokeIndex === 1) {
                // 2íšì€ ì™¼ìª½ ìœ„ ëŒ€ê°ì„  ë°©í–¥ìœ¼ë¡œ ì´ë™
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 10;  // ì™¼ìª½ìœ¼ë¡œ 10px ì´ë™
                arrowY = midY + 20;  // ìœ„ë¡œ 20px ì´ë™
            } else if (strokeIndex === 2) {
                // 3íšì€ 1íšê³¼ ë™ì¼í•˜ê²Œ (ì™¼ìª½ ëŒ€ê°ì„  ì•„ë˜ë¡œ)
                arrowX = startX - 30;  // ì™¼ìª½ìœ¼ë¡œ 40px ì´ë™
                arrowY = startY + 20;  // ì•„ë˜ë¡œ 40px ì´ë™
            } else if (strokeIndex === 3) {
                // 4íšì€ 2íšê³¼ ë™ì¼í•˜ê²Œ (ì™¼ìª½ ìœ„ ëŒ€ê°ì„  ë°©í–¥ìœ¼ë¡œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 10;  // ì™¼ìª½ìœ¼ë¡œ 10px ì´ë™
                arrowY = midY + 20;  // ìœ„ë¡œ 20px ì´ë™
            } else {
                // ë‚˜ë¨¸ì§€ íšë“¤ì€ ê¸°ì¡´ ì„¤ì • ìœ ì§€
                offset = 60;
                positionRatio = 0.25;
            }
        } else if (currentJamo === 'ã…‰') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25;  // 55 â†’ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 1) {
                // 2íšì€ ì˜¤ë¥¸ìª½ ìœ„ ëŒ€ê°ì„  ë°©í–¥ìœ¼ë¡œ ì´ë™
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX + 20;  // ì˜¤ë¥¸ìª½ìœ¼ë¡œ 20px ì´ë™
                arrowY = midY - 25;  // ìœ„ìª½ìœ¼ë¡œ 25px ì´ë™
            } else if (strokeIndex === 2) {
                // 3íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25;  // 55 â†’ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 3) {
                // 4íšì€ ì˜¤ë¥¸ìª½ ì•„ë˜ ëŒ€ê°ì„  ë°©í–¥ìœ¼ë¡œ ì´ë™
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX + 20;  // ì˜¤ë¥¸ìª½ìœ¼ë¡œ 20px ì´ë™
                arrowY = midY - 25;  // ì•„ë˜ìª½ìœ¼ë¡œ 25px ì´ë™
            } else {
                // ë‚˜ë¨¸ì§€ íšë“¤ì€ ê¸°ì¡´ ì„¤ì • ìœ ì§€
                offset = 55;
                positionRatio = 0.2;
            }
        }
            // ëª¨ìŒ
            else if (currentJamo === 'ã…') {
              if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 45ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 1) {
                // 2íšì€ íš ë°”ë¡œ ì•„ë˜ì— ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì¡°ê¸ˆ ì´ë™
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX + 15; // ì˜¤ë¥¸ìª½ìœ¼ë¡œ 15px ì´ë™
                arrowY = midY + 20; // ì•„ë˜ìª½ìœ¼ë¡œ 20px ì´ë™
            } else {
                offset = 45;
                positionRatio = 0.2;
            }
           } else if (currentJamo === 'ã…‘') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 50ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 1) {
                // 2íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else {
                offset = 50;
                positionRatio = 0.2;
            }
         } else if (currentJamo === 'ã…“') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ, ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
                const quarterX = startX + (endX - startX) * 0.2;
                const quarterY = startY + (endY - startY) * 0.2;
                
                const perpAngle = angle + Math.PI / 2;
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                const toCenterX = centerX - quarterX;
                const toCenterY = centerY - quarterY;
                
                let finalOffset = 25;
                if (toCenterX * Math.cos(perpAngle) + toCenterY * Math.sin(perpAngle) > 0) {
                    finalOffset = -25;
                }
                
                arrowX = quarterX + finalOffset * Math.cos(perpAngle) + 20; // ì˜¤ë¥¸ìª½ìœ¼ë¡œ 20px ì´ë™
                arrowY = quarterY + finalOffset * Math.sin(perpAngle);
            } else if (strokeIndex === 1) {
                // 2íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25;
                positionRatio = 0.2;
            } else {
                offset = 45;
                positionRatio = 0.2;
            }
          } else if (currentJamo === 'ã…•') {
            if (strokeIndex === 0) {
                // 1íšì€ íš ì•„ë˜ì—, 2íšê³¼ ë™ì¼í•œ ìœ„ì¹˜ë¡œ
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX; // 2íšê³¼ ë™ì¼í•œ ìœ„ì¹˜
                arrowY = midY + 25; // ì•„ë˜ìª½ìœ¼ë¡œ 25px ì´ë™
            } else if (strokeIndex === 1) {
                // 2íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ íš ë°”ë¡œ ì•„ë˜ì— ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX + 15; // ì˜¤ë¥¸ìª½ìœ¼ë¡œ 15px ì´ë™
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else {
                offset = 50;
                positionRatio = 0.2;
            }
         } else if (currentJamo === 'ã…—') {
            if (strokeIndex === 0) {
                // 1íš í™”ì‚´í‘œë¥¼ íšì˜ ì™¼ìª½ì— ë°°ì¹˜
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 30; // ì™¼ìª½ìœ¼ë¡œ 30px ì´ë™
                arrowY = midY;
            } else if (strokeIndex === 1) {
                // 2íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else {
                offset = 50;
                positionRatio = 0.2;
            }
         } else if (currentJamo === 'ã…›') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ, ì¡°ê¸ˆ ì•„ë˜ë¡œ ë‚´ë ¤ì„œ íšìˆœ ë²ˆí˜¸ ì•ˆ ê°€ë¦¬ê²Œ
                offset = 25; // 55ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.4; // 0.2ì—ì„œ 0.4ë¡œ ë³€ê²½í•˜ì—¬ ì•„ë˜ë¡œ ì´ë™
            } else if (strokeIndex === 1) {
                // 2íšì€ íšê³¼ ê°€ê¹ê²Œ, ì™¼ìª½ìœ¼ë¡œ ì´ë™í•˜ì—¬ íšìˆœ ë²ˆí˜¸ ì•„ë˜ì— ìœ„ì¹˜
                const quarterX = startX + (endX - startX) * 0.2;
                const quarterY = startY + (endY - startY) * 0.2;
                
                const perpAngle = angle + Math.PI / 2;
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                const toCenterX = centerX - quarterX;
                const toCenterY = centerY - quarterY;
                
                let finalOffset = 25;
                if (toCenterX * Math.cos(perpAngle) + toCenterY * Math.sin(perpAngle) > 0) {
                    finalOffset = -25;
                }
                
                arrowX = quarterX + finalOffset * Math.cos(perpAngle) - 40; // ì™¼ìª½ìœ¼ë¡œ 20px ì´ë™
                arrowY = quarterY + finalOffset * Math.sin(perpAngle);
            } else if (strokeIndex === 2) {
                // 3íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else {
                offset = 55;
                positionRatio = 0.2;
            }
        } else if (currentJamo === 'ã…œ') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 50ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 1) {
                // 2íšì€ íšê³¼ ê°€ê¹ê²Œ, ì™¼ìª½ìœ¼ë¡œ ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 15; // ì™¼ìª½ìœ¼ë¡œ 15px ì´ë™
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else {
                offset = 50;
                positionRatio = 0.2;
            }
         } else if (currentJamo === 'ã… ') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 55ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 1) {
                // 2íšì€ íšê³¼ ê°€ê¹ê²Œ, ì™¼ìª½ìœ¼ë¡œ ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 15; // ì™¼ìª½ìœ¼ë¡œ 15px ì´ë™
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ íšê³¼ ê°€ê¹ê²Œ, íšìˆœ ì•„ë˜ ìœ„ì¹˜í•˜ë„ë¡ ì™¼ìª½ìœ¼ë¡œ ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 20; // ì™¼ìª½ìœ¼ë¡œ 20px ì´ë™
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else {
                offset = 55;
                positionRatio = 0.2;
            }
            } else if (currentJamo === 'ã…¡') {
                offset = 50;
                positionRatio = 0.5; // ê°€ë¡œì¤„ì€ ì¤‘ê°„ì—
            } else if (currentJamo === 'ã…£') {
                offset = 50;
                positionRatio = 0.2;
            }
            // ì´ì¤‘ëª¨ìŒ
          else if (currentJamo === 'ã…') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 55ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 1) {
                // 2íšì€ íšê³¼ ê°€ê¹ê²Œ, ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì¡°ê¸ˆ ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX + 5; // ì˜¤ë¥¸ìª½ìœ¼ë¡œ 5px ì´ë™
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 55ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else {
                offset = 55;
                positionRatio = 0.2;
            }
           } else if (currentJamo === 'ã…’') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 1) {
                // 2íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 3) {
                // 4íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else {
                offset = 60;
                positionRatio = 0.2;
            }
          } else if (currentJamo === 'ã…”') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ, ì˜¤ë¥¸ìª½ìœ¼ë¡œ ì´ë™
                const quarterX = startX + (endX - startX) * 0.2;
                const quarterY = startY + (endY - startY) * 0.2;
                
                const perpAngle = angle + Math.PI / 2;
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                const toCenterX = centerX - quarterX;
                const toCenterY = centerY - quarterY;
                
                let finalOffset = 25;
                if (toCenterX * Math.cos(perpAngle) + toCenterY * Math.sin(perpAngle) > 0) {
                    finalOffset = -25;
                }
                
                arrowX = quarterX + finalOffset * Math.cos(perpAngle) + 10; // ì˜¤ë¥¸ìª½ìœ¼ë¡œ 5px ì´ë™
                arrowY = quarterY + finalOffset * Math.sin(perpAngle);
            } else if (strokeIndex === 1) {
                // 2íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 55ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 2) {
                // 3íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 55ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else {
                offset = 55;
                positionRatio = 0.2;
            }
          } else if (currentJamo === 'ã…–') {
            if (strokeIndex === 0) {
                // 1íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 1) {
                // 2íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 3) {
                // 4íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else {
                offset = 60;
                positionRatio = 0.2;
            }
          } else if (currentJamo === 'ã…˜') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ, ì¡°ê¸ˆ ì•„ë˜ë¡œ ë‚´ë ¤ì„œ íšìˆœ ë²ˆí˜¸ ì•ˆ ê°€ë¦¬ê²Œ
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.4; // 0.2ì—ì„œ 0.4ë¡œ ë³€ê²½í•˜ì—¬ ì•„ë˜ë¡œ ì´ë™
            } else if (strokeIndex === 1) {
                // 2íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 3) {
                // 4íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else {
                offset = 60;
                positionRatio = 0.2;
            }
           } else if (currentJamo === 'ã…™') {
            if (strokeIndex === 0) {
                // 1íšì€ ã…˜ì™€ ë™ì¼í•˜ê²Œ (íšê³¼ ê°€ê¹ê²Œ, ì¡°ê¸ˆ ì•„ë˜ë¡œ)
                offset = 25; // 65ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.4; // ì•„ë˜ë¡œ ì´ë™
            } else if (strokeIndex === 1) {
                // 2íšì€ ã…˜ì™€ ë™ì¼í•˜ê²Œ (íš ë°”ë¡œ ì•„ë˜ì—, ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ ã…˜ì™€ ë™ì¼í•˜ê²Œ (íšê³¼ ê°€ê¹ê²Œ)
                offset = 25; // 65ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 3) {
                // 4íšì€ íš ë°”ë¡œ ì•„ë˜ì— (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 4) {
                // 5íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 65ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else {
                offset = 65;
                positionRatio = 0.2;
            }
           } else if (currentJamo === 'ã…š') {
            if (strokeIndex === 0) {
                // 1íšì€ ã…™ì™€ ë™ì¼í•˜ê²Œ (íšê³¼ ê°€ê¹ê²Œ, ì¡°ê¸ˆ ì•„ë˜ë¡œ)
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.4; // ì•„ë˜ë¡œ ì´ë™
            } else if (strokeIndex === 1) {
                // 2íšì€ ã…™ì™€ ë™ì¼í•˜ê²Œ (íš ë°”ë¡œ ì•„ë˜ì—, ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ ã…™ì™€ ë™ì¼í•˜ê²Œ (íšê³¼ ê°€ê¹ê²Œ)
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else {
                offset = 60;
                positionRatio = 0.2;
            }
          } else if (currentJamo === 'ã…') {
            if (strokeIndex === 0) {
                // 1íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else if (strokeIndex === 1) {
                // 2íšì€ íšê³¼ ê°€ê¹ê²Œ, ì™¼ìª½ìœ¼ë¡œ ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 15; // ì™¼ìª½ìœ¼ë¡œ 15px ì´ë™
                arrowY = midY + 10; // ì•„ë˜ìª½ìœ¼ë¡œ 10px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 2) {
                // 3íšì€ íšê³¼ ê°€ê¹ê²Œ (ì§§ì€ í™”ì‚´í‘œ)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; // ì•„ë˜ìª½ìœ¼ë¡œ 15px ì´ë™ (ì§§ì€ í™”ì‚´í‘œ)
            } else if (strokeIndex === 3) {
                // 4íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else {
                offset = 60;
                positionRatio = 0.2;
            }
        } else if (currentJamo === 'ã…') {
            if (strokeIndex === 0) {
                // 1íšì€ íš ì•„ë˜ì— ì§ì ‘ í‘œì‹œ
                const quarterX = startX + (endX - startX) * 0.2;
                const quarterY = startY + (endY - startY) * 0.2;
                arrowX = quarterX;
                arrowY = quarterY + 20; // ì•„ë˜ìª½ìœ¼ë¡œ 20px ì´ë™
            } else if (strokeIndex === 1) {
                // 2íšì€ ã…ì™€ ë™ì¼í•˜ê²Œ
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 15; 
                arrowY = midY + 15; 
            } else if (strokeIndex === 2) {
                // 3íšì€ ã…ì™€ ë™ì¼í•˜ê²Œ
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX;
                arrowY = midY + 15; 
            } else if (strokeIndex === 3) {
                // 4íšì€ ã…ì™€ ë™ì¼í•˜ê²Œ
                offset = 25; 
                positionRatio = 0.2;
            } else if (strokeIndex === 4) {
                // 5íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; 
                positionRatio = 0.2;
            } else {
                offset = 65;
                positionRatio = 0.2;
            }
           } else if (currentJamo === 'ã…Ÿ') {
            if (strokeIndex === 0) {
                // 1íšì€ ã…ì™€ ë™ì¼í•˜ê²Œ (íš ì•„ë˜ì— ì§ì ‘ í‘œì‹œ, íšê³¼ ê°€ê¹ê²Œ)
                const quarterX = startX + (endX - startX) * 0.2;
                const quarterY = startY + (endY - startY) * 0.2;
                arrowX = quarterX;
                arrowY = quarterY + 20; // ì•„ë˜ìª½ìœ¼ë¡œ 20px ì´ë™
            } else if (strokeIndex === 1) {
                // 2íšì€ ã…ì™€ ë™ì¼í•˜ê²Œ (ì™¼ìª½ìœ¼ë¡œ 10px ì´ë™)
                const midX = (startX + endX) / 2;
                const midY = (startY + endY) / 2;
                arrowX = midX - 15; // ì™¼ìª½ìœ¼ë¡œ 10px ì´ë™
                arrowY = midY + 15; 
            } else if (strokeIndex === 2) {
                // 3íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 60ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else {
                offset = 60;
                positionRatio = 0.2;
            }
            } else if (currentJamo === 'ã…¢') {
            if (strokeIndex === 0) {
                // 1íšì€ íš ì•„ë˜ì— ì§ì ‘ í‘œì‹œ, íšê³¼ ê°€ê¹ê²Œ
                const quarterX = startX + (endX - startX) * 0.2;
                const quarterY = startY + (endY - startY) * 0.2;
                arrowX = quarterX;
                arrowY = quarterY + 20; // ì•„ë˜ìª½ìœ¼ë¡œ 20px ì´ë™
            } else if (strokeIndex === 1) {
                // 2íšì€ íšê³¼ ê°€ê¹ê²Œ
                offset = 25; // 55ì—ì„œ 25ë¡œ ë³€ê²½
                positionRatio = 0.2;
            } else {
                offset = 55;
                positionRatio = 0.2;
            }
        }
            
        if (!(currentJamo === 'ã„¹' && strokeIndex === 1) && 
            !(currentJamo === 'ã…‚' && (strokeIndex === 2 || strokeIndex === 3)) &&
            !(currentJamo === 'ã…Š' && strokeIndex === 1) &&
            !(currentJamo === 'ã…‹' && strokeIndex === 1) &&
            !(currentJamo === 'ã…Œ' && strokeIndex === 1) &&
            !(currentJamo === 'ã…' && (strokeIndex === 0 || strokeIndex === 1|| strokeIndex === 2)) &&
            !(currentJamo === 'ã„¸' && strokeIndex === 3) &&
            !(currentJamo === 'ã…ƒ' && (strokeIndex === 1 || strokeIndex === 2 || strokeIndex === 3 || strokeIndex === 4 || strokeIndex === 5 || strokeIndex === 6 || strokeIndex === 7)) &&
            !(currentJamo === 'ã…†' && (strokeIndex === 0 || strokeIndex === 1 || strokeIndex === 2 || strokeIndex === 3)) &&
            !(currentJamo === 'ã…‰' && (strokeIndex === 1 || strokeIndex === 3)) &&
            !(currentJamo === 'ã…' && strokeIndex === 1) &&
            !(currentJamo === 'ã…‘' && (strokeIndex === 1 || strokeIndex === 2)) &&
            !(currentJamo === 'ã…“' && strokeIndex === 0) &&
            !(currentJamo === 'ã…•' && (strokeIndex === 0 || strokeIndex === 1 || strokeIndex === 2)) &&
            !(currentJamo === 'ã…—' && (strokeIndex === 0 ||strokeIndex === 1)) &&
            !(currentJamo === 'ã…›' && (strokeIndex === 1 || strokeIndex === 2)) &&
            !(currentJamo === 'ã…œ' && strokeIndex === 1) &&
            !(currentJamo === 'ã… ' && (strokeIndex === 1 || strokeIndex === 2)) &&
            !(currentJamo === 'ã…' && strokeIndex === 1) &&
            !(currentJamo === 'ã…’' && (strokeIndex === 1 || strokeIndex === 2)) &&
            !(currentJamo === 'ã…”' && strokeIndex === 0) &&
            !(currentJamo === 'ã…–' && (strokeIndex === 0 || strokeIndex === 1)) &&
            !(currentJamo === 'ã…˜' && (strokeIndex === 1 || strokeIndex === 3)) &&
            !(currentJamo === 'ã…™' && (strokeIndex === 1 || strokeIndex === 3)) &&
            !(currentJamo === 'ã…š' && strokeIndex === 1) &&
            !(currentJamo === 'ã…' && (strokeIndex === 1 || strokeIndex === 2)) &&
            !(currentJamo === 'ã…' && (strokeIndex === 0 || strokeIndex === 1 || strokeIndex === 2)) &&
            !(currentJamo === 'ã…Ÿ' && (strokeIndex === 0 || strokeIndex === 1)) &&
            !(currentJamo === 'ã…¢' && strokeIndex === 0)) {
                const quarterX = startX + (endX - startX) * positionRatio;
                const quarterY = startY + (endY - startY) * positionRatio;
                
                const perpAngle = angle + Math.PI / 2;
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                const toCenterX = centerX - quarterX;
                const toCenterY = centerY - quarterY;
                
                let finalOffset = offset;
                if (toCenterX * Math.cos(perpAngle) + toCenterY * Math.sin(perpAngle) > 0) {
                    finalOffset = -offset;
                }
                
                arrowX = quarterX + finalOffset * Math.cos(perpAngle);
                arrowY = quarterY + finalOffset * Math.sin(perpAngle);
            }
            
            // í™”ì‚´í‘œ ëì  ê³„ì‚°
            const arrowEndX = arrowX + headLength * Math.cos(angle);
            const arrowEndY = arrowY + headLength * Math.sin(angle);
            
            // í™”ì‚´í‘œ ê·¸ë¦¬ê¸°
            ctx.save();
            ctx.strokeStyle = '#FF3742';
            ctx.fillStyle = '#FF3742';
            ctx.lineWidth = 3;
            
            // í™”ì‚´í‘œ ëª¸í†µ ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.moveTo(arrowX - headLength * 0.8 * Math.cos(angle), 
                       arrowY - headLength * 0.8 * Math.sin(angle));
            ctx.lineTo(arrowEndX, arrowEndY);
            ctx.stroke();
            
            // í™”ì‚´í‘œ ë¨¸ë¦¬ ê·¸ë¦¬ê¸°
            ctx.beginPath();
            ctx.moveTo(arrowEndX, arrowEndY);
            ctx.lineTo(arrowEndX - headLength * 0.7 * Math.cos(angle - headAngle), 
                       arrowEndY - headLength * 0.7 * Math.sin(angle - headAngle));
            ctx.lineTo(arrowEndX - headLength * 0.7 * Math.cos(angle + headAngle), 
                       arrowEndY - headLength * 0.7 * Math.sin(angle + headAngle));
            ctx.closePath();
            ctx.fill();
            
            ctx.restore();
        }
        
function drawCircleArrowOutside(centerX, centerY, radius) {
    ctx.save();
    ctx.strokeStyle = '#FF3742';
    ctx.fillStyle = '#FF3742';
    ctx.lineWidth = 3;
    
    if (currentJamo === 'ã…‡') {
        const arrowSize = 18;
        const offset = 25;
        
        // ì™¼ìª½ì—ì„œ ì‹œì‘í•´ì„œ ì‹œê³„ë°©í–¥ìœ¼ë¡œ
        ctx.beginPath();
        ctx.lineWidth = 3;
        ctx.arc(centerX, centerY, radius + offset, Math.PI, Math.PI/2, true); // ì™¼ìª½ì—ì„œ ì•„ë˜ìª½ìœ¼ë¡œ
        ctx.stroke();
        
        // í™”ì‚´í‘œ ë¨¸ë¦¬ë¥¼ ì•„ë˜ìª½ì— ìœ„ì¹˜ (ì‹œê³„ë°©í–¥ ëì )
        const headX = centerX + (radius + offset) * Math.cos(Math.PI/2);
        const headY = centerY + (radius + offset) * Math.sin(Math.PI/2);
        
        // ì‹œê³„ë°©í–¥ ì ‘ì„  ë°©í–¥
        const tangentAngle = Math.PI/2 - Math.PI/2;
        
        ctx.beginPath();
        ctx.moveTo(headX, headY);
        ctx.lineTo(headX - arrowSize * 0.6 * Math.cos(tangentAngle - Math.PI/6), 
                   headY - arrowSize * 0.6 * Math.sin(tangentAngle - Math.PI/6));
        ctx.lineTo(headX - arrowSize * 0.6 * Math.cos(tangentAngle + Math.PI/6), 
                   headY - arrowSize * 0.6 * Math.sin(tangentAngle + Math.PI/6));
        ctx.closePath();
        ctx.fill();
        
    } else if (currentJamo === 'ã…') {
        const arrowSize = 15;
        const offset = 20;
        const adjustedCenterX = centerX + 20;
        const adjustedCenterY = centerY - 20;
        
        // ë™ì¼í•˜ê²Œ ì™¼ìª½ì—ì„œ ì‹œì‘
        ctx.beginPath();
        ctx.lineWidth = 3;
        ctx.arc(adjustedCenterX, adjustedCenterY, radius + offset, Math.PI, Math.PI/2, true);
        ctx.stroke();
        
        const headX = adjustedCenterX + (radius + offset) * Math.cos(Math.PI/2);
        const headY = adjustedCenterY + (radius + offset) * Math.sin(Math.PI/2);
        
        const tangentAngle = Math.PI/2 - Math.PI/2;
        
        ctx.beginPath();
        ctx.moveTo(headX, headY);
        ctx.lineTo(headX - arrowSize * 0.6 * Math.cos(tangentAngle - Math.PI/6), 
                   headY - arrowSize * 0.6 * Math.sin(tangentAngle - Math.PI/6));
        ctx.lineTo(headX - arrowSize * 0.6 * Math.cos(tangentAngle + Math.PI/6), 
                   headY - arrowSize * 0.6 * Math.sin(tangentAngle + Math.PI/6));
        ctx.closePath();
        ctx.fill();
    }
    
    ctx.restore();
}
        function startDrawing(e) {
    // ì•„ì´íŒ¨ë“œ í˜¸í™˜ì„±ì„ ìœ„í•œ ê°•ë ¥í•œ ì°¨ë‹¨
    if (!isPracticeMode || isShowingStrokes || strokeAnimationInterval !== null) {
        if (e && e.preventDefault) e.preventDefault();
        if (e && e.stopPropagation) e.stopPropagation();
        return false;
    }
    
    // ì‚¬ìš©ìê°€ ê·¸ë¦¬ê¸° ì‹œì‘í•˜ë©´ íšìˆœ ì• ë‹ˆë©”ì´ì…˜ ì™„ì „ ì¤‘ë‹¨
    stopStrokeAnimation();
    
    if (e && e.preventDefault) e.preventDefault();
    if (e && e.stopPropagation) e.stopPropagation();
    
    isDrawing = true;
    hasUserDrawn = true;
    const rect = canvas.getBoundingClientRect();
    
    let x, y;
    if (e.type === 'touchstart' && e.touches && e.touches.length > 0) {
        const touch = e.touches[0];
        x = touch.clientX - rect.left;
        y = touch.clientY - rect.top;
    } else if (e.clientX !== undefined && e.clientY !== undefined) {
        x = e.clientX - rect.left;
        y = e.clientY - rect.top;
    } else {
        return false;
    }
    
    // ì•„ì´íŒ¨ë“œ í˜¸í™˜ì„±ì„ ìœ„í•œ ì™„ì „í•œ ìŠ¤íƒ€ì¼ ì„¤ì •
    ctx.save();
    ctx.globalCompositeOperation = 'source-over';
    ctx.strokeStyle = '#000000';
    ctx.fillStyle = 'transparent';
    ctx.lineWidth = 8;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    ctx.setLineDash([]);
    
    ctx.beginPath();
    ctx.moveTo(x, y);
    
    return false;
}
        
     function draw(e) {
    // ì•„ì´íŒ¨ë“œ í˜¸í™˜ì„±ì„ ìœ„í•œ ê°•ë ¥í•œ ì°¨ë‹¨
    if (!isDrawing || !isPracticeMode || isShowingStrokes || strokeAnimationInterval !== null) {
        if (e && e.preventDefault) e.preventDefault();
        if (e && e.stopPropagation) e.stopPropagation();
        return false;
    }
    
    if (e && e.preventDefault) e.preventDefault();
    if (e && e.stopPropagation) e.stopPropagation();
    
    const rect = canvas.getBoundingClientRect();
    
    let x, y;
    if (e.type === 'touchmove' && e.touches && e.touches.length > 0) {
        const touch = e.touches[0];
        x = touch.clientX - rect.left;
        y = touch.clientY - rect.top;
    } else if (e.clientX !== undefined && e.clientY !== undefined) {
        x = e.clientX - rect.left;
        y = e.clientY - rect.top;
    } else {
        return false;
    }
    
    // ì•„ì´íŒ¨ë“œì—ì„œ ìŠ¤íƒ€ì¼ì´ ë³€ê²½ë˜ì§€ ì•Šë„ë¡ ê°•ì œ ì„¤ì •
    if (ctx.strokeStyle !== '#000000') {
        ctx.strokeStyle = '#000000';
    }
    if (ctx.lineWidth !== 8) {
        ctx.lineWidth = 8;
    }
    
    ctx.lineTo(x, y);
    ctx.stroke();
    
    return false;
}
        
           function stopDrawing(e) {
    if (e && e.preventDefault) e.preventDefault();
    if (e && e.stopPropagation) e.stopPropagation();
    
    isDrawing = false;
    
    // ì•„ì´íŒ¨ë“œì—ì„œ ê·¸ë¦¬ê¸° ì™„ë£Œ í›„ ìŠ¤íƒ€ì¼ ì •ë¦¬
    if (ctx) {
        ctx.restore();
    }
    
    return false;
}
        
                // ë””ë²„ê¹…ì„ ìœ„í•œ ê°„ë‹¨í•œ í…ŒìŠ¤íŠ¸ í•¨ìˆ˜
                function testModalSound() {
                    console.log('í…ŒìŠ¤íŠ¸ ì†Œë¦¬ ì¬ìƒ');
                    playModalSound('í…ŒìŠ¤íŠ¸');
                }
        
                function replayModalSound() {
                    playJamoSound(currentSound);
                }
        
          function playJamoSound(sound, cardElement) {
    // ëª¨ë“  ì¹´ë“œì˜ playing í´ë˜ìŠ¤ ì œê±°
    document.querySelectorAll('.jamo-card.playing').forEach(card => {
        card.classList.remove('playing');
    });

    // í†µí•© ìŒì„± ì¬ìƒ í•¨ìˆ˜ ì‚¬ìš©
    playUnifiedSound(sound, cardElement);
}
// ====== ìƒë…„ì›”ì¼ ë“œë¡­ë‹¤ìš´ ê´€ë ¨ í•¨ìˆ˜ë“¤ (ì „ì—­ í•¨ìˆ˜ë¡œ ì •ì˜) ======
function initializeBirthdateDropdowns() {
    console.log('ìƒë…„ì›”ì¼ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì‹œì‘'); // ë””ë²„ê¹…ìš©
    
    // ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°ìš© ë“œë¡­ë‹¤ìš´
    initializeDropdown('findYear', 'findMonth', 'findDay');
    
    // íšŒì›ê°€ì…ìš© ë“œë¡­ë‹¤ìš´
    initializeDropdown('signupYear', 'signupMonth', 'signupDay');
    
    console.log('ìƒë…„ì›”ì¼ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì™„ë£Œ'); // ë””ë²„ê¹…ìš©
}

function initializeDropdown(yearId, monthId, dayId) {
    const yearSelect = document.getElementById(yearId);
    const monthSelect = document.getElementById(monthId);
    const daySelect = document.getElementById(dayId);
    
    console.log(`ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì‹œë„: ${yearId}, ${monthId}, ${dayId}`); // ë””ë²„ê¹…ìš©
    
    if (!yearSelect || !monthSelect || !daySelect) {
        console.log(`ë“œë¡­ë‹¤ìš´ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${yearId}, ${monthId}, ${dayId}`); // ë””ë²„ê¹…ìš©
        return;
    }
    
    console.log(`ë“œë¡­ë‹¤ìš´ ìš”ì†Œ ì°¾ìŒ: ${yearId}, ${monthId}, ${dayId}`); // ë””ë²„ê¹…ìš©
    
    // ê¸°ì¡´ ì˜µì…˜ë“¤ ì œê±° (ì¤‘ë³µ ë°©ì§€)
    yearSelect.innerHTML = '<option value="">ì—°ë„</option>';
    monthSelect.innerHTML = '<option value="">ì›”</option>';
    daySelect.innerHTML = '<option value="">ì¼</option>';
    
    // ì—°ë„ ì˜µì…˜ ì¶”ê°€ (1950ë…„ë¶€í„° í˜„ì¬ë…„ë„ê¹Œì§€)
    const currentYear = new Date().getFullYear();
    for (let year = currentYear; year >= 1950; year--) {
        const option = document.createElement('option');
        option.value = year;
        option.textContent = year;
        yearSelect.appendChild(option);
    }
    console.log(`ì—°ë„ ì˜µì…˜ ì¶”ê°€ ì™„ë£Œ: ${currentYear}ë…„ë¶€í„° 1950ë…„ê¹Œì§€`); // ë””ë²„ê¹…ìš©
    
    // ì›” ì˜µì…˜ ì¶”ê°€ (1ì›”ë¶€í„° 12ì›”ê¹Œì§€)
    for (let month = 1; month <= 12; month++) {
        const option = document.createElement('option');
        option.value = month.toString().padStart(2, '0');
        option.textContent = month + 'ì›”';
        monthSelect.appendChild(option);
    }
    console.log('ì›” ì˜µì…˜ ì¶”ê°€ ì™„ë£Œ: 1ì›”ë¶€í„° 12ì›”ê¹Œì§€'); // ë””ë²„ê¹…ìš©
    
    // ì¼ ì˜µì…˜ ì¶”ê°€ í•¨ìˆ˜
    function updateDayOptions() {
        daySelect.innerHTML = '<option value="">ì¼</option>';
        
        const year = parseInt(yearSelect.value);
        const month = parseInt(monthSelect.value);
        
        if (year && month) {
            const lastDay = new Date(year, month, 0).getDate();
            
            for (let day = 1; day <= lastDay; day++) {
                const option = document.createElement('option');
                option.value = day.toString().padStart(2, '0');
                option.textContent = day + 'ì¼';
                daySelect.appendChild(option);
            }
            console.log(`ì¼ ì˜µì…˜ ì—…ë°ì´íŠ¸: ${year}ë…„ ${month}ì›” - ${lastDay}ì¼ê¹Œì§€`); // ë””ë²„ê¹…ìš©
        } else {
            // ì—°ë„ë‚˜ ì›”ì´ ì„ íƒë˜ì§€ ì•Šì€ ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ 31ì¼ê¹Œì§€ í‘œì‹œ
            for (let day = 1; day <= 31; day++) {
                const option = document.createElement('option');
                option.value = day.toString().padStart(2, '0');
                option.textContent = day + 'ì¼';
                daySelect.appendChild(option);
            }
            console.log('ì¼ ì˜µì…˜ ê¸°ë³¸ê°’ ì„¤ì •: 1ì¼ë¶€í„° 31ì¼ê¹Œì§€'); // ë””ë²„ê¹…ìš©
        }
    }
    
    // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì¤‘ë³µ ë°©ì§€)
    yearSelect.removeEventListener('change', updateDayOptions);
    monthSelect.removeEventListener('change', updateDayOptions);
    
    // ì—°ë„ë‚˜ ì›”ì´ ë³€ê²½ë˜ë©´ ì¼ ì˜µì…˜ ì—…ë°ì´íŠ¸
    yearSelect.addEventListener('change', updateDayOptions);
    monthSelect.addEventListener('change', updateDayOptions);
    
    // ì´ˆê¸° ì¼ ì˜µì…˜ ì„¤ì •
    updateDayOptions();
    
    console.log(`${yearId} ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™” ì™„ë£Œ`); // ë””ë²„ê¹…ìš©
}

// ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ê´€ë ¨ í•¨ìˆ˜
let currentFindMode = 'id';

function showFindForm() {
    console.log('ì°¾ê¸° í¼ í‘œì‹œ ì‹œì‘'); // ë””ë²„ê¹…ìš©
    
    document.getElementById('authForm').classList.add('hidden');
    document.getElementById('findForm').classList.remove('hidden');
    
    // ë¡œê·¸ì¸/íšŒì›ê°€ì… íƒ­ ìˆ¨ê¸°ê¸°
    document.querySelector('.auth-tabs').style.display = 'none';
    
    // ì°¾ê¸° í¼ì´ ë Œë”ë§ëœ í›„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
    setTimeout(() => {
        console.log('ì°¾ê¸° í¼ ë Œë”ë§ í›„ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”'); // ë””ë²„ê¹…ìš©
        initializeBirthdateDropdowns();
    }, 100);
    
    console.log('ì°¾ê¸° í¼ í‘œì‹œ ì™„ë£Œ'); // ë””ë²„ê¹…ìš©
}

function switchFindTab(mode) {
    currentFindMode = mode;
    
    // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
    document.querySelectorAll('.find-tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // ì„ íƒëœ íƒ­ í™œì„±í™”
    document.querySelector(`[onclick="switchFindTab('${mode}')"]`).classList.add('active');
    
    // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
    const submitBtn = document.getElementById('findSubmitBtn');
    submitBtn.textContent = mode === 'id' ? 'ì•„ì´ë”” ì°¾ê¸°' : 'ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°';
}

function hideFindForm() {
    document.getElementById('authForm').classList.remove('hidden');
    document.getElementById('findForm').classList.add('hidden');
    document.getElementById('findFormContent').reset();
    
    // ë¡œê·¸ì¸/íšŒì›ê°€ì… íƒ­ ë‹¤ì‹œ ë³´ì´ê¸°
    document.querySelector('.auth-tabs').style.display = 'flex';
}

// ë¡œê·¸ì¸ ê´€ë ¨ ì´ë²¤íŠ¸ ì²˜ë¦¬
document.addEventListener('DOMContentLoaded', function() {
    console.log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ'); // ë””ë²„ê¹…ìš©
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ë“œë¡­ë‹¤ìš´ ì´ˆê¸°í™”
    initializeBirthdateDropdowns();
    
    document.getElementById('authForm').addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('í¼ ì œì¶œë¨, í˜„ì¬ ëª¨ë“œ:', currentAuthMode); // ë””ë²„ê¹…ìš©
        
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const nickname = document.getElementById('nickname').value;

        console.log('ì…ë ¥ê°’ í™•ì¸:', { username, password, nickname }); // ë””ë²„ê¹…ìš©

     if (currentAuthMode === 'login') {
            console.log('ë¡œê·¸ì¸ ì‹œë„'); // ë””ë²„ê¹…ìš©
            // ë¡œê·¸ì¸ ì²˜ë¦¬
            login(username, password).then(result => {
                console.log('ë¡œê·¸ì¸ ê²°ê³¼:', result); // ë””ë²„ê¹…ìš©
                if (result.success) {
                    alert('ë¡œê·¸ì¸ ì„±ê³µ!');
                } else {
                    alert(result.message);
                }
            }).catch(error => {
                console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                alert('ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        } else if (currentAuthMode === 'signup') {
            console.log('íšŒì›ê°€ì… ì‹œë„'); // ë””ë²„ê¹…ìš©
            // íšŒì›ê°€ì… ì²˜ë¦¬
            if (!nickname) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const year = document.getElementById('signupYear').value;
            const month = document.getElementById('signupMonth').value;
            const day = document.getElementById('signupDay').value;

            console.log('ìƒë…„ì›”ì¼ ì…ë ¥ê°’:', { year, month, day }); // ë””ë²„ê¹…ìš©

            // ìƒë…„ì›”ì¼ ì¡°í•© ë° ìœ íš¨ì„± ê²€ì‚¬
            if (!year || !month || !day) {
                alert('ìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const birthdate = `${year}-${month}-${day}`;
            console.log('íšŒì›ê°€ì… ì‹œë„:', { username, nickname, birthdate }); // ë””ë²„ê¹…ìš©
            
            signup(username, password, nickname, birthdate).then(success => {
                console.log('íšŒì›ê°€ì… ê²°ê³¼:', success); // ë””ë²„ê¹…ìš©
                if (success) {
                    alert('íšŒì›ê°€ì… ì„±ê³µ!');
                } else {
                    alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì•„ì´ë””ì…ë‹ˆë‹¤.');
                }
            }).catch(error => {
                console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
                alert('íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
        } else {
            console.error('ì•Œ ìˆ˜ ì—†ëŠ” ëª¨ë“œ:', currentAuthMode); // ë””ë²„ê¹…ìš©
            alert('ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    });

   // ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° í¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
document.getElementById('findFormContent').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const name = document.getElementById('findName').value;
    const year = document.getElementById('findYear').value;
    const month = document.getElementById('findMonth').value;
    const day = document.getElementById('findDay').value;

    if (!year || !month || !day) {
        alert('ìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.');
        return;
    }

    const birthdate = `${year}-${month}-${day}`;
    console.log('ê²€ìƒ‰ ì‹œë„:', { name, birthdate });
    
    try {
        // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
        const submitBtn = document.getElementById('findSubmitBtn');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'ê²€ìƒ‰ ì¤‘...';
        submitBtn.disabled = true;
        
        const snapshot = await db.collection('users').get();
        let found = false;
        let foundData = null;
        
        // ëª¨ë“  ë¬¸ì„œë¥¼ ë°°ì—´ë¡œ ë³€í™˜í•˜ì—¬ ì²˜ë¦¬
        const docs = [];
        snapshot.forEach(doc => {
            docs.push({
                id: doc.id,
                data: doc.data()
            });
        });
        
        console.log('ì´ ì‚¬ìš©ì ìˆ˜:', docs.length);
        
        // ê° ì‚¬ìš©ì ë°ì´í„° í™•ì¸
        for (const doc of docs) {
            const userData = doc.data;
            console.log('í™•ì¸ ì¤‘:', doc.id, userData.nickname, userData.birthdate);
            
            if (userData.nickname === name && userData.birthdate === birthdate) {
                found = true;
                foundData = {
                    id: doc.id,
                    password: userData.password
                };
                break;
            }
        }
        
        // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
        
        if (found) {
            alert(`ì°¾ì€ ì•„ì´ë””: ${foundData.id}\nì°¾ì€ ë¹„ë°€ë²ˆí˜¸: ${foundData.password}`);
        } else {
            alert('ì¼ì¹˜í•˜ëŠ” ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
        }
        
        hideFindForm();
        
    } catch (error) {
        console.error('ê²€ìƒ‰ ì˜¤ë¥˜:', error);
        
        // ë²„íŠ¼ ìƒíƒœ ë³µêµ¬
        const submitBtn = document.getElementById('findSubmitBtn');
        submitBtn.textContent = 'ì°¾ê¸°';
        submitBtn.disabled = false;
        
        alert('ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    }
});


    // í˜ì´ì§€ ë¡œë“œì‹œ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
const savedUser = localStorage.getItem('currentUser');
if (savedUser) {
    try {
        const userInfo = JSON.parse(savedUser);
        console.log('ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ ë³µêµ¬ ì‹œë„:', userInfo.username);
        
        getUserData(userInfo.username).then(userData => {
            if (userData) {
                currentUser = {
                    username: userInfo.username,
                    nickname: userData.nickname,
                    stats: userData.stats || {
                        consonantCorrect: {},
                        vowelCorrect: {},
                        finalCorrect: {},
                        consonantTotal: {},
                        vowelTotal: {},
                        finalTotal: {}
                    }
                };
                updateLoginUI();
                console.log('ì‚¬ìš©ì ìƒíƒœ ë³µêµ¬ ì™„ë£Œ:', currentUser.nickname);
            } else {
                console.log('ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŒ');
                localStorage.removeItem('currentUser');
            }
        }).catch(error => {
            console.error('ì‚¬ìš©ì ìƒíƒœ ë³µêµ¬ ì˜¤ë¥˜:', error);
            localStorage.removeItem('currentUser');
        });
    } catch (error) {
        console.error('ì €ì¥ëœ ì‚¬ìš©ì ì •ë³´ íŒŒì‹± ì˜¤ë¥˜:', error);
        localStorage.removeItem('currentUser');
    }
}
});

// í¼ì„¼íŠ¸ ê³„ì‚° í•¨ìˆ˜ (ë‹¨ê³„ë³„ ì°¨ë“± ì ìš©)
function calculatePercentage(jamo, type) {
    if (!currentUser || !currentUser.stats) return 0;
    
    let totalKey;
    
    if (type === 'consonant') {
        totalKey = 'consonantTotal';
    } else if (type === 'vowel') {
        totalKey = 'vowelTotal';
    } else if (type === 'final') {
        totalKey = 'finalTotal';
    } else {
        return 0;
    }
    
    const totalData = currentUser.stats[totalKey] || {};
    const totalCount = totalData[jamo] || 0;
    
    // ë‹¨ê³„ë³„ ì°¨ë“± í¼ì„¼íŠ¸ ê³„ì‚°
    let percentage = 0;
    
    if (totalCount <= 20) {
        // ì²˜ìŒ 20íšŒ: 1íšŒë‹¹ 3% (0~60%)
        percentage = totalCount * 3;
    } else if (totalCount <= 50) {
        // 21-50íšŒ: 1íšŒë‹¹ 2% (60~120% â†’ 60~90%)
        percentage = 60 + (totalCount - 20) * 2;
    } else if (totalCount <= 100) {
        // 51-100íšŒ: 1íšŒë‹¹ 1% (90~140% â†’ 90~100%)
        percentage = 90 + (totalCount - 50) * 0.2;
    } else {
        // 100íšŒ ì´ìƒ: 100% ìœ ì§€
        percentage = 100;
    }
    
    // ìµœëŒ€ 100%ë¡œ ì œí•œ
    return Math.min(Math.round(percentage), 100);
}
// ê²Œì„ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (20ë¬¸ì œ ë§ì¶œ ë•Œë§ˆë‹¤ 1íšŒ)
function updateGameStats(word, isCorrect) {
    if (!currentUser || !currentUser.stats) return;
    
    // ê²Œì„ ì¹´ìš´í„° ì´ˆê¸°í™”
    if (!currentUser.stats.gameCounters) {
        currentUser.stats.gameCounters = {};
    }
    
    // ë‹¨ì–´ë¥¼ ìëª¨ë¡œ ë¶„í•´
    for (let char of word) {
        const decomposed = decomposeHangul(char);
        
        if (decomposed) {
            // ì´ˆì„± ì²˜ë¦¬
            if (decomposed.initial) {
                updateGameStatForJamo(decomposed.initial, 'consonant', isCorrect);
            }
            
            // ì¤‘ì„± ì²˜ë¦¬
            const vowel = decomposed.medial || decomposed.vowel;
            if (vowel) {
                updateGameStatForJamo(vowel, 'vowel', isCorrect);
            }
            
            // ì¢…ì„± ì²˜ë¦¬
            if (decomposed.final) {
                updateGameStatForJamo(decomposed.final, 'final', isCorrect);
            }
        }
    }
    
    // Firebaseì— ì €ì¥
    updateUserStats(currentUser.username, currentUser.stats);
}

// ê²Œì„ìš© ê°œë³„ ìëª¨ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€)
function updateGameStatForJamo(jamo, type, isCorrect) {
    let correctKey, totalKey, counterKey;
    
    if (type === 'consonant') {
        correctKey = 'consonantCorrect';
        totalKey = 'consonantTotal';
        counterKey = 'consonantGameCounter';
    } else if (type === 'vowel') {
        correctKey = 'vowelCorrect';
        totalKey = 'vowelTotal';
        counterKey = 'vowelGameCounter';
    } else if (type === 'final') {
        correctKey = 'finalCorrect';
        totalKey = 'finalTotal';
        counterKey = 'finalGameCounter';
    } else {
        return;
    }
    
    // í†µê³„ ê°ì²´ ì´ˆê¸°í™”
    if (!currentUser.stats[totalKey]) currentUser.stats[totalKey] = {};
    if (!currentUser.stats[correctKey]) currentUser.stats[correctKey] = {};
    if (!currentUser.stats.gameCounters[counterKey]) currentUser.stats.gameCounters[counterKey] = {};
    
    if (!currentUser.stats[totalKey][jamo]) currentUser.stats[totalKey][jamo] = 0;
    if (!currentUser.stats[correctKey][jamo]) currentUser.stats[correctKey][jamo] = 0;
    if (!currentUser.stats.gameCounters[counterKey][jamo]) currentUser.stats.gameCounters[counterKey][jamo] = 0;
    
    // ì •ë‹µì¼ ë•Œë§Œ ì¹´ìš´í„° ì¦ê°€
    if (isCorrect) {
        currentUser.stats.gameCounters[counterKey][jamo]++;
        
        // 20ë¬¸ì œ ë§ì¶œ ë•Œë§ˆë‹¤ 1íšŒ í•™ìŠµìœ¼ë¡œ ê¸°ë¡
        if (currentUser.stats.gameCounters[counterKey][jamo] >= 20) {
            currentUser.stats[totalKey][jamo]++;
            currentUser.stats[correctKey][jamo]++;
            
            // ì¹´ìš´í„° ë¦¬ì…‹
            currentUser.stats.gameCounters[counterKey][jamo] = 0;
        }
    }
}

// í•™ìŠµ í™œë™ í†µê³„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê°„ì†Œí™”)
function updateLearningStats(jamo, type) {
    if (!currentUser || !currentUser.stats) return;
    
    let correctKey, totalKey;
    
    if (type === 'consonant') {
        correctKey = 'consonantCorrect';
        totalKey = 'consonantTotal';
    } else if (type === 'vowel') {
        correctKey = 'vowelCorrect';
        totalKey = 'vowelTotal';
    } else if (type === 'final') {
        correctKey = 'finalCorrect';
        totalKey = 'finalTotal';
    } else {
        return;
    }
    
    // í†µê³„ ê°ì²´ ì´ˆê¸°í™”
    if (!currentUser.stats[totalKey]) currentUser.stats[totalKey] = {};
    if (!currentUser.stats[correctKey]) currentUser.stats[correctKey] = {};
    if (!currentUser.stats[totalKey][jamo]) currentUser.stats[totalKey][jamo] = 0;
    if (!currentUser.stats[correctKey][jamo]) currentUser.stats[correctKey][jamo] = 0;
    
   // ì‹¤ì œ ê·¸ë¦¬ê¸° í™œë™ ì™„ë£Œ ì‹œì—ë§Œ 1íšŒ í•™ìŠµìœ¼ë¡œ ê¸°ë¡
currentUser.stats[totalKey][jamo]++;
currentUser.stats[correctKey][jamo]++; // í•™ìŠµ ì™„ë£ŒëŠ” í•­ìƒ ì„±ê³µìœ¼ë¡œ ê°„ì£¼
           
// Firebaseì— ì €ì¥
updateUserStats(currentUser.username, currentUser.stats);
}  // â† updateLearningStats í•¨ìˆ˜ë¥¼ ì—¬ê¸°ì„œ ë‹«ê¸°

// ê°€ì¥ ê°„ë‹¨í•œ ëª¨ë°”ì¼ í˜¸í™˜ ë²„ì „
function togglePassword() {
    const password = document.getElementById('password');
    
    if (!password) return;
    
    // í˜„ì¬ íƒ€ì… í™•ì¸ í›„ ë³€ê²½
    if (password.type === 'password') {
        password.type = 'text';
    } else {
        password.type = 'password';
    }
    
    // í† ê¸€ ë²„íŠ¼ ìƒ‰ìƒ ë³€ê²½ (ìˆëŠ” ê²½ìš°ì—ë§Œ)
    const eye = document.querySelector('span[onclick="togglePassword()"]');
    if (eye) {
        eye.style.color = password.type === 'text' ? '#4CAF50' : '#999';
    }
}

// íƒˆí‡´ ëª¨ë‹¬ í‘œì‹œ
function showWithdrawModal() {
    document.getElementById('withdrawModal').style.display = 'flex';
}

// íƒˆí‡´ ëª¨ë‹¬ ë‹«ê¸°
function closeWithdrawModal() {
    document.getElementById('withdrawModal').style.display = 'none';
}

// íƒˆí‡´ í™•ì¸ ë° ì²˜ë¦¬
async function confirmWithdraw() {
    if (!currentUser) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
        return;
    }
    
    try {
        // Firebaseì—ì„œ ì‚¬ìš©ì ë°ì´í„° ì‚­ì œ
        await db.collection('users').doc(currentUser.username).delete();
        
        // í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ì´ˆê¸°í™”
        currentUser = null;
       localStorage.removeItem('currentUser');
        
        // UI ì—…ë°ì´íŠ¸
        updateLoginUI();
        
        // ëª¨ë‹¬ ë‹«ê¸°
        closeWithdrawModal();
        
        // ë©”ì¸ ë©”ë‰´ë¡œ ì´ë™
        showMainMenu();
        
        alert('íšŒì› íƒˆí‡´ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë™ì•ˆ ì´ìš©í•´ ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.');
        
    } catch (error) {
        console.error('íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
        alert('íƒˆí‡´ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.');
    }
}

    </script>
